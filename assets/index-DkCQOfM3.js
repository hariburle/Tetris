(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();const Ue={},f=10,E=20,Pe=300,Te=100,B=document.getElementById("game-canvas"),a=B.getContext("2d"),q=document.getElementById("next-canvas"),le=q.getContext("2d"),W=document.getElementById("hold-canvas"),ae=W.getContext("2d"),Ye=document.getElementById("score"),re=document.getElementById("lines"),K=document.getElementById("level"),Xe=document.getElementById("high-score"),fe=document.getElementById("pause-button"),he=document.getElementById("quit-button"),Ve=document.getElementById("help-button"),j=document.getElementById("game-container"),ce=document.getElementById("mode-display"),Le=document.getElementById("mode-label"),Me=document.getElementById("mode-value"),me=document.getElementById("main-menu"),F=document.querySelectorAll("#menu-button-group button"),ze=document.getElementById("menu-marathon-button"),Je=document.getElementById("menu-sprint-button"),Ke=document.getElementById("menu-ultra-button"),je=document.getElementById("menu-high-scores-button"),Qe=document.getElementById("menu-settings-button"),Ze=document.getElementById("help-modal"),et=document.getElementById("high-scores-modal"),tt=document.getElementById("settings-modal"),ke=document.getElementById("high-scores-table"),Ce=document.getElementById("volume-slider"),Ae=document.getElementById("ghost-toggle"),nt=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],ot=5,st=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],xe=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],it={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},lt={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let b,s,$,A,Q,Z,V,ee,I,L,m=!0,p,te,ge,U,h,y=[],Y,D,G=null,z,T,k,S,M,H,R,C=0;const g={sounds:{},volume:.5,loadSounds:function(){const e=["move","rotate","softDrop","hardDrop","lock","hold","clearLine","clearTetris","levelUp","pause","gameOver"],t=typeof Ue<"u"?"/Tetris/":"/";e.forEach(o=>{const n=new Audio,i=document.createElement("source");i.src=`${t}sounds/${o}.wav`,i.type="audio/wav";const l=document.createElement("source");l.src=`${t}sounds/${o}.mp3`,l.type="audio/mpeg",n.appendChild(i),n.appendChild(l),this.sounds[o]=n})},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(o=>console.error(`Error playing sound ${e}:`,o.message))}}};function at(){g.loadSounds(),Et(),vt(),rt(),ye(),J()}function rt(){ze.addEventListener("click",()=>ie("marathon")),Je.addEventListener("click",()=>ie("sprint")),Ke.addEventListener("click",()=>ie("ultra")),je.addEventListener("click",dt),Qe.addEventListener("click",ut),fe.addEventListener("click",O),he.addEventListener("click",Oe),Ve.addEventListener("click",ne),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",pe)}),Ce.addEventListener("input",e=>{S.volume=parseFloat(e.target.value),g.volume=S.volume,Be()}),Ae.addEventListener("change",e=>{S.showGhost=e.target.checked,Be(),m||N()}),document.addEventListener("keydown",It),window.addEventListener("resize",ye),wt()}function J(){B.removeEventListener("click",J),document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden")),me.classList.remove("hidden"),j.classList.add("hidden"),ce.classList.add("hidden"),C=0,de()}function de(){F.forEach((e,t)=>{t===C?e.classList.add("selected"):e.classList.remove("selected")})}function ct(){me.classList.add("hidden"),j.classList.remove("hidden"),ye()}function ne(){h&&!p&&!m&&O(),Ze.classList.remove("hidden")}function dt(){const e=ke.querySelector("tbody");e&&e.remove();const t=document.createElement("tbody");L.length===0?t.innerHTML='<tr><td colspan="2">No scores yet!</td></tr>':L.forEach((o,n)=>{const i=`<tr><td>${n+1}.</td><td>${o.score}</td></tr>`;t.innerHTML+=i}),ke.appendChild(t),et.classList.remove("hidden")}function ut(){h&&!p&&!m&&O(),tt.classList.remove("hidden")}function pe(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=p;document.querySelectorAll(".modal").forEach(o=>o.classList.add("hidden")),t&&h&&!m&&(p=!1,O())}function ye(){const e=window.innerHeight,t=j.getBoundingClientRect();let o=t.width;if(window.innerWidth<=900){const i=document.getElementById("side-panel"),l=window.getComputedStyle(j),c=parseFloat(l.paddingTop),w=parseFloat(l.paddingBottom),x=parseFloat(l.gap),d=window.innerHeight>window.innerWidth?i.offsetHeight+c+w+x:c+w+x,v=e-d,r=Math.floor(v/E),u=Math.floor(t.width*.95/f);T=Math.max(1,Math.min(r,u))}else{o-=252;const i=Math.floor(e*.9/E),l=Math.floor(o*.95/f);T=Math.max(1,Math.min(i,l))}B.width=f*T,B.height=E*T;const n=document.getElementById("side-panel");window.innerWidth>900||window.innerHeight<window.innerWidth?n.style.height=`${B.height}px`:n.style.height="auto",a.scale(T,T),k=Math.floor(T*.7),q.width=4*k,q.height=4*k,le.scale(k,k),W.width=4*k,W.height=4*k,ae.scale(k,k),$&&Fe(),A&&we(),b&&(N(),m&&Ge())}function ie(e){switch(M=e,ct(),h&&cancelAnimationFrame(h),b=ft(),V=0,ee=0,I=0,m=!1,p=!1,te=0,ge=1e3,U=0,h=0,y=[],Y=0,D=0,A=null,Q=!0,Z=[],ce.classList.remove("hidden"),M){case"sprint":H=40,Le.textContent="LINES",K.parentElement.classList.add("hidden");break;case"ultra":R=3*60*1e3,Le.textContent="TIME",K.parentElement.classList.add("hidden"),re.parentElement.classList.add("hidden");break;case"marathon":default:ce.classList.add("hidden"),K.parentElement.classList.remove("hidden"),re.parentElement.classList.remove("hidden");break}Re(),We(I),pe(),se(),Ie(),He(),ve(),we(),fe.textContent="Pause",he.classList.remove("hidden"),Ee(0)}function Oe(){h&&(cancelAnimationFrame(h),h=0),m=!0,J()}function Ee(e=0){if(m)return;if(h=requestAnimationFrame(Ee),p){qe();return}const t=e-U;if(U=e,M==="ultra"?(R-=t,R<=0&&(R=0,ue())):M==="sprint"&&H<=0&&ue(),D>0&&(D-=t),y.length>0){if(Y-=t,Y<=0){let o=y.length;y.sort((n,i)=>n-i).forEach(n=>{b.splice(n,1),b.unshift(Array(f).fill(0))}),y=[],yt(o),ve()}}else te+=t,te>ge&&Se();m||(se(),N())}function ue(){m=!0,g.play("gameOver"),bt(),N(),Ge(),cancelAnimationFrame(h),h=0,he.classList.add("hidden"),B.addEventListener("click",J)}function ft(){return Array.from({length:E},()=>Array(f).fill(0))}function Re(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}Z.push(...e)}function De(){Z.length===0&&Re();const e=Z.shift();return{shape:nt[e],shapeIndex:e}}function ve(){s={...$,x:Math.floor(f/2)-1,y:0},He(),z=!1,Q=!0,P(s.shape,s.x,s.y)||ue()}function He(){$=De(),Fe()}function Ne(){if(!Q)return;g.play("hold");const e=s.x,t=s.y,o={shape:s.shape,shapeIndex:s.shapeIndex};let n;A?n={...A,x:e,y:t}:n={...De(),x:Math.floor(f/2)-1,y:0},P(n.shape,n.x,n.y)&&(s=n,A=o,Q=!1,we())}function Se(){P(s.shape,s.x,s.y+1)?(s.y++,z=!1):be(),te=0}function oe(e){P(s.shape,s.x+e,s.y)&&(s.x+=e,z=!1,g.play("move"))}function _e(){const e=ht(s.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[o,n]of t)if(P(e,s.x+o,s.y+n)){s.x+=o,s.y+=n,s.shape=e,z=!0,g.play("rotate");return}}function ht(e){return e[0].map((t,o)=>e.map(n=>n[o])).map(t=>t.reverse())}function P(e,t,o){for(let n=0;n<e.length;n++)for(let i=0;i<e[n].length;i++)if(e[n][i]!==0){const l=t+i,c=o+n;if(l<0||l>=f||c>=E||c>=0&&b[c][l]!==0)return!1}return!0}function be(){const e=gt();G={shape:s.shape,x:s.x,y:s.y},D=Te,s.shape.forEach((t,o)=>{t.forEach((n,i)=>{n>0&&s.y+o>=0&&(b[s.y+o][s.x+i]=n)})}),pt(e),y.length===0&&(e&&(V+=400*(I+1),se()),ve()),g.play("lock")}function N(){if(!(!a||!b)){if(a.clearRect(0,0,B.width,B.height),X(a,b,0,0),D>0&&G&&(a.fillStyle=`rgba(255, 255, 255, ${.8*(D/Te)})`,G.shape.forEach((e,t)=>{e.forEach((o,n)=>{o>0&&a.fillRect(G.x+n,G.y+t,1,1)})})),!m&&s){if(S.showGhost){let e=s.y;for(;P(s.shape,s.x,e+1);)e++;mt(a,s.shape,s.x,e)}X(a,s.shape,s.x,s.y)}if(y.length>0){const e=Math.abs(Math.sin(Y/Pe*Math.PI*2));a.fillStyle=`rgba(255, 255, 255, ${e*.9})`,y.forEach(t=>{a.fillRect(0,t,f,1)})}}}function Fe(){if(le.clearRect(0,0,q.width,q.height),!$)return;const{shape:e}=$,t=(4-e[0].length)/2,o=(4-e.length)/2;X(le,e,t,o)}function we(){if(ae.clearRect(0,0,W.width,W.height),!A)return;const{shape:e}=A,t=(4-e[0].length)/2,o=(4-e.length)/2;X(ae,e,t,o)}function X(e,t,o,n,i){t.forEach((l,c)=>{l.forEach((w,x)=>{if(w>0){if(y.includes(Math.floor(c+n)))return;const d=i||st[w],v=x+o,r=c+n,u=.1;e.fillStyle=d.dark,e.fillRect(v,r,1,1),e.fillStyle=d.light,e.fillRect(v,r,1-u,1-u),e.fillStyle=d.base,e.fillRect(v+u,r+u,1-u*2,1-u*2)}})})}function mt(e,t,o,n){const i=it;t.forEach((l,c)=>{l.forEach((w,x)=>{if(w>0){const d=x+o,v=c+n,r=.1;e.fillStyle=i.dark,e.fillRect(d,v,1,1),e.fillStyle=i.light,e.fillRect(d,v,1-r,1-r),e.fillStyle=i.base,e.fillRect(d+r,v+r,1-r*2,1-r*2)}})})}function Ge(){X(a,b,0,0,lt),a.fillStyle="rgba(0, 0, 0, 0.75)",a.fillRect(0,0,f,E),a.fillStyle="white",a.textAlign="center";let e="GAME OVER";M==="sprint"&&H<=0&&(e="YOU WIN!"),a.font='1.1px "Press Start 2P"',a.fillText(e,f/2,E/2-1.5),a.font='0.7px "Press Start 2P"',a.fillText("Press any key",f/2,E/2+1),a.fillText("to continue",f/2,E/2+2)}function qe(){a.fillStyle="rgba(0, 0, 0, 0.75)",a.fillRect(0,0,f,E),a.fillStyle="white",a.textAlign="center",a.font='1.5px "Press Start 2P"',a.fillText("PAUSED",f/2,E/2)}function gt(){if(s.shapeIndex!==ot||!z)return!1;const e=s.x+1,t=s.y+1,o=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let n=0;return o.forEach(([i,l])=>{(l<0||l>=f||i<0||i>=E||b[i][l]!==0)&&n++}),n>=3}function pt(e){let t=0;b.forEach((o,n)=>{o.every(i=>i>0)&&(t++,y.push(n))}),t>0&&(Y=Pe,V+=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(I+1),g.play(t>=4?"clearTetris":"clearLine"))}function yt(e){const t=I;ee+=e,M==="sprint"&&(H-=e),M==="marathon"&&(I=Math.floor(ee/10),I>t&&(We(I),g.play("levelUp")),ge=Math.max(200,1e3-I*75)),se()}function We(e){const t=xe[e%xe.length];document.documentElement.style.setProperty("--accent-color",t)}function se(){if(Ye.textContent=V.toString(),re.textContent=ee.toString(),K.textContent=I.toString(),M==="sprint")Me.textContent=Math.max(0,H).toString();else if(M==="ultra"){const e=Math.floor(R/6e4),t=Math.floor(R%6e4/1e3);Me.textContent=`${e}:${t.toString().padStart(2,"0")}`}}function Et(){const e=localStorage.getItem("tetrisSettings");S=e?JSON.parse(e):{volume:.5,showGhost:!0},S.showGhost===void 0&&(S.showGhost=!0),g.volume=S.volume,Ce.value=S.volume.toString(),Ae.checked=S.showGhost}function Be(){localStorage.setItem("tetrisSettings",JSON.stringify(S))}function vt(){const e=localStorage.getItem("tetrisHighScores");L=e?JSON.parse(e):[],Ie()}function St(){localStorage.setItem("tetrisHighScores",JSON.stringify(L))}function bt(){if(M==="sprint"&&H>0)return;const e={score:V,date:new Date().toISOString()};L.push(e),L.sort((t,o)=>o.score-t.score),L=L.slice(0,5),St(),Ie()}function Ie(){Xe.textContent=L.length>0?L[0].score.toString():"0"}function O(){if(m||y.length>0||document.querySelector(".modal:not(.hidden)"))return;p=!p,p?(g.play("pause"),cancelAnimationFrame(h),qe()):(U=performance.now(),Ee(U));const e=p?"Resume":"Pause";fe.textContent=e;const t=document.getElementById("mc-pause");t&&(t.textContent=e)}function wt(){const e=document.getElementById("mc-left"),t=document.getElementById("mc-right"),o=document.getElementById("mc-down"),n=document.getElementById("mc-rotate"),i=document.getElementById("mc-hard-drop"),l=document.getElementById("mc-hold"),c=document.getElementById("mc-pause"),w=document.getElementById("mc-help");if(!e||!t||!o||!n||!i||!l||!c||!w)return;const x=(u=25)=>{"vibrate"in navigator&&navigator.vibrate(u)},d=(u,_)=>$e=>{$e.preventDefault(),x(),!((p||m||y.length>0||document.querySelector(".modal:not(.hidden)"))&&u!==O&&u!==ne)&&(u(),_&&g.play(_),p||N())},v=()=>{for(;P(s.shape,s.x,s.y+1);)s.y++;be()},r=(u,_)=>{u.addEventListener("touchstart",_,{passive:!1}),u.addEventListener("mousedown",_,{passive:!1})};r(e,d(()=>oe(-1))),r(t,d(()=>oe(1))),r(o,d(Se,"softDrop")),r(n,d(_e)),r(l,d(Ne)),r(i,d(v,"hardDrop")),r(c,d(O)),r(w,d(ne))}function It(e){const t=e.key.toLowerCase();if(!me.classList.contains("hidden")){switch(e.preventDefault(),t){case"arrowdown":C=(C+1)%F.length,de();break;case"arrowup":C=(C-1+F.length)%F.length,de();break;case"enter":F[C].click();break}return}if(m){h===0&&J();return}if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),pe());return}if(t==="h"){e.preventDefault(),ne();return}if(t==="p"||t==="escape"){e.preventDefault(),O();return}if(!(p||y.length>0)){switch(t){case"arrowleft":e.preventDefault(),oe(-1);break;case"arrowright":e.preventDefault(),oe(1);break;case"arrowdown":e.preventDefault(),Se(),g.play("softDrop");break;case"arrowup":e.preventDefault(),_e();break;case"enter":case" ":for(e.preventDefault();P(s.shape,s.x,s.y+1);)s.y++;be(),g.play("hardDrop");break;case"c":e.preventDefault(),Ne();break;case"q":e.preventDefault(),Oe();break}N()}}at();
