(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();const a=10,h=20,P=document.getElementById("game-canvas"),c=P.getContext("2d"),v=document.getElementById("next-canvas"),q=v.getContext("2d"),se=document.getElementById("score"),ae=document.getElementById("lines"),fe=document.getElementById("level"),de=document.getElementById("high-score"),b=document.getElementById("start-button"),H=document.getElementById("quit-button"),ue=document.getElementById("help-button"),O=document.getElementById("help-modal"),he=document.querySelector(".close-button"),_=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],ge=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],K=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],F={base:"#555",light:"#888",dark:"#333"},me={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let p,t,T,w,C,m,I,d,f,B,D,N,s,x,A;function pe(){Pe(),b.addEventListener("click",()=>{if(d){Q();return}s&&!d?re():Q()}),H.addEventListener("click",j),document.addEventListener("keydown",Le),ue.addEventListener("click",ce),he.addEventListener("click",z),window.addEventListener("resize",V),V(),G()}function V(){const e=window.innerHeight;document.body.clientWidth;const n=document.getElementById("game-container"),o=document.getElementById("side-panel");let l=n.clientWidth;window.innerWidth>768&&(l-=o.clientWidth+32);const i=Math.floor(e*.9/h),r=Math.floor(l*.95/a);x=Math.min(i,r),P.width=a*x,P.height=h*x,window.innerWidth>768?o.style.height=`${P.height}px`:o.style.height="auto",c.scale(x,x),A=Math.floor(x*.7),v.width=4*A,v.height=4*A,q.scale(A,A),T&&te(),d?(k(),ne()):f?(k(),ie()):!s&&p&&k()}function Q(){s&&cancelAnimationFrame(s),p=J(),w=0,C=0,m=0,d=!1,f=!1,B=0,D=1e3,N=0,s=0,Y(m),z(),U(),X(),G(),Z(),b.textContent="Pause",H.classList.remove("hidden"),ee(0)}function j(){s&&(cancelAnimationFrame(s),s=0),p=J(),w=0,C=0,m=0,d=!1,f=!1,D=1e3,Y(0),U(),G(),k(),b.textContent="Start Game",H.classList.add("hidden")}function J(){return Array.from({length:h},()=>Array(a).fill(0))}function Z(){t={...T,x:Math.floor(a/2)-1,y:0},G(),y(t.shape,t.x,t.y)||(d=!0)}function G(){T=ye(),te()}function ye(){const e=Math.floor(Math.random()*_.length);return{shape:_[e]}}function ee(e=0){if(s=requestAnimationFrame(ee),f){ie();return}if(d){we(),ne(),cancelAnimationFrame(s),s=0,b.textContent="Start Game",H.classList.add("hidden");return}const n=e-N;N=e,B+=n,B>D&&oe(),k()}function k(){c.clearRect(0,0,P.width,P.height),M(c,p,0,0);let e=t.y;for(;y(t.shape,t.x,e+1);)e++;be(c,t.shape,t.x,e),M(c,t.shape,t.x,t.y)}function te(){q.clearRect(0,0,v.width,v.height);const{shape:e}=T,n=(4-e[0].length)/2,o=(4-e.length)/2;M(q,e,n,o)}function M(e,n,o,l,i){n.forEach((r,u)=>{r.forEach((R,L)=>{if(R>0){const E=i||ge[R],g=L+o,W=u+l,S=.1;e.fillStyle=E.dark,e.fillRect(g,W,1,1),e.fillStyle=E.light,e.fillRect(g,W,1-S,1-S),e.fillStyle=E.base,e.fillRect(g+S,W+S,1-S*2,1-S*2)}})})}function be(e,n,o,l){n.forEach((i,r)=>{i.forEach((u,R)=>{if(u>0){const L=R+o,E=r+l,g=.1;e.fillStyle=F.dark,e.fillRect(L,E,1,1),e.fillStyle=F.light,e.fillRect(L,E,1-g,1-g),e.fillStyle=F.base,e.fillRect(L+g,E+g,1-g*2,1-g*2)}})})}function ne(){M(c,p,0,0,me),c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,a,h),c.fillStyle="white",c.textAlign="center",c.font='1.1px "Press Start 2P"',c.fillText("GAME OVER",a/2,h/2-1.5),c.font='0.7px "Press Start 2P"',c.fillText("Press Start",a/2,h/2+.5),c.fillText("to Play Again",a/2,h/2+1.5)}function ie(){c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,a,h),c.fillStyle="white",c.textAlign="center",c.font='1.5px "Press Start 2P"',c.fillText("PAUSED",a/2,h/2)}function oe(){y(t.shape,t.x,t.y+1)?t.y++:le(),B=0}function $(e){y(t.shape,t.x+e,t.y)&&(t.x+=e)}function Ee(){const e=t.shape,n=Se(e);let o=1;y(n,t.x,t.y)?t.shape=n:y(n,t.x+o,t.y)?(t.x+=o,t.shape=n):y(n,t.x-o,t.y)&&(t.x-=o,t.shape=n)}function Se(e){return e[0].map((o,l)=>e.map(i=>i[l])).map(o=>o.reverse())}function y(e,n,o){for(let l=0;l<e.length;l++)for(let i=0;i<e[l].length;i++)if(e[l][i]!==0){const r=n+i,u=o+l;if(r<0||r>=a||u>=h||u>=0&&p[u][r]!==0)return!1}return!0}function le(){t.shape.forEach((e,n)=>{e.forEach((o,l)=>{o>0&&t.y+n>=0&&(p[t.y+n][t.x+l]=o)})}),xe(),Z()}function xe(){let e=0;e:for(let n=h-1;n>=0;n--){for(let l=0;l<a;l++)if(p[n][l]===0)continue e;const o=p.splice(n,1)[0].fill(0);p.unshift(o),n++,e++}if(e>0){const n=m;C+=e,w+=[0,100,300,500,800][e]*(m+1),m=Math.floor(C/10),m>n&&Y(m),D=Math.max(200,1e3-m*75),U()}}function Y(e){const n=K[e%K.length];document.documentElement.style.setProperty("--accent-color",n)}function U(){se.textContent=w.toString(),ae.textContent=C.toString(),fe.textContent=m.toString()}function Pe(){const e=localStorage.getItem("tetrisHighScore");I=e?parseInt(e,10):0,X()}function ke(){localStorage.setItem("tetrisHighScore",I.toString())}function we(){w>I&&(I=w,ke(),X())}function X(){de.textContent=I.toString()}function re(){d||f&&!O.classList.contains("hidden")||(f=!f,b.textContent=f?"Resume":"Pause")}function ce(){s&&!f&&!d&&(f=!0,b.textContent="Resume"),O.classList.remove("hidden")}function z(){s&&!d&&b.textContent==="Resume"&&(f=!1,b.textContent="Pause"),O.classList.add("hidden")}function Le(e){if(e.key==="h"||e.key==="H"){e.preventDefault(),ce();return}if(!d&&(e.key==="p"||e.key==="P"||e.key==="Escape")){e.preventDefault(),!O.classList.contains("hidden")&&e.key==="Escape"?z():re();return}if(!(d||f)){switch(e.key){case"ArrowLeft":e.preventDefault(),$(-1);break;case"ArrowRight":e.preventDefault(),$(1);break;case"ArrowDown":e.preventDefault(),oe();break;case"ArrowUp":e.preventDefault(),Ee();break;case" ":for(e.preventDefault();y(t.shape,t.x,t.y+1);)t.y++;le();break;case"q":case"Q":e.preventDefault(),j();break}k()}}pe();
