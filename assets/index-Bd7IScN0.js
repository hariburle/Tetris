(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();const Ke={},h=10,v=20,Ne=300,_e=100,k=document.getElementById("game-canvas"),a=k.getContext("2d"),q=document.getElementById("next-canvas"),ue=q.getContext("2d"),W=document.getElementById("hold-canvas"),fe=W.getContext("2d"),je=document.getElementById("score"),K=document.getElementById("lines"),j=document.getElementById("level"),Qe=document.getElementById("high-score"),Ze=document.getElementById("mobile-score"),Q=document.getElementById("mobile-level"),pe=document.getElementById("pause-button"),ae=document.getElementById("quit-button"),et=document.getElementById("help-button"),Z=document.getElementById("game-container"),he=document.getElementById("mode-display"),ke=document.getElementById("mode-label"),Ce=document.getElementById("mode-value"),Pe=document.getElementById("mobile-mode-display"),Te=document.getElementById("mobile-mode-label"),Ae=document.getElementById("mobile-mode-value"),ee=document.getElementById("mc-pause"),Oe=document.getElementById("mc-help"),$=document.getElementById("mc-quit"),ye=document.getElementById("main-menu"),F=document.querySelectorAll("#menu-button-group button"),tt=document.getElementById("menu-marathon-button"),nt=document.getElementById("menu-sprint-button"),ot=document.getElementById("menu-ultra-button"),st=document.getElementById("menu-high-scores-button"),it=document.getElementById("menu-settings-button"),lt=document.getElementById("help-modal"),at=document.getElementById("high-scores-modal"),ct=document.getElementById("settings-modal"),Re=document.getElementById("high-scores-table"),Fe=document.getElementById("volume-slider"),Ge=document.getElementById("ghost-toggle"),rt=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],dt=5,ut=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],He=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],ft={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},ht={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let L,s,U,A,te,ne,H,oe,S,I,p=!0,m,se,Ee,Y,g,E=[],X,D,G=null,z,P,x,b,w,N,R,T=0;const y={sounds:{},volume:.5,loadSounds:function(){const e=["move","rotate","softDrop","hardDrop","lock","hold","clearLine","clearTetris","levelUp","pause","gameOver"],t=typeof Ke<"u"?"/Tetris/":"/";e.forEach(n=>{const o=new Audio,i=document.createElement("source");i.src=`${t}sounds/${n}.wav`,i.type="audio/wav";const l=document.createElement("source");l.src=`${t}sounds/${n}.mp3`,l.type="audio/mpeg",o.appendChild(i),o.appendChild(l),this.sounds[n]=o})},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(n=>console.error(`Error playing sound ${e}:`,n.message))}}};function mt(){y.loadSounds(),Mt(),xt(),gt(),be(),J()}function gt(){tt.addEventListener("click",()=>de("marathon")),nt.addEventListener("click",()=>de("sprint")),ot.addEventListener("click",()=>de("ultra")),st.addEventListener("click",yt),it.addEventListener("click",Et),pe.addEventListener("click",O),ae.addEventListener("click",Se),et.addEventListener("click",ie),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",ve)}),Fe.addEventListener("input",e=>{b.volume=parseFloat(e.target.value),y.volume=b.volume,De()}),Ge.addEventListener("change",e=>{b.showGhost=e.target.checked,De(),p||_()}),document.addEventListener("keydown",Pt),window.addEventListener("resize",be),Ct()}function J(){k.removeEventListener("click",J),document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden")),ye.classList.remove("hidden"),Z.classList.add("hidden"),he.classList.add("hidden"),T=0,me()}function me(){F.forEach((e,t)=>{t===T?e.classList.add("selected"):e.classList.remove("selected")})}function pt(){ye.classList.add("hidden"),Z.classList.remove("hidden"),be()}function ie(){g&&!m&&!p&&O(),lt.classList.remove("hidden")}function yt(){const e=Re.querySelector("tbody");e&&e.remove();const t=document.createElement("tbody");I.length===0?t.innerHTML='<tr><td colspan="2">No scores yet!</td></tr>':I.forEach((n,o)=>{const i=`<tr><td>${o+1}.</td><td>${n.score}</td></tr>`;t.innerHTML+=i}),Re.appendChild(t),at.classList.remove("hidden")}function Et(){g&&!m&&!p&&O(),ct.classList.remove("hidden")}function ve(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=m;document.querySelectorAll(".modal").forEach(n=>n.classList.add("hidden")),t&&g&&!p&&(m=!1,O())}function be(){const e=window.innerHeight,t=Z.getBoundingClientRect();let n=t.width;if(window.innerWidth<=768){const i=document.getElementById("side-panel"),l=document.getElementById("mobile-header"),r=window.getComputedStyle(Z),f=parseFloat(r.paddingTop),B=parseFloat(r.paddingBottom),c=parseFloat(r.gap),d=window.innerHeight>window.innerWidth?l.offsetHeight+i.offsetHeight+f+B+c:f+B+c,u=e-d,M=Math.floor(u/v),re=Math.floor(t.width*.95/h);P=Math.max(1,Math.min(M,re))}else{n-=252;const i=Math.floor(e*.9/v),l=Math.floor(n*.95/h);P=Math.max(1,Math.min(i,l))}k.width=h*P,k.height=v*P;const o=document.getElementById("side-panel");window.innerWidth>768||window.innerHeight<window.innerWidth?o.style.height=`${k.height}px`:o.style.height="auto",a.scale(P,P),x=Math.floor(P*.7),q.width=4*x,q.height=4*x,ue.scale(x,x),W.width=4*x,W.height=4*x,fe.scale(x,x),U&&Xe(),A&&xe(),L&&(_(),p&&Ve())}function de(e){switch(w=e,pt(),g&&cancelAnimationFrame(g),L=vt(),H=0,oe=0,S=0,p=!1,m=!1,se=0,Ee=1e3,Y=0,g=0,E=[],X=0,D=0,A=null,te=!0,ne=[],he.classList.remove("hidden"),Pe.classList.remove("hidden"),w){case"sprint":N=40,ke.textContent="LINES",Te.textContent="LINES",j.parentElement.classList.add("hidden"),Q.parentElement.classList.add("hidden"),K.parentElement.classList.remove("hidden");break;case"ultra":R=3*60*1e3,ke.textContent="TIME",Te.textContent="TIME",j.parentElement.classList.add("hidden"),Q.parentElement.classList.add("hidden"),K.parentElement.classList.add("hidden");break;case"marathon":default:he.classList.add("hidden"),Pe.classList.add("hidden"),j.parentElement.classList.remove("hidden"),Q.parentElement.classList.remove("hidden"),K.parentElement.classList.remove("hidden");break}qe(),Je(S),ve(),ce(),Be(),$e(),Ie(),xe(),pe.textContent="Pause",ee.textContent="❚❚",ae.classList.remove("hidden"),$.classList.remove("hidden"),Le(0)}function Se(){g&&(cancelAnimationFrame(g),g=0),p=!0,ae.classList.add("hidden"),$.classList.add("hidden"),J()}function Le(e=0){if(p)return;if(g=requestAnimationFrame(Le),m){ze();return}const t=e-Y;if(Y=e,w==="ultra"?(R-=t,R<=0&&(R=0,ge())):w==="sprint"&&N<=0&&ge(),D>0&&(D-=t),E.length>0){if(X-=t,X<=0){let n=E.length;E.sort((o,i)=>o-i).forEach(o=>{L.splice(o,1),L.unshift(Array(h).fill(0))}),E=[],wt(n),Ie()}}else se+=t,se>Ee&&we();p||(ce(),_())}function ge(){p=!0,y.play("gameOver"),kt(),_(),Ve(),cancelAnimationFrame(g),g=0,ae.classList.add("hidden"),$.classList.add("hidden"),k.addEventListener("click",J)}function vt(){return Array.from({length:v},()=>Array(h).fill(0))}function qe(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}ne.push(...e)}function We(){ne.length===0&&qe();const e=ne.shift();return{shape:rt[e],shapeIndex:e}}function Ie(){s={...U,x:Math.floor(h/2)-1,y:0},$e(),z=!1,te=!0,C(s.shape,s.x,s.y)||ge()}function $e(){U=We(),Xe()}function Ue(){if(!te)return;y.play("hold");const e=s.x,t=s.y,n={shape:s.shape,shapeIndex:s.shapeIndex};let o;A?o={...A,x:e,y:t}:o={...We(),x:Math.floor(h/2)-1,y:0},C(o.shape,o.x,o.y)&&(s=o,A=n,te=!1,xe())}function we(){C(s.shape,s.x,s.y+1)?(s.y++,z=!1):Me(),se=0}function le(e){C(s.shape,s.x+e,s.y)&&(s.x+=e,z=!1,y.play("move"))}function Ye(){const e=bt(s.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[n,o]of t)if(C(e,s.x+n,s.y+o)){s.x+=n,s.y+=o,s.shape=e,z=!0,y.play("rotate");return}}function bt(e){return e[0].map((t,n)=>e.map(o=>o[n])).map(t=>t.reverse())}function C(e,t,n){for(let o=0;o<e.length;o++)for(let i=0;i<e[o].length;i++)if(e[o][i]!==0){const l=t+i,r=n+o;if(l<0||l>=h||r>=v||r>=0&&L[r][l]!==0)return!1}return!0}function Me(){const e=Lt();G={shape:s.shape,x:s.x,y:s.y},D=_e,s.shape.forEach((t,n)=>{t.forEach((o,i)=>{o>0&&s.y+n>=0&&(L[s.y+n][s.x+i]=o)})}),It(e),E.length===0&&(e&&(H+=400*(S+1),ce()),Ie()),y.play("lock")}function _(){if(!(!a||!L)){if(a.clearRect(0,0,k.width,k.height),V(a,L,0,0),D>0&&G&&(a.fillStyle=`rgba(255, 255, 255, ${.8*(D/_e)})`,G.shape.forEach((e,t)=>{e.forEach((n,o)=>{n>0&&a.fillRect(G.x+o,G.y+t,1,1)})})),!p&&s){if(b.showGhost){let e=s.y;for(;C(s.shape,s.x,e+1);)e++;St(a,s.shape,s.x,e)}V(a,s.shape,s.x,s.y)}if(E.length>0){const e=Math.abs(Math.sin(X/Ne*Math.PI*2));a.fillStyle=`rgba(255, 255, 255, ${e*.9})`,E.forEach(t=>{a.fillRect(0,t,h,1)})}}}function Xe(){if(ue.clearRect(0,0,q.width,q.height),!U)return;const{shape:e}=U,t=(4-e[0].length)/2,n=(4-e.length)/2;V(ue,e,t,n)}function xe(){if(fe.clearRect(0,0,W.width,W.height),!A)return;const{shape:e}=A,t=(4-e[0].length)/2,n=(4-e.length)/2;V(fe,e,t,n)}function V(e,t,n,o,i){t.forEach((l,r)=>{l.forEach((f,B)=>{if(f>0){if(E.includes(Math.floor(r+o)))return;const c=i||ut[f],d=B+n,u=r+o,M=.1;e.fillStyle=c.dark,e.fillRect(d,u,1,1),e.fillStyle=c.light,e.fillRect(d,u,1-M,1-M),e.fillStyle=c.base,e.fillRect(d+M,u+M,1-M*2,1-M*2)}})})}function St(e,t,n,o){const i=ft;t.forEach((l,r)=>{l.forEach((f,B)=>{if(f>0){const c=B+n,d=r+o,u=.1;e.fillStyle=i.dark,e.fillRect(c,d,1,1),e.fillStyle=i.light,e.fillRect(c,d,1-u,1-u),e.fillStyle=i.base,e.fillRect(c+u,d+u,1-u*2,1-u*2)}})})}function Ve(){V(a,L,0,0,ht),a.fillStyle="rgba(0, 0, 0, 0.75)",a.fillRect(0,0,h,v),a.fillStyle="white",a.textAlign="center";let e="GAME OVER";w==="sprint"&&N<=0&&(e="YOU WIN!"),a.font='1.1px "Press Start 2P"',a.fillText(e,h/2,v/2-1.5),a.font='0.7px "Press Start 2P"',a.fillText("Press any key",h/2,v/2+1),a.fillText("to continue",h/2,v/2+2)}function ze(){a.fillStyle="rgba(0, 0, 0, 0.75)",a.fillRect(0,0,h,v),a.fillStyle="white",a.textAlign="center",a.font='1.5px "Press Start 2P"',a.fillText("PAUSED",h/2,v/2)}function Lt(){if(s.shapeIndex!==dt||!z)return!1;const e=s.x+1,t=s.y+1,n=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let o=0;return n.forEach(([i,l])=>{(l<0||l>=h||i<0||i>=v||L[i][l]!==0)&&o++}),o>=3}function It(e){let t=0;L.forEach((n,o)=>{n.every(i=>i>0)&&(t++,E.push(o))}),t>0&&(X=Ne,H+=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(S+1),y.play(t>=4?"clearTetris":"clearLine"))}function wt(e){const t=S;oe+=e,w==="sprint"&&(N-=e),w==="marathon"&&(S=Math.floor(oe/10),S>t&&(Je(S),y.play("levelUp")),Ee=Math.max(200,1e3-S*75)),ce()}function Je(e){const t=He[e%He.length];document.documentElement.style.setProperty("--accent-color",t)}function ce(){if(je.textContent=H.toString(),Ze.textContent=H.toString(),K.textContent=oe.toString(),j.textContent=S.toString(),Q.textContent=S.toString(),w==="sprint"){const e=Math.max(0,N).toString();Ce.textContent=e,Ae.textContent=e}else if(w==="ultra"){const e=Math.floor(R/6e4),t=Math.floor(R%6e4/1e3),n=`${e}:${t.toString().padStart(2,"0")}`;Ce.textContent=n,Ae.textContent=n}}function Mt(){const e=localStorage.getItem("tetrisSettings");b=e?JSON.parse(e):{volume:.5,showGhost:!0},b.showGhost===void 0&&(b.showGhost=!0),y.volume=b.volume,Fe.value=b.volume.toString(),Ge.checked=b.showGhost}function De(){localStorage.setItem("tetrisSettings",JSON.stringify(b))}function xt(){const e=localStorage.getItem("tetrisHighScores");I=e?JSON.parse(e):[],Be()}function Bt(){localStorage.setItem("tetrisHighScores",JSON.stringify(I))}function kt(){if(w==="sprint"&&N>0)return;const e={score:H,date:new Date().toISOString()};I.push(e),I.sort((t,n)=>n.score-t.score),I=I.slice(0,5),Bt(),Be()}function Be(){Qe.textContent=I.length>0?I[0].score.toString():"0"}function O(){p||E.length>0||document.querySelector(".modal:not(.hidden)")||(m=!m,m?(y.play("pause"),cancelAnimationFrame(g),ze()):(Y=performance.now(),Le(Y)),pe.textContent=m?"Resume":"Pause",ee.textContent=m?"▶":"❚❚")}function Ct(){const e=document.getElementById("mc-left"),t=document.getElementById("mc-right"),n=document.getElementById("mc-down"),o=document.getElementById("mc-rotate"),i=document.getElementById("mc-hard-drop"),l=document.getElementById("mc-hold");if(!e||!t||!n||!o||!i||!l||!ee||!Oe||!$)return;const r=(d=25)=>{"vibrate"in navigator&&navigator.vibrate(d)},f=(d,u)=>re=>{re.preventDefault(),r(),!((m||p||E.length>0||document.querySelector(".modal:not(.hidden)"))&&d!==O&&d!==ie)&&(d(),u&&y.play(u),m||_())},B=()=>{for(;C(s.shape,s.x,s.y+1);)s.y++;Me()},c=(d,u)=>{d.addEventListener("touchstart",u,{passive:!1}),d.addEventListener("mousedown",u,{passive:!1})};c(e,f(()=>le(-1))),c(t,f(()=>le(1))),c(n,f(we,"softDrop")),c(o,f(Ye)),c(l,f(Ue)),c(i,f(B,"hardDrop")),c(ee,f(O)),c(Oe,f(ie)),c($,f(Se))}function Pt(e){const t=e.key.toLowerCase();if(!ye.classList.contains("hidden")){switch(e.preventDefault(),t){case"arrowdown":T=(T+1)%F.length,me();break;case"arrowup":T=(T-1+F.length)%F.length,me();break;case"enter":F[T].click();break}return}if(p){g===0&&J();return}if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),ve());return}if(t==="h"){e.preventDefault(),ie();return}if(t==="p"||t==="escape"){e.preventDefault(),O();return}if(!(m||E.length>0)){switch(t){case"arrowleft":e.preventDefault(),le(-1);break;case"arrowright":e.preventDefault(),le(1);break;case"arrowdown":e.preventDefault(),we(),y.play("softDrop");break;case"arrowup":e.preventDefault(),Ye();break;case"enter":case" ":for(e.preventDefault();C(s.shape,s.x,s.y+1);)s.y++;Me(),y.play("hardDrop");break;case"c":e.preventDefault(),Ue();break;case"q":e.preventDefault(),Se();break}_()}}mt();
