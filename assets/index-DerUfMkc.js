(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function i(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(o){if(o.ep)return;o.ep=!0;const c=i(o);fetch(o.href,c)}})();const a=10,f=20,A=document.getElementById("game-canvas"),r=A.getContext("2d"),L=document.getElementById("next-canvas"),G=L.getContext("2d"),ie=document.getElementById("score"),re=document.getElementById("lines"),le=document.getElementById("level"),ce=document.getElementById("high-score"),S=document.getElementById("start-button"),se=document.getElementById("help-button"),T=document.getElementById("help-modal"),ae=document.querySelector(".close-button"),X=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],fe=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],z=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],D={base:"#555",light:"#888",dark:"#333"},de={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let m,t,B,R,I,p,v,u,d,M,Y,N,g,x,k;function ue(){Se(),S.addEventListener("click",()=>{if(u){q();return}g&&!u?oe():q()}),document.addEventListener("keydown",ke),se.addEventListener("click",Pe),ae.addEventListener("click",U),window.addEventListener("resize",_),_()}function _(){const e=window.innerHeight;x=Math.floor(e*.9/f),A.width=a*x,A.height=f*x,r.scale(x,x),k=Math.floor(x*.7),L.width=4*k,L.height=4*k,G.scale(k,k),B&&J(),u?(w(),Q()):d?(w(),Z()):!g&&m&&w()}function q(){g&&cancelAnimationFrame(g),m=he(),R=0,I=0,p=0,u=!1,d=!1,M=0,Y=1e3,N=0,g=0,te(p),U(),ne(),F(),V(),K(),S.textContent="Pause",j(0)}function he(){return Array.from({length:f},()=>Array(a).fill(0))}function K(){t={...B,x:Math.floor(a/2)-1,y:0},V(),y(t.shape,t.x,t.y)||(u=!0)}function V(){B=ge(),J()}function ge(){const e=Math.floor(Math.random()*X.length);return{shape:X[e]}}function j(e=0){if(g=requestAnimationFrame(j),d){Z();return}if(u){xe(),Q(),cancelAnimationFrame(g),g=0,S.textContent="Start Game";return}const n=e-N;N=e,M+=n,M>Y&&$(),w()}function w(){r.clearRect(0,0,A.width,A.height),O(r,m,0,0);let e=t.y;for(;y(t.shape,t.x,e+1);)e++;pe(r,t.shape,t.x,e),O(r,t.shape,t.x,t.y)}function J(){G.clearRect(0,0,L.width,L.height);const{shape:e}=B,n=(4-e[0].length)/2,i=(4-e.length)/2;O(G,e,n,i)}function O(e,n,i,l,o){n.forEach((c,s)=>{c.forEach((C,P)=>{if(C>0){const b=o||fe[C],h=P+i,H=s+l,E=.1;e.fillStyle=b.dark,e.fillRect(h,H,1,1),e.fillStyle=b.light,e.fillRect(h,H,1-E,1-E),e.fillStyle=b.base,e.fillRect(h+E,H+E,1-E*2,1-E*2)}})})}function pe(e,n,i,l){n.forEach((o,c)=>{o.forEach((s,C)=>{if(s>0){const P=C+i,b=c+l,h=.1;e.fillStyle=D.dark,e.fillRect(P,b,1,1),e.fillStyle=D.light,e.fillRect(P,b,1-h,1-h),e.fillStyle=D.base,e.fillRect(P+h,b+h,1-h*2,1-h*2)}})})}function Q(){O(r,m,0,0,de),r.fillStyle="rgba(0, 0, 0, 0.75)",r.fillRect(0,0,a,f),r.fillStyle="white",r.textAlign="center",r.font='1.1px "Press Start 2P"',r.fillText("GAME OVER",a/2,f/2-1.5),r.font='0.7px "Press Start 2P"',r.fillText("Press Start",a/2,f/2+.5),r.fillText("to Play Again",a/2,f/2+1.5)}function Z(){r.fillStyle="rgba(0, 0, 0, 0.75)",r.fillRect(0,0,a,f),r.fillStyle="white",r.textAlign="center",r.font='1.5px "Press Start 2P"',r.fillText("PAUSED",a/2,f/2)}function $(){y(t.shape,t.x,t.y+1)?t.y++:ee(),M=0}function W(e){y(t.shape,t.x+e,t.y)&&(t.x+=e)}function me(){const e=t.shape,n=ye(e);let i=1;y(n,t.x,t.y)?t.shape=n:y(n,t.x+i,t.y)?(t.x+=i,t.shape=n):y(n,t.x-i,t.y)&&(t.x-=i,t.shape=n)}function ye(e){return e[0].map((i,l)=>e.map(o=>o[l])).map(i=>i.reverse())}function y(e,n,i){for(let l=0;l<e.length;l++)for(let o=0;o<e[l].length;o++)if(e[l][o]!==0){const c=n+o,s=i+l;if(c<0||c>=a||s>=f||s>=0&&m[s][c]!==0)return!1}return!0}function ee(){t.shape.forEach((e,n)=>{e.forEach((i,l)=>{i>0&&t.y+n>=0&&(m[t.y+n][t.x+l]=i)})}),be(),K()}function be(){let e=0;e:for(let n=f-1;n>=0;n--){for(let l=0;l<a;l++)if(m[n][l]===0)continue e;const i=m.splice(n,1)[0].fill(0);m.unshift(i),n++,e++}if(e>0){const n=p;I+=e,R+=[0,100,300,500,800][e]*(p+1),p=Math.floor(I/10),p>n&&te(p),Y=Math.max(200,1e3-p*75),ne()}}function te(e){const n=z[e%z.length];document.documentElement.style.setProperty("--accent-color",n)}function ne(){ie.textContent=R.toString(),re.textContent=I.toString(),le.textContent=p.toString()}function Se(){const e=localStorage.getItem("tetrisHighScore");v=e?parseInt(e,10):0,F()}function Ee(){localStorage.setItem("tetrisHighScore",v.toString())}function xe(){R>v&&(v=R,Ee(),F())}function F(){ce.textContent=v.toString()}function oe(){u||d&&!T.classList.contains("hidden")||(d=!d,S.textContent=d?"Resume":"Pause")}function Pe(){g&&!d&&!u&&(d=!0,S.textContent="Resume"),T.classList.remove("hidden")}function U(){g&&!u&&S.textContent==="Resume"&&(d=!1,S.textContent="Pause"),T.classList.add("hidden")}function ke(e){if(!u&&(e.key==="p"||e.key==="P"||e.key==="Escape")){e.preventDefault(),!T.classList.contains("hidden")&&e.key==="Escape"?U():oe();return}if(!(u||d)){switch(e.key){case"ArrowLeft":e.preventDefault(),W(-1);break;case"ArrowRight":e.preventDefault(),W(1);break;case"ArrowDown":e.preventDefault(),$();break;case"ArrowUp":e.preventDefault(),me();break;case" ":for(e.preventDefault();y(t.shape,t.x,t.y+1);)t.y++;ee();break}w()}}ue();
