(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();const s=10,f=20,A=document.getElementById("game-canvas"),c=A.getContext("2d"),L=document.getElementById("next-canvas"),W=L.getContext("2d"),oe=document.getElementById("score"),re=document.getElementById("lines"),le=document.getElementById("level"),ce=document.getElementById("high-score"),S=document.getElementById("start-button"),se=document.getElementById("help-button"),H=document.getElementById("help-modal"),ae=document.querySelector(".close-button"),U=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],fe=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],X=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],D={base:"#555",light:"#888",dark:"#333"},de={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let m,t,O,v,I,p,R,u,d,M,F,G,g,x,k;function ue(){Se(),S.addEventListener("click",()=>{if(u){_();return}g&&!u?ie():_()}),document.addEventListener("keydown",ke),se.addEventListener("click",Pe),ae.addEventListener("click",Y),window.addEventListener("resize",z),z()}function z(){const e=window.innerHeight;document.body.clientWidth;const n=document.getElementById("game-container"),o=document.getElementById("side-panel");let r=n.clientWidth;window.innerWidth>768&&(r-=o.clientWidth+32);const i=Math.floor(e*.9/f),l=Math.floor(r*.95/s);x=Math.min(i,l),A.width=s*x,A.height=f*x,c.scale(x,x),k=Math.floor(x*.7),L.width=4*k,L.height=4*k,W.scale(k,k),O&&J(),u?(w(),Q()):d?(w(),Z()):!g&&m&&w()}function _(){g&&cancelAnimationFrame(g),m=he(),v=0,I=0,p=0,u=!1,d=!1,M=0,F=1e3,G=0,g=0,te(p),Y(),ne(),N(),V(),K(),S.textContent="Pause",j(0)}function he(){return Array.from({length:f},()=>Array(s).fill(0))}function K(){t={...O,x:Math.floor(s/2)-1,y:0},V(),y(t.shape,t.x,t.y)||(u=!0)}function V(){O=ge(),J()}function ge(){const e=Math.floor(Math.random()*U.length);return{shape:U[e]}}function j(e=0){if(g=requestAnimationFrame(j),d){Z();return}if(u){xe(),Q(),cancelAnimationFrame(g),g=0,S.textContent="Start Game";return}const n=e-G;G=e,M+=n,M>F&&$(),w()}function w(){c.clearRect(0,0,A.width,A.height),B(c,m,0,0);let e=t.y;for(;y(t.shape,t.x,e+1);)e++;pe(c,t.shape,t.x,e),B(c,t.shape,t.x,t.y)}function J(){W.clearRect(0,0,L.width,L.height);const{shape:e}=O,n=(4-e[0].length)/2,o=(4-e.length)/2;B(W,e,n,o)}function B(e,n,o,r,i){n.forEach((l,a)=>{l.forEach((C,P)=>{if(C>0){const b=i||fe[C],h=P+o,T=a+r,E=.1;e.fillStyle=b.dark,e.fillRect(h,T,1,1),e.fillStyle=b.light,e.fillRect(h,T,1-E,1-E),e.fillStyle=b.base,e.fillRect(h+E,T+E,1-E*2,1-E*2)}})})}function pe(e,n,o,r){n.forEach((i,l)=>{i.forEach((a,C)=>{if(a>0){const P=C+o,b=l+r,h=.1;e.fillStyle=D.dark,e.fillRect(P,b,1,1),e.fillStyle=D.light,e.fillRect(P,b,1-h,1-h),e.fillStyle=D.base,e.fillRect(P+h,b+h,1-h*2,1-h*2)}})})}function Q(){B(c,m,0,0,de),c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,s,f),c.fillStyle="white",c.textAlign="center",c.font='1.1px "Press Start 2P"',c.fillText("GAME OVER",s/2,f/2-1.5),c.font='0.7px "Press Start 2P"',c.fillText("Press Start",s/2,f/2+.5),c.fillText("to Play Again",s/2,f/2+1.5)}function Z(){c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,s,f),c.fillStyle="white",c.textAlign="center",c.font='1.5px "Press Start 2P"',c.fillText("PAUSED",s/2,f/2)}function $(){y(t.shape,t.x,t.y+1)?t.y++:ee(),M=0}function q(e){y(t.shape,t.x+e,t.y)&&(t.x+=e)}function me(){const e=t.shape,n=ye(e);let o=1;y(n,t.x,t.y)?t.shape=n:y(n,t.x+o,t.y)?(t.x+=o,t.shape=n):y(n,t.x-o,t.y)&&(t.x-=o,t.shape=n)}function ye(e){return e[0].map((o,r)=>e.map(i=>i[r])).map(o=>o.reverse())}function y(e,n,o){for(let r=0;r<e.length;r++)for(let i=0;i<e[r].length;i++)if(e[r][i]!==0){const l=n+i,a=o+r;if(l<0||l>=s||a>=f||a>=0&&m[a][l]!==0)return!1}return!0}function ee(){t.shape.forEach((e,n)=>{e.forEach((o,r)=>{o>0&&t.y+n>=0&&(m[t.y+n][t.x+r]=o)})}),be(),K()}function be(){let e=0;e:for(let n=f-1;n>=0;n--){for(let r=0;r<s;r++)if(m[n][r]===0)continue e;const o=m.splice(n,1)[0].fill(0);m.unshift(o),n++,e++}if(e>0){const n=p;I+=e,v+=[0,100,300,500,800][e]*(p+1),p=Math.floor(I/10),p>n&&te(p),F=Math.max(200,1e3-p*75),ne()}}function te(e){const n=X[e%X.length];document.documentElement.style.setProperty("--accent-color",n)}function ne(){oe.textContent=v.toString(),re.textContent=I.toString(),le.textContent=p.toString()}function Se(){const e=localStorage.getItem("tetrisHighScore");R=e?parseInt(e,10):0,N()}function Ee(){localStorage.setItem("tetrisHighScore",R.toString())}function xe(){v>R&&(R=v,Ee(),N())}function N(){ce.textContent=R.toString()}function ie(){u||d&&!H.classList.contains("hidden")||(d=!d,S.textContent=d?"Resume":"Pause")}function Pe(){g&&!d&&!u&&(d=!0,S.textContent="Resume"),H.classList.remove("hidden")}function Y(){g&&!u&&S.textContent==="Resume"&&(d=!1,S.textContent="Pause"),H.classList.add("hidden")}function ke(e){if(!u&&(e.key==="p"||e.key==="P"||e.key==="Escape")){e.preventDefault(),!H.classList.contains("hidden")&&e.key==="Escape"?Y():ie();return}if(!(u||d)){switch(e.key){case"ArrowLeft":e.preventDefault(),q(-1);break;case"ArrowRight":e.preventDefault(),q(1);break;case"ArrowDown":e.preventDefault(),$();break;case"ArrowUp":e.preventDefault(),me();break;case" ":for(e.preventDefault();y(t.shape,t.x,t.y+1);)t.y++;ee();break}w()}}ue();
