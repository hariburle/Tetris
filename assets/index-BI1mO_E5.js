(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();const Xe={},h=10,v=20,Oe=300,Re=100,k=document.getElementById("game-canvas"),c=k.getContext("2d"),q=document.getElementById("next-canvas"),re=q.getContext("2d"),W=document.getElementById("hold-canvas"),de=W.getContext("2d"),Ve=document.getElementById("score"),ue=document.getElementById("lines"),K=document.getElementById("level"),ze=document.getElementById("high-score"),Je=document.getElementById("mobile-score"),Ke=document.getElementById("mobile-level"),ge=document.getElementById("pause-button"),ie=document.getElementById("quit-button"),je=document.getElementById("help-button"),j=document.getElementById("game-container"),fe=document.getElementById("mode-display"),xe=document.getElementById("mode-label"),ke=document.getElementById("mode-value"),Q=document.getElementById("mc-pause"),Pe=document.getElementById("mc-help"),$=document.getElementById("mc-quit"),pe=document.getElementById("main-menu"),F=document.querySelectorAll("#menu-button-group button"),Qe=document.getElementById("menu-marathon-button"),Ze=document.getElementById("menu-sprint-button"),et=document.getElementById("menu-ultra-button"),tt=document.getElementById("menu-high-scores-button"),nt=document.getElementById("menu-settings-button"),ot=document.getElementById("help-modal"),st=document.getElementById("high-scores-modal"),it=document.getElementById("settings-modal"),Ce=document.getElementById("high-scores-table"),He=document.getElementById("volume-slider"),De=document.getElementById("ghost-toggle"),lt=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],ct=5,at=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],Te=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],rt={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},dt={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let w,s,U,A,Z,ee,H,te,b,L,p=!0,m,ne,ye,Y,g,E=[],X,D,G=null,z,C,M,S,I,N,R,T=0;const y={sounds:{},volume:.5,loadSounds:function(){const e=["move","rotate","softDrop","hardDrop","lock","hold","clearLine","clearTetris","levelUp","pause","gameOver"],t=typeof Xe<"u"?"/Tetris/":"/";e.forEach(o=>{const n=new Audio,i=document.createElement("source");i.src=`${t}sounds/${o}.wav`,i.type="audio/wav";const l=document.createElement("source");l.src=`${t}sounds/${o}.mp3`,l.type="audio/mpeg",n.appendChild(i),n.appendChild(l),this.sounds[o]=n})},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(o=>console.error(`Error playing sound ${e}:`,o.message))}}};function ut(){y.loadSounds(),wt(),Lt(),ft(),ve(),J()}function ft(){Qe.addEventListener("click",()=>ae("marathon")),Ze.addEventListener("click",()=>ae("sprint")),et.addEventListener("click",()=>ae("ultra")),tt.addEventListener("click",mt),nt.addEventListener("click",gt),ge.addEventListener("click",O),ie.addEventListener("click",Se),je.addEventListener("click",oe),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",Ee)}),He.addEventListener("input",e=>{S.volume=parseFloat(e.target.value),y.volume=S.volume,Ae()}),De.addEventListener("change",e=>{S.showGhost=e.target.checked,Ae(),p||_()}),document.addEventListener("keydown",xt),window.addEventListener("resize",ve),Mt()}function J(){k.removeEventListener("click",J),document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden")),pe.classList.remove("hidden"),j.classList.add("hidden"),fe.classList.add("hidden"),T=0,he()}function he(){F.forEach((e,t)=>{t===T?e.classList.add("selected"):e.classList.remove("selected")})}function ht(){pe.classList.add("hidden"),j.classList.remove("hidden"),ve()}function oe(){g&&!m&&!p&&O(),ot.classList.remove("hidden")}function mt(){const e=Ce.querySelector("tbody");e&&e.remove();const t=document.createElement("tbody");L.length===0?t.innerHTML='<tr><td colspan="2">No scores yet!</td></tr>':L.forEach((o,n)=>{const i=`<tr><td>${n+1}.</td><td>${o.score}</td></tr>`;t.innerHTML+=i}),Ce.appendChild(t),st.classList.remove("hidden")}function gt(){g&&!m&&!p&&O(),it.classList.remove("hidden")}function Ee(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=m;document.querySelectorAll(".modal").forEach(o=>o.classList.add("hidden")),t&&g&&!p&&(m=!1,O())}function ve(){const e=window.innerHeight,t=j.getBoundingClientRect();let o=t.width;if(window.innerWidth<=768){const i=document.getElementById("side-panel"),l=document.getElementById("mobile-header"),r=window.getComputedStyle(j),f=parseFloat(r.paddingTop),x=parseFloat(r.paddingBottom),a=parseFloat(r.gap),d=window.innerHeight>window.innerWidth?l.offsetHeight+i.offsetHeight+f+x+a:f+x+a,u=e-d,B=Math.floor(u/v),ce=Math.floor(t.width*.95/h);C=Math.max(1,Math.min(B,ce))}else{o-=252;const i=Math.floor(e*.9/v),l=Math.floor(o*.95/h);C=Math.max(1,Math.min(i,l))}k.width=h*C,k.height=v*C;const n=document.getElementById("side-panel");window.innerWidth>768||window.innerHeight<window.innerWidth?n.style.height=`${k.height}px`:n.style.height="auto",c.scale(C,C),M=Math.floor(C*.7),q.width=4*M,q.height=4*M,re.scale(M,M),W.width=4*M,W.height=4*M,de.scale(M,M),U&&We(),A&&Be(),w&&(_(),p&&$e())}function ae(e){switch(I=e,ht(),g&&cancelAnimationFrame(g),w=pt(),H=0,te=0,b=0,p=!1,m=!1,ne=0,ye=1e3,Y=0,g=0,E=[],X=0,D=0,A=null,Z=!0,ee=[],fe.classList.remove("hidden"),I){case"sprint":N=40,xe.textContent="LINES",K.parentElement.classList.add("hidden");break;case"ultra":R=3*60*1e3,xe.textContent="TIME",K.parentElement.classList.add("hidden"),ue.parentElement.classList.add("hidden");break;case"marathon":default:fe.classList.add("hidden"),K.parentElement.classList.remove("hidden"),ue.parentElement.classList.remove("hidden");break}Ne(),Ye(b),Ee(),le(),Me(),Fe(),we(),Be(),ge.textContent="Pause",Q.textContent="❚❚",ie.classList.remove("hidden"),$.classList.remove("hidden"),be(0)}function Se(){g&&(cancelAnimationFrame(g),g=0),p=!0,ie.classList.add("hidden"),$.classList.add("hidden"),J()}function be(e=0){if(p)return;if(g=requestAnimationFrame(be),m){Ue();return}const t=e-Y;if(Y=e,I==="ultra"?(R-=t,R<=0&&(R=0,me())):I==="sprint"&&N<=0&&me(),D>0&&(D-=t),E.length>0){if(X-=t,X<=0){let o=E.length;E.sort((n,i)=>n-i).forEach(n=>{w.splice(n,1),w.unshift(Array(h).fill(0))}),E=[],bt(o),we()}}else ne+=t,ne>ye&&Le();p||(le(),_())}function me(){p=!0,y.play("gameOver"),Bt(),_(),$e(),cancelAnimationFrame(g),g=0,ie.classList.add("hidden"),$.classList.add("hidden"),k.addEventListener("click",J)}function pt(){return Array.from({length:v},()=>Array(h).fill(0))}function Ne(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}ee.push(...e)}function _e(){ee.length===0&&Ne();const e=ee.shift();return{shape:lt[e],shapeIndex:e}}function we(){s={...U,x:Math.floor(h/2)-1,y:0},Fe(),z=!1,Z=!0,P(s.shape,s.x,s.y)||me()}function Fe(){U=_e(),We()}function Ge(){if(!Z)return;y.play("hold");const e=s.x,t=s.y,o={shape:s.shape,shapeIndex:s.shapeIndex};let n;A?n={...A,x:e,y:t}:n={..._e(),x:Math.floor(h/2)-1,y:0},P(n.shape,n.x,n.y)&&(s=n,A=o,Z=!1,Be())}function Le(){P(s.shape,s.x,s.y+1)?(s.y++,z=!1):Ie(),ne=0}function se(e){P(s.shape,s.x+e,s.y)&&(s.x+=e,z=!1,y.play("move"))}function qe(){const e=yt(s.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[o,n]of t)if(P(e,s.x+o,s.y+n)){s.x+=o,s.y+=n,s.shape=e,z=!0,y.play("rotate");return}}function yt(e){return e[0].map((t,o)=>e.map(n=>n[o])).map(t=>t.reverse())}function P(e,t,o){for(let n=0;n<e.length;n++)for(let i=0;i<e[n].length;i++)if(e[n][i]!==0){const l=t+i,r=o+n;if(l<0||l>=h||r>=v||r>=0&&w[r][l]!==0)return!1}return!0}function Ie(){const e=vt();G={shape:s.shape,x:s.x,y:s.y},D=Re,s.shape.forEach((t,o)=>{t.forEach((n,i)=>{n>0&&s.y+o>=0&&(w[s.y+o][s.x+i]=n)})}),St(e),E.length===0&&(e&&(H+=400*(b+1),le()),we()),y.play("lock")}function _(){if(!(!c||!w)){if(c.clearRect(0,0,k.width,k.height),V(c,w,0,0),D>0&&G&&(c.fillStyle=`rgba(255, 255, 255, ${.8*(D/Re)})`,G.shape.forEach((e,t)=>{e.forEach((o,n)=>{o>0&&c.fillRect(G.x+n,G.y+t,1,1)})})),!p&&s){if(S.showGhost){let e=s.y;for(;P(s.shape,s.x,e+1);)e++;Et(c,s.shape,s.x,e)}V(c,s.shape,s.x,s.y)}if(E.length>0){const e=Math.abs(Math.sin(X/Oe*Math.PI*2));c.fillStyle=`rgba(255, 255, 255, ${e*.9})`,E.forEach(t=>{c.fillRect(0,t,h,1)})}}}function We(){if(re.clearRect(0,0,q.width,q.height),!U)return;const{shape:e}=U,t=(4-e[0].length)/2,o=(4-e.length)/2;V(re,e,t,o)}function Be(){if(de.clearRect(0,0,W.width,W.height),!A)return;const{shape:e}=A,t=(4-e[0].length)/2,o=(4-e.length)/2;V(de,e,t,o)}function V(e,t,o,n,i){t.forEach((l,r)=>{l.forEach((f,x)=>{if(f>0){if(E.includes(Math.floor(r+n)))return;const a=i||at[f],d=x+o,u=r+n,B=.1;e.fillStyle=a.dark,e.fillRect(d,u,1,1),e.fillStyle=a.light,e.fillRect(d,u,1-B,1-B),e.fillStyle=a.base,e.fillRect(d+B,u+B,1-B*2,1-B*2)}})})}function Et(e,t,o,n){const i=rt;t.forEach((l,r)=>{l.forEach((f,x)=>{if(f>0){const a=x+o,d=r+n,u=.1;e.fillStyle=i.dark,e.fillRect(a,d,1,1),e.fillStyle=i.light,e.fillRect(a,d,1-u,1-u),e.fillStyle=i.base,e.fillRect(a+u,d+u,1-u*2,1-u*2)}})})}function $e(){V(c,w,0,0,dt),c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,h,v),c.fillStyle="white",c.textAlign="center";let e="GAME OVER";I==="sprint"&&N<=0&&(e="YOU WIN!"),c.font='1.1px "Press Start 2P"',c.fillText(e,h/2,v/2-1.5),c.font='0.7px "Press Start 2P"',c.fillText("Press any key",h/2,v/2+1),c.fillText("to continue",h/2,v/2+2)}function Ue(){c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,h,v),c.fillStyle="white",c.textAlign="center",c.font='1.5px "Press Start 2P"',c.fillText("PAUSED",h/2,v/2)}function vt(){if(s.shapeIndex!==ct||!z)return!1;const e=s.x+1,t=s.y+1,o=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let n=0;return o.forEach(([i,l])=>{(l<0||l>=h||i<0||i>=v||w[i][l]!==0)&&n++}),n>=3}function St(e){let t=0;w.forEach((o,n)=>{o.every(i=>i>0)&&(t++,E.push(n))}),t>0&&(X=Oe,H+=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(b+1),y.play(t>=4?"clearTetris":"clearLine"))}function bt(e){const t=b;te+=e,I==="sprint"&&(N-=e),I==="marathon"&&(b=Math.floor(te/10),b>t&&(Ye(b),y.play("levelUp")),ye=Math.max(200,1e3-b*75)),le()}function Ye(e){const t=Te[e%Te.length];document.documentElement.style.setProperty("--accent-color",t)}function le(){if(Ve.textContent=H.toString(),Je.textContent=H.toString(),ue.textContent=te.toString(),K.textContent=b.toString(),Ke.textContent=b.toString(),I==="sprint")ke.textContent=Math.max(0,N).toString();else if(I==="ultra"){const e=Math.floor(R/6e4),t=Math.floor(R%6e4/1e3);ke.textContent=`${e}:${t.toString().padStart(2,"0")}`}}function wt(){const e=localStorage.getItem("tetrisSettings");S=e?JSON.parse(e):{volume:.5,showGhost:!0},S.showGhost===void 0&&(S.showGhost=!0),y.volume=S.volume,He.value=S.volume.toString(),De.checked=S.showGhost}function Ae(){localStorage.setItem("tetrisSettings",JSON.stringify(S))}function Lt(){const e=localStorage.getItem("tetrisHighScores");L=e?JSON.parse(e):[],Me()}function It(){localStorage.setItem("tetrisHighScores",JSON.stringify(L))}function Bt(){if(I==="sprint"&&N>0)return;const e={score:H,date:new Date().toISOString()};L.push(e),L.sort((t,o)=>o.score-t.score),L=L.slice(0,5),It(),Me()}function Me(){ze.textContent=L.length>0?L[0].score.toString():"0"}function O(){p||E.length>0||document.querySelector(".modal:not(.hidden)")||(m=!m,m?(y.play("pause"),cancelAnimationFrame(g),Ue()):(Y=performance.now(),be(Y)),ge.textContent=m?"Resume":"Pause",Q.textContent=m?"▶":"❚❚")}function Mt(){const e=document.getElementById("mc-left"),t=document.getElementById("mc-right"),o=document.getElementById("mc-down"),n=document.getElementById("mc-rotate"),i=document.getElementById("mc-hard-drop"),l=document.getElementById("mc-hold");if(!e||!t||!o||!n||!i||!l||!Q||!Pe||!$)return;const r=(d=25)=>{"vibrate"in navigator&&navigator.vibrate(d)},f=(d,u)=>ce=>{ce.preventDefault(),r(),!((m||p||E.length>0||document.querySelector(".modal:not(.hidden)"))&&d!==O&&d!==oe)&&(d(),u&&y.play(u),m||_())},x=()=>{for(;P(s.shape,s.x,s.y+1);)s.y++;Ie()},a=(d,u)=>{d.addEventListener("touchstart",u,{passive:!1}),d.addEventListener("mousedown",u,{passive:!1})};a(e,f(()=>se(-1))),a(t,f(()=>se(1))),a(o,f(Le,"softDrop")),a(n,f(qe)),a(l,f(Ge)),a(i,f(x,"hardDrop")),a(Q,f(O)),a(Pe,f(oe)),a($,f(Se))}function xt(e){const t=e.key.toLowerCase();if(!pe.classList.contains("hidden")){switch(e.preventDefault(),t){case"arrowdown":T=(T+1)%F.length,he();break;case"arrowup":T=(T-1+F.length)%F.length,he();break;case"enter":F[T].click();break}return}if(p){g===0&&J();return}if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),Ee());return}if(t==="h"){e.preventDefault(),oe();return}if(t==="p"||t==="escape"){e.preventDefault(),O();return}if(!(m||E.length>0)){switch(t){case"arrowleft":e.preventDefault(),se(-1);break;case"arrowright":e.preventDefault(),se(1);break;case"arrowdown":e.preventDefault(),Le(),y.play("softDrop");break;case"arrowup":e.preventDefault(),qe();break;case"enter":case" ":for(e.preventDefault();P(s.shape,s.x,s.y+1);)s.y++;Ie(),y.play("hardDrop");break;case"c":e.preventDefault(),Ge();break;case"q":e.preventDefault(),Se();break}_()}}ut();
