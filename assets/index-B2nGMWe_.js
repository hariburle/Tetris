(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const mt={},y=10,k=20,Je=300,Ke=100,gt=8,L=document.getElementById("game-canvas"),g=L.getContext("2d"),Z=document.getElementById("next-canvas"),Be=Z.getContext("2d"),ee=document.getElementById("hold-canvas"),ke=ee.getContext("2d"),xe=document.getElementById("score"),_=document.getElementById("lines"),he=document.getElementById("level"),pt=document.getElementById("high-score"),ce=document.getElementById("pause-button"),U=document.getElementById("quit-button"),Ae=document.getElementById("help-button"),Oe=document.getElementById("game-container"),J=document.getElementById("mode-display"),Ie=document.getElementById("mode-label"),we=document.getElementById("mode-value"),je=document.getElementById("game-mode-display-desktop-container"),vt=document.getElementById("game-mode-display-desktop"),pe=document.getElementById("mc-pause"),qe=document.getElementById("mc-help"),te=document.getElementById("mc-quit"),De=document.getElementById("main-menu"),K=document.querySelectorAll("#menu-button-group button"),yt=document.getElementById("menu-marathon-button"),Et=document.getElementById("menu-sprint-button"),St=document.getElementById("menu-ultra-button"),bt=document.getElementById("menu-puzzle-button"),Lt=document.getElementById("menu-survival-button"),Mt=document.getElementById("menu-avalanche-button"),It=document.getElementById("menu-high-scores-button"),wt=document.getElementById("menu-settings-button"),Bt=document.getElementById("menu-help-button"),kt=document.getElementById("help-modal"),xt=document.getElementById("high-scores-modal"),Ct=document.getElementById("settings-modal"),Tt=document.getElementById("game-over-modal"),Pt=document.getElementById("game-over-title"),At=document.getElementById("game-over-score"),Ot=document.getElementById("game-over-high-score"),Dt=document.getElementById("game-over-restart-button"),Rt=document.getElementById("game-over-menu-button"),Ce=document.getElementById("high-scores-table"),Ue=document.getElementById("high-scores-tabs"),Qe=document.getElementById("volume-slider"),Ze=document.getElementById("ghost-style-select"),zt=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],Nt=5,Re=3,Ht=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"},{base:"#757575",light:"#a4a4a4",dark:"#494949"}],$e=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],_t={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},Wt={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"},Gt={marathon:"Classic",sprint:"Sprint (40L)",ultra:"Ultra (3 Min)",puzzle:"Puzzle",survival:"Survival",avalanche:"Avalanche"};let m,a,ne,N,ve,ye,$,F,T,O,c=!0,p,Ee,ze,W,I,h=[],oe,X,j=null,de,P,C,w,l,z=0,A=0,et=0,tt=0,nt=0,Y,ue,G,H,me,Q,ge,M,se;const E={sounds:{},volume:.5,loadSounds:function(){console.log("Attempting to load sound files...");const e=["clearLine","clearTetris","gameOver","hardDrop","levelUp","lock","combo","move","rotate","softDrop","hold","pause"],t=typeof mt<"u"?"/Tetris/":"/";e.forEach(n=>{console.log(`- Loading sound: ${n}`);const o=new Audio,s=document.createElement("source");s.src=`${t}sounds/${n}.wav`,s.type="audio/wav";const i=document.createElement("source");i.src=`${t}sounds/${n}.mp3`,i.type="audio/mpeg",o.appendChild(s),o.appendChild(i),this.sounds[n]=o}),console.log("Sound loading finished.")},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(n=>console.error(`Error playing sound ${e}:`,n.message))}}};function Ft(){E.loadSounds(),tn(),nn(),Xt(),He(),ot()}function Xt(){yt.addEventListener("click",()=>R("marathon")),Et.addEventListener("click",()=>R("sprint")),St.addEventListener("click",()=>R("ultra")),bt.addEventListener("click",()=>R("puzzle")),Lt.addEventListener("click",()=>R("survival")),Mt.addEventListener("click",()=>R("avalanche")),It.addEventListener("click",Ut),wt.addEventListener("click",$t),Bt.addEventListener("click",ae),ce.addEventListener("click",D),U.addEventListener("click",Se),Ae.addEventListener("click",ae),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",Ne)}),Dt.addEventListener("click",()=>R(l)),Rt.addEventListener("click",Se),Qe.addEventListener("input",e=>{w.volume=parseFloat(e.target.value),E.volume=w.volume,Ve()}),Ze.addEventListener("change",e=>{w.ghostStyle=e.target.value,Ve(),c||B()}),document.addEventListener("keydown",un),window.addEventListener("resize",He),an(),ln(),dn()}function ot(){document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden")),De.classList.remove("hidden"),Oe.classList.add("hidden"),J.classList.add("hidden"),je.classList.add("hidden"),z=0,Te()}function Te(){K.forEach((e,t)=>{t===z?e.classList.add("selected"):e.classList.remove("selected")})}function qt(){De.classList.add("hidden"),Oe.classList.remove("hidden"),He()}function ae(){I&&!p&&!c&&D(),kt.classList.remove("hidden")}function Ut(){const e=Object.keys(O),t=[{id:"marathon",name:"Classic"},{id:"sprint",name:"Sprint"},{id:"ultra",name:"Ultra"},{id:"puzzle",name:"Puzzle"},{id:"survival",name:"Survival"},{id:"avalanche",name:"Avalanche"}];Ue.innerHTML="";let n=!1;t.forEach(o=>{if(e.includes(o.id)){const s=document.createElement("button");s.className="hs-tab-btn",s.textContent=o.name,s.dataset.mode=o.id,s.addEventListener("click",()=>Ye(o.id)),Ue.appendChild(s),n||(s.classList.add("active"),Ye(o.id),n=!0)}}),n||(Ce.innerHTML='<tbody><tr><td colspan="2">No scores yet!</td></tr></tbody>'),xt.classList.remove("hidden")}function Ye(e){document.querySelectorAll(".hs-tab-btn").forEach(s=>{s.classList.toggle("active",s.dataset.mode===e)});const t=O[e]||[],n=Ce.querySelector("tbody");n&&n.remove();const o=document.createElement("tbody");t.length===0?o.innerHTML='<tr><td colspan="2">No scores for this mode!</td></tr>':t.forEach((s,i)=>{const r=e==="sprint"?re(s.score):s.score.toString(),d=`<tr><td>${i+1}.</td><td>${r}</td></tr>`;o.innerHTML+=d}),Ce.appendChild(o)}function $t(){I&&!p&&!c&&D(),Ct.classList.remove("hidden")}function Ne(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=p;document.querySelectorAll(".modal").forEach(n=>n.classList.add("hidden")),t&&I&&!c&&(p=!1,D())}function He(){const e=window.innerWidth<=768,t=window.innerHeight>window.innerWidth;if(e&&t){const o=document.getElementById("side-panel"),s=document.getElementById("mobile-controls");o.style.width="90px";const i=o.offsetWidth,r=s.offsetHeight,d=20,b=16,u=window.innerHeight-r-d,f=window.innerWidth-i-b,v=Math.floor(u/k),S=Math.floor(f/y);P=Math.max(1,Math.min(v,S)),C=Math.floor(P*.8)}else{const o=window.innerHeight;let i=Oe.getBoundingClientRect().width;e||(i-=252);const r=Math.floor(o*.9/k),d=Math.floor(i*.95/y);P=Math.max(1,Math.min(r,d)),C=Math.floor(P*.7)}L.width=y*P,L.height=k*P,g.scale(P,P);const n=document.getElementById("side-panel");!e||!t?n.style.height=`${L.height}px`:n.style.height="auto",Z.width=4*C,Z.height=4*C,Be.scale(C,C),ee.width=4*C,ee.height=4*C,ke.scale(C,C),ne&&lt(),N&&Fe(),m&&(B(),c&&rt())}function R(e){l=e,qt(),I&&cancelAnimationFrame(I),m=Yt(),$=0,F=0,T=0,c=!1,p=!1,Ee=0,ze=1e3,W=0,I=0,h=[],oe=0,X=0,N=null,ve=!0,ye=[],M=!1,se=0,A=0;const t=Gt[l];switch(vt.textContent=t,je.classList.remove("hidden"),xe.parentElement.classList.remove("hidden"),he.parentElement.classList.remove("hidden"),_.parentElement.classList.remove("hidden"),J.classList.add("hidden"),_.previousElementSibling.textContent="LINES",l){case"sprint":Y=40,ue=0,Ie.textContent="TIME",J.classList.remove("hidden"),_.previousElementSibling.textContent="LINES LEFT",he.parentElement.classList.add("hidden"),xe.parentElement.classList.add("hidden");break;case"ultra":G=3*60*1e3,Ie.textContent="TIME",J.classList.remove("hidden"),he.parentElement.classList.add("hidden"),_.parentElement.classList.add("hidden");break;case"puzzle":H=50,Ie.textContent="TURNS",J.classList.remove("hidden");break;case"survival":Q=1e4,me=Q,ge=1;break}st(),ft(T),Ne(),V(),Xe(),it(),be(),Fe(),ce.textContent="Pause",pe.textContent="❚❚",U.classList.remove("hidden"),te.classList.remove("hidden"),_e(0)}function Se(){I&&(cancelAnimationFrame(I),I=0),c=!0,U.classList.add("hidden"),te.classList.add("hidden"),ot()}function _e(e=0){if(c)return;if(I=requestAnimationFrame(_e),p){ct();return}const t=W===0?0:e-W;if(W=e,l==="sprint"?(ue+=t,Y<=0&&ie()):l==="ultra"?(G-=t,G<=0&&(G=0,ie())):l==="survival"&&!M&&(me-=t,me<=0&&(Qt(ge),Q=Math.max(3e3,Q*.97),F>30&&F%10===0&&(ge=Math.min(4,ge+1)),me=Q)),X>0&&(X-=t),h.length>0){if(oe-=t,oe<=0)if(l==="avalanche")Zt();else{let n=h.length;h.sort((o,s)=>o-s).forEach(o=>{m.splice(o,1),m.unshift(Array(y).fill(0))}),h=[],ut(n),c||be()}}else M||(Ee+=t,Ee>ze&&Le());c||(V(),B())}function ie(){c||(c=!0,E.play("gameOver"),sn(),rt(),Kt(),cancelAnimationFrame(I),I=0,U.classList.add("hidden"),te.classList.add("hidden"))}function Yt(){return Array.from({length:k},()=>Array(y).fill(0))}function st(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}ye.push(...e)}function at(){ye.length===0&&st();const e=ye.shift();return{shape:zt[e],shapeIndex:e}}function be(){a={...ne,x:Math.floor(y/2)-1,y:0},it(),de=!1,ve=!0,x(a.shape,a.x,a.y)||ie()}function it(){ne=at(),lt()}function We(){l!=="puzzle"||c||H>0&&(H--,V(),H<=0&&setTimeout(()=>ie(),100))}function Ge(){if(!ve||c||l==="puzzle"&&H<=0||(E.play("hold"),l==="puzzle"&&We(),c))return;const e=a.x,t=a.y,n={shape:a.shape,shapeIndex:a.shapeIndex};let o;N?o={...N,x:e,y:t}:o={...at(),x:Math.floor(y/2)-1,y:0},x(o.shape,o.x,o.y)&&(a=o,N=n,ve=!1,Fe(),V())}function Le(){c||(x(a.shape,a.x,a.y+1)?(a.y++,de=!1):fe(),Ee=0)}function q(e){c||x(a.shape,a.x+e,a.y)&&(a.x+=e,de=!1,E.play("move"))}function Me(){if(c||l==="puzzle"&&a.shapeIndex===Re)return;const e=Vt(a.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[n,o]of t)if(x(e,a.x+n,a.y+o)){a.x+=n,a.y+=o,a.shape=e,de=!0,l==="puzzle"&&We(),E.play("rotate");return}}function Vt(e){return e[0].map((t,n)=>e.map(o=>o[n])).map(t=>t.reverse())}function x(e,t,n){for(let o=0;o<e.length;o++)for(let s=0;s<e[o].length;s++)if(e[o][s]!==0){const i=t+s,r=n+o;if(i<0||i>=y||r>=k||r>=0&&m[r][i]!==0)return!1}return!0}function fe(){const e=jt();j={shape:a.shape,x:a.x,y:a.y},X=Ke,a.shape.forEach((t,n)=>{t.forEach((o,s)=>{o>0&&a.y+n>=0&&(m[a.y+n][a.x+s]=o)})}),l==="puzzle"&&We(),dt(e),h.length===0&&!c&&(e&&($+=400*(T+1),V()),be()),E.play("lock")}function B(){if(!(!g||!m)){if(g.clearRect(0,0,L.width,L.height),le(g,m,0,0),X>0&&j&&(g.fillStyle=`rgba(255, 255, 255, ${.8*(X/Ke)})`,j.shape.forEach((e,t)=>{e.forEach((n,o)=>{n>0&&g.fillRect(j.x+o,j.y+t,1,1)})})),!c&&a&&!M){if(w.ghostStyle!=="off"){let e=a.y;for(;x(a.shape,a.x,e+1);)e++;Jt(g,a.shape,a.x,e,w.ghostStyle)}le(g,a.shape,a.x,a.y)}if(h.length>0){const e=Math.abs(Math.sin(oe/Je*Math.PI*2));g.fillStyle=`rgba(255, 255, 255, ${e*.9})`,h.forEach(t=>{g.fillRect(0,t,y,1)})}}}function lt(){if(Be.clearRect(0,0,Z.width,Z.height),!ne)return;const{shape:e,shapeIndex:t}=ne,n=(4-e[0].length)/2;let o=(4-e.length)/2;t!==Re&&(o+=.5),le(Be,e,n,o)}function Fe(){if(ke.clearRect(0,0,ee.width,ee.height),!N)return;const{shape:e,shapeIndex:t}=N,n=(4-e[0].length)/2;let o=(4-e.length)/2;t!==Re&&(o+=.5),le(ke,e,n,o)}function le(e,t,n,o,s){t.forEach((i,r)=>{i.forEach((d,b)=>{if(d>0){if(h.includes(Math.floor(r+o)))return;const u=s||Ht[d],f=b+n,v=r+o,S=.1;e.fillStyle=u.dark,e.fillRect(f,v,1,1),e.fillStyle=u.light,e.fillRect(f,v,1-S,1-S),e.fillStyle=u.base,e.fillRect(f+S,v+S,1-S*2,1-S*2)}})})}function Jt(e,t,n,o,s){if(s==="solid"){const i=_t;t.forEach((r,d)=>{r.forEach((b,u)=>{if(b>0){const f=u+n,v=d+o,S=.1;e.fillStyle=i.dark,e.fillRect(f,v,1,1),e.fillStyle=i.light,e.fillRect(f,v,1-S,1-S),e.fillStyle=i.base,e.fillRect(f+S,v+S,1-S*2,1-S*2)}})})}else s==="outline"&&(e.strokeStyle="rgba(255, 255, 255, 0.6)",e.lineWidth=.1,t.forEach((i,r)=>{i.forEach((d,b)=>{if(d>0){const u=b+n,f=r+o,v=e.lineWidth/2;e.strokeRect(u+v,f+v,1-e.lineWidth,1-e.lineWidth)}})}))}function rt(){le(g,m,0,0,Wt),g.fillStyle="rgba(0, 0, 0, 0.75)",g.fillRect(0,0,y,k)}function Kt(){let e="GAME OVER";l==="sprint"&&Y<=0?e="YOU WIN!":l==="puzzle"&&H<=0&&(e="OUT OF TURNS"),Pt.textContent=e;const t=l==="sprint"?re(ue):$.toString();At.textContent=t;const n=O[l]||[];let o=l==="sprint"?"N/A":"0";n.length>0&&(o=l==="sprint"?re(n[0].score):n[0].score.toString()),Ot.textContent=o,Tt.classList.remove("hidden")}function ct(){g.fillStyle="rgba(0, 0, 0, 0.75)",g.fillRect(0,0,y,k),g.fillStyle="white",g.textAlign="center",g.font='1.5px "Press Start 2P"',g.fillText("PAUSED",y/2,k/2)}function jt(){if(l==="avalanche"||a.shapeIndex!==Nt||!de)return!1;const e=a.x+1,t=a.y+1,n=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let o=0;return n.forEach(([s,i])=>{(i<0||i>=y||s<0||s>=k||m[s][i]!==0)&&o++}),o>=3}function dt(e){let t=0;if(m.forEach((n,o)=>{n.every(s=>s>0)&&(t++,h.push(o))}),t>0){l==="avalanche"&&(M=!0),oe=Je;let s=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(T+1);l==="avalanche"&&se>0&&(s*=1+se*.5,E.play("combo")),$+=Math.round(s),E.play(t>=4?"clearTetris":"clearLine")}}function ut(e){const t=T;F+=e,l==="sprint"&&(Y-=e),(l==="marathon"||l==="survival"||l==="avalanche"||l==="puzzle")&&(T=Math.floor(F/10),T>t&&(ft(T),E.play("levelUp")),l!=="avalanche"&&(ze=Math.max(200,1e3-T*75))),V()}function ft(e){const t=$e[e%$e.length];document.documentElement.style.setProperty("--accent-color",t)}function re(e){const t=e/1e3,n=Math.floor(t/60),o=Math.floor(t%60),s=Math.floor(e%1e3);return`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}.${s.toString().padStart(3,"0")}`}function V(){const e=(t,n)=>{if(t.textContent!==n){t.textContent=n;const o=t.parentElement;if(o.classList.contains("stat-update"))return;o.classList.add("stat-update"),o.addEventListener("animationend",()=>o.classList.remove("stat-update"),{once:!0})}};if(e(xe,$.toString()),e(_,F.toString()),e(he,T.toString()),l==="sprint"){const t=re(ue);we.textContent=t,_.textContent=Math.max(0,Y).toString()}else if(l==="ultra"){const t=Math.floor(G/6e4),n=Math.floor(G%6e4/1e3),o=`${t}:${n.toString().padStart(2,"0")}`;we.textContent=o}else if(l==="puzzle"){const t=Math.max(0,H).toString();we.textContent=t}}function Qt(e){for(let n=0;n<e;n++)for(let o=0;o<y;o++)if(m[n][o]!==0){ie();return}m.splice(0,e);const t=Math.floor(Math.random()*y);for(let n=0;n<e;n++){const o=Array(y).fill(gt).map((s,i)=>i===t?0:s);m.push(o)}}function Zt(){se++;const e=h.length;h.forEach(t=>{for(let n=0;n<y;n++)m[t][n]=0}),h=[],en(),ut(e),m.forEach((t,n)=>{t.every(o=>o>0)&&h.push(n)}),h.length>0?dt(!1):(M=!1,se=0,be()),B()}function en(){for(let e=0;e<y;e++){let t=k-1;for(let n=k-1;n>=0;n--)m[n][e]!==0&&(n!==t&&(m[t][e]=m[n][e],m[n][e]=0),t--)}}function tn(){const e=localStorage.getItem("tetrisSettings"),t=e?JSON.parse(e):null,n={volume:.5,ghostStyle:"solid"};t?(typeof t.showGhost<"u"&&(t.ghostStyle=t.showGhost?"solid":"off",delete t.showGhost),w={...n,...t}):w=n,E.volume=w.volume,Qe.value=w.volume.toString(),Ze.value=w.ghostStyle}function Ve(){localStorage.setItem("tetrisSettings",JSON.stringify(w))}function nn(){const e=localStorage.getItem("tetrisHighScores");O=e?JSON.parse(e):{},Xe()}function on(){localStorage.setItem("tetrisHighScores",JSON.stringify(O))}function sn(){if(l==="sprint"&&Y>0)return;const t={score:l==="sprint"?ue:$,date:new Date().toISOString()},n=O[l]||[];n.push(t),l==="sprint"?n.sort((o,s)=>o.score-s.score):n.sort((o,s)=>s.score-o.score),O[l]=n.slice(0,5),on(),Xe()}function Xe(){if(!l)return;const e=O[l];let t="0";e&&e.length>0&&(t=l==="sprint"?re(e[0].score):e[0].score.toString()),pt.textContent=t}function D(){c||h.length>0||document.querySelector(".modal:not(.hidden)")||(p=!p,p?(E.play("pause"),cancelAnimationFrame(I),A=0,Pe(),ct()):(W=performance.now(),_e(W)),ce.textContent=p?"Resume":"Pause",pe.textContent=p?"▶":"❚❚")}function Pe(){[ce,U,Ae].forEach((t,n)=>{n===A&&t.focus()})}function an(){const e=document.getElementById("mc-left"),t=document.getElementById("mc-right"),n=document.getElementById("mc-down"),o=document.getElementById("mc-rotate"),s=document.getElementById("mc-hard-drop"),i=document.getElementById("mc-hold");if(!e||!t||!n||!o||!s||!i||!pe||!qe||!te)return;const r=(f=25)=>{"vibrate"in navigator&&navigator.vibrate(f)},d=(f,v)=>ht=>{ht.preventDefault(),r(),!((p||c||h.length>0||M||document.querySelector(".modal:not(.hidden)"))&&f!==D&&f!==ae)&&(f(),v&&E.play(v),p||B())},b=()=>{for(;x(a.shape,a.x,a.y+1);)a.y++;fe()},u=(f,v)=>{f.addEventListener("touchstart",v,{passive:!1}),f.addEventListener("mousedown",v,{passive:!1})};u(e,d(()=>q(-1))),u(t,d(()=>q(1))),u(n,d(Le,"softDrop")),u(o,d(Me)),u(i,d(Ge)),u(s,d(b,"hardDrop")),u(pe,d(D)),u(qe,d(ae)),u(te,d(Se))}function ln(){L.addEventListener("touchstart",rn,{passive:!1}),L.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}),L.addEventListener("touchend",cn,{passive:!1})}function rn(e){e.preventDefault(),et=e.touches[0].clientX,tt=e.touches[0].clientY,nt=performance.now()}function cn(e){if(e.preventDefault(),p||c||h.length>0||M||document.querySelector(".modal:not(.hidden)"))return;const t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,o=performance.now()-nt,s=t-et,i=n-tt,r=30,d=200,b=10,u=1;if(o<d&&Math.abs(s)<b&&Math.abs(i)<b)Me();else if(Math.abs(s)>Math.abs(i))s>r?q(1):s<-r&&q(-1);else if(i>r)if(i/o>u){for(;x(a.shape,a.x,a.y+1);)a.y++;fe(),E.play("hardDrop")}else Le(),E.play("softDrop");B()}function dn(){if("ontouchstart"in window||navigator.maxTouchPoints>0)return;let t=-1;const n=r=>{if(p||c||h.length>0||M||!a)return;const d=L.getBoundingClientRect(),b=r.clientX-d.left,u=Math.floor(b/P)-Math.floor(a.shape[0].length/2);if(u!==t){const f=u;x(a.shape,f,a.y)&&(a.x=f,B()),t=u}},o=r=>{if(!(p||c||h.length>0||M)&&(r.preventDefault(),r.button===0)){for(;x(a.shape,a.x,a.y+1);)a.y++;fe(),E.play("hardDrop"),B()}},s=r=>{p||c||h.length>0||M||(r.preventDefault(),Ge(),B())},i=r=>{p||c||h.length>0||M||(r.preventDefault(),Me(),B())};L.addEventListener("mousemove",n),L.addEventListener("click",o),L.addEventListener("contextmenu",s),L.addEventListener("wheel",i,{passive:!1})}function un(e){const t=e.key.toLowerCase();if(!De.classList.contains("hidden")){switch(e.preventDefault(),t){case"arrowdown":z=(z+1)%K.length,Te();break;case"arrowup":z=(z-1+K.length)%K.length,Te();break;case"enter":K[z].click();break}return}if(c)return;if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),Ne());return}if(p){e.preventDefault();const s=[ce,U,Ae];switch(t){case"arrowdown":A=(A+1)%s.length,Pe();break;case"arrowup":A=(A-1+s.length)%s.length,Pe();break;case"enter":s[A].click();break;case"p":case"escape":D();break}return}if(t==="h"){e.preventDefault(),ae();return}if(t==="p"||t==="escape"){e.preventDefault(),D();return}if(!(h.length>0||M)){switch(t){case"arrowleft":e.preventDefault(),q(-1);break;case"arrowright":e.preventDefault(),q(1);break;case"arrowdown":e.preventDefault(),Le(),E.play("softDrop");break;case"arrowup":e.preventDefault(),Me();break;case"enter":case" ":for(e.preventDefault();x(a.shape,a.x,a.y+1);)a.y++;fe(),E.play("hardDrop");break;case"c":e.preventDefault(),Ge();break;case"q":e.preventDefault(),Se();break}B()}}Ft();
