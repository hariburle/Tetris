(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();const Ue={},u=10,v=20,Be=300,Pe=100,k=document.getElementById("game-canvas"),c=k.getContext("2d"),q=document.getElementById("next-canvas"),se=q.getContext("2d"),F=document.getElementById("hold-canvas"),ie=F.getContext("2d"),We=document.getElementById("score"),le=document.getElementById("lines"),J=document.getElementById("level"),Ye=document.getElementById("high-score"),de=document.getElementById("pause-button"),ue=document.getElementById("quit-button"),Xe=document.getElementById("help-button"),fe=document.getElementById("game-container"),ce=document.getElementById("mode-display"),Ie=document.getElementById("mode-label"),we=document.getElementById("mode-value"),he=document.getElementById("main-menu"),H=document.querySelectorAll("#menu-button-group button"),Ve=document.getElementById("menu-marathon-button"),ze=document.getElementById("menu-sprint-button"),Je=document.getElementById("menu-ultra-button"),Ke=document.getElementById("menu-high-scores-button"),je=document.getElementById("menu-settings-button"),Qe=document.getElementById("help-modal"),Ze=document.getElementById("high-scores-modal"),et=document.getElementById("settings-modal"),xe=document.getElementById("high-scores-table"),Te=document.getElementById("volume-slider"),Ce=document.getElementById("ghost-toggle"),tt=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],nt=5,ot=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],Me=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],st={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},it={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let b,s,$,C,K,j,X,Q,L,I,h=!0,g,Z,me,U,f,p=[],W,D,G=null,V,O,M,S,w,N,R,T=0;const m={sounds:{},volume:.5,loadSounds:function(){const e=["move","rotate","softDrop","hardDrop","lock","hold","clearLine","clearTetris","levelUp","pause","gameOver"],t=typeof Ue<"u"?"/Tetris/":"/";e.forEach(n=>{const o=new Audio,i=document.createElement("source");i.src=`${t}sounds/${n}.wav`,i.type="audio/wav";const l=document.createElement("source");l.src=`${t}sounds/${n}.mp3`,l.type="audio/mpeg",o.appendChild(i),o.appendChild(l),this.sounds[n]=o})},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(n=>console.error(`Error playing sound ${e}:`,n.message))}}};function lt(){m.loadSounds(),yt(),Et(),ct(),pe(),z()}function ct(){Ve.addEventListener("click",()=>oe("marathon")),ze.addEventListener("click",()=>oe("sprint")),Je.addEventListener("click",()=>oe("ultra")),Ke.addEventListener("click",at),je.addEventListener("click",dt),de.addEventListener("click",A),ue.addEventListener("click",Ae),Xe.addEventListener("click",ee),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",ge)}),Te.addEventListener("input",e=>{S.volume=parseFloat(e.target.value),m.volume=S.volume,ke()}),Ce.addEventListener("change",e=>{S.showGhost=e.target.checked,ke(),h||_()}),document.addEventListener("keydown",Lt),window.addEventListener("resize",pe),bt()}function z(){k.removeEventListener("click",z),document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden")),he.classList.remove("hidden"),fe.classList.add("hidden"),ce.classList.add("hidden"),T=0,re()}function re(){H.forEach((e,t)=>{t===T?e.classList.add("selected"):e.classList.remove("selected")})}function rt(){he.classList.add("hidden"),fe.classList.remove("hidden"),pe()}function ee(){f&&!g&&!h&&A(),Qe.classList.remove("hidden")}function at(){const e=xe.querySelector("tbody");e&&e.remove();const t=document.createElement("tbody");I.length===0?t.innerHTML='<tr><td colspan="2">No scores yet!</td></tr>':I.forEach((n,o)=>{const i=`<tr><td>${o+1}.</td><td>${n.score}</td></tr>`;t.innerHTML+=i}),xe.appendChild(t),Ze.classList.remove("hidden")}function dt(){f&&!g&&!h&&A(),et.classList.remove("hidden")}function ge(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=g;document.querySelectorAll(".modal").forEach(n=>n.classList.add("hidden")),t&&f&&!h&&(g=!1,A())}function pe(){const e=window.innerHeight;let n=fe.getBoundingClientRect().width;window.innerWidth>768&&(n-=252);const o=Math.floor(e*.9/v),i=Math.floor(n*.95/u);O=Math.max(1,Math.min(o,i)),k.width=u*O,k.height=v*O;const l=document.getElementById("side-panel");window.innerWidth>768?l.style.height=`${k.height}px`:l.style.height="auto",c.scale(O,O),M=Math.floor(O*.7),q.width=4*M,q.height=4*M,se.scale(M,M),F.width=4*M,F.height=4*M,ie.scale(M,M),$&&He(),C&&be(),b&&(_(),h&&Ge())}function oe(e){switch(w=e,rt(),f&&cancelAnimationFrame(f),b=ut(),X=0,Q=0,L=0,h=!1,g=!1,Z=0,me=1e3,U=0,f=0,p=[],W=0,D=0,C=null,K=!0,j=[],ce.classList.remove("hidden"),w){case"sprint":N=40,Ie.textContent="LINES",J.parentElement.classList.add("hidden");break;case"ultra":R=3*60*1e3,Ie.textContent="TIME",J.parentElement.classList.add("hidden"),le.parentElement.classList.add("hidden");break;case"marathon":default:ce.classList.add("hidden"),J.parentElement.classList.remove("hidden"),le.parentElement.classList.remove("hidden");break}Oe(),Fe(L),ge(),ne(),Le(),De(),Ee(),be(),de.textContent="Pause",ue.classList.remove("hidden"),ye(0)}function Ae(){f&&(cancelAnimationFrame(f),f=0),h=!0,z()}function ye(e=0){if(h)return;if(f=requestAnimationFrame(ye),g){qe();return}const t=e-U;if(U=e,w==="ultra"?(R-=t,R<=0&&(R=0,ae())):w==="sprint"&&N<=0&&ae(),D>0&&(D-=t),p.length>0){if(W-=t,W<=0){let n=p.length;p.sort((o,i)=>o-i).forEach(o=>{b.splice(o,1),b.unshift(Array(u).fill(0))}),p=[],pt(n),Ee()}}else Z+=t,Z>me&&Se();h||(ne(),_())}function ae(){h=!0,m.play("gameOver"),vt(),_(),Ge(),cancelAnimationFrame(f),f=0,ue.classList.add("hidden"),k.addEventListener("click",z)}function ut(){return Array.from({length:v},()=>Array(u).fill(0))}function Oe(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}j.push(...e)}function Re(){j.length===0&&Oe();const e=j.shift();return{shape:tt[e],shapeIndex:e}}function Ee(){s={...$,x:Math.floor(u/2)-1,y:0},De(),V=!1,K=!0,B(s.shape,s.x,s.y)||ae()}function De(){$=Re(),He()}function Ne(){if(!K)return;m.play("hold");const e=s.x,t=s.y,n={shape:s.shape,shapeIndex:s.shapeIndex};let o;C?o={...C,x:e,y:t}:o={...Re(),x:Math.floor(u/2)-1,y:0},B(o.shape,o.x,o.y)&&(s=o,C=n,K=!1,be())}function Se(){B(s.shape,s.x,s.y+1)?(s.y++,V=!1):ve(),Z=0}function te(e){B(s.shape,s.x+e,s.y)&&(s.x+=e,V=!1,m.play("move"))}function _e(){const e=ft(s.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[n,o]of t)if(B(e,s.x+n,s.y+o)){s.x+=n,s.y+=o,s.shape=e,V=!0,m.play("rotate");return}}function ft(e){return e[0].map((t,n)=>e.map(o=>o[n])).map(t=>t.reverse())}function B(e,t,n){for(let o=0;o<e.length;o++)for(let i=0;i<e[o].length;i++)if(e[o][i]!==0){const l=t+i,d=n+o;if(l<0||l>=u||d>=v||d>=0&&b[d][l]!==0)return!1}return!0}function ve(){const e=mt();G={shape:s.shape,x:s.x,y:s.y},D=Pe,s.shape.forEach((t,n)=>{t.forEach((o,i)=>{o>0&&s.y+n>=0&&(b[s.y+n][s.x+i]=o)})}),gt(e),p.length===0&&(e&&(X+=400*(L+1),ne()),Ee()),m.play("lock")}function _(){if(!(!c||!b)){if(c.clearRect(0,0,k.width,k.height),Y(c,b,0,0),D>0&&G&&(c.fillStyle=`rgba(255, 255, 255, ${.8*(D/Pe)})`,G.shape.forEach((e,t)=>{e.forEach((n,o)=>{n>0&&c.fillRect(G.x+o,G.y+t,1,1)})})),!h&&s){if(S.showGhost){let e=s.y;for(;B(s.shape,s.x,e+1);)e++;ht(c,s.shape,s.x,e)}Y(c,s.shape,s.x,s.y)}if(p.length>0){const e=Math.abs(Math.sin(W/Be*Math.PI*2));c.fillStyle=`rgba(255, 255, 255, ${e*.9})`,p.forEach(t=>{c.fillRect(0,t,u,1)})}}}function He(){if(se.clearRect(0,0,q.width,q.height),!$)return;const{shape:e}=$,t=(4-e[0].length)/2,n=(4-e.length)/2;Y(se,e,t,n)}function be(){if(ie.clearRect(0,0,F.width,F.height),!C)return;const{shape:e}=C,t=(4-e[0].length)/2,n=(4-e.length)/2;Y(ie,e,t,n)}function Y(e,t,n,o,i){t.forEach((l,d)=>{l.forEach((P,y)=>{if(P>0){if(p.includes(Math.floor(d+o)))return;const x=i||ot[P],a=y+n,r=d+o,E=.1;e.fillStyle=x.dark,e.fillRect(a,r,1,1),e.fillStyle=x.light,e.fillRect(a,r,1-E,1-E),e.fillStyle=x.base,e.fillRect(a+E,r+E,1-E*2,1-E*2)}})})}function ht(e,t,n,o){const i=st;t.forEach((l,d)=>{l.forEach((P,y)=>{if(P>0){const x=y+n,a=d+o,r=.1;e.fillStyle=i.dark,e.fillRect(x,a,1,1),e.fillStyle=i.light,e.fillRect(x,a,1-r,1-r),e.fillStyle=i.base,e.fillRect(x+r,a+r,1-r*2,1-r*2)}})})}function Ge(){Y(c,b,0,0,it),c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,u,v),c.fillStyle="white",c.textAlign="center";let e="GAME OVER";w==="sprint"&&N<=0&&(e="YOU WIN!"),c.font='1.1px "Press Start 2P"',c.fillText(e,u/2,v/2-1.5),c.font='0.7px "Press Start 2P"',c.fillText("Press any key",u/2,v/2+1),c.fillText("to continue",u/2,v/2+2)}function qe(){c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,u,v),c.fillStyle="white",c.textAlign="center",c.font='1.5px "Press Start 2P"',c.fillText("PAUSED",u/2,v/2)}function mt(){if(s.shapeIndex!==nt||!V)return!1;const e=s.x+1,t=s.y+1,n=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let o=0;return n.forEach(([i,l])=>{(l<0||l>=u||i<0||i>=v||b[i][l]!==0)&&o++}),o>=3}function gt(e){let t=0;b.forEach((n,o)=>{n.every(i=>i>0)&&(t++,p.push(o))}),t>0&&(W=Be,X+=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(L+1),m.play(t>=4?"clearTetris":"clearLine"))}function pt(e){const t=L;Q+=e,w==="sprint"&&(N-=e),w==="marathon"&&(L=Math.floor(Q/10),L>t&&(Fe(L),m.play("levelUp")),me=Math.max(200,1e3-L*75)),ne()}function Fe(e){const t=Me[e%Me.length];document.documentElement.style.setProperty("--accent-color",t)}function ne(){if(We.textContent=X.toString(),le.textContent=Q.toString(),J.textContent=L.toString(),w==="sprint")we.textContent=Math.max(0,N).toString();else if(w==="ultra"){const e=Math.floor(R/6e4),t=Math.floor(R%6e4/1e3);we.textContent=`${e}:${t.toString().padStart(2,"0")}`}}function yt(){const e=localStorage.getItem("tetrisSettings");S=e?JSON.parse(e):{volume:.5,showGhost:!0},S.showGhost===void 0&&(S.showGhost=!0),m.volume=S.volume,Te.value=S.volume.toString(),Ce.checked=S.showGhost}function ke(){localStorage.setItem("tetrisSettings",JSON.stringify(S))}function Et(){const e=localStorage.getItem("tetrisHighScores");I=e?JSON.parse(e):[],Le()}function St(){localStorage.setItem("tetrisHighScores",JSON.stringify(I))}function vt(){if(w==="sprint"&&N>0)return;const e={score:X,date:new Date().toISOString()};I.push(e),I.sort((t,n)=>n.score-t.score),I=I.slice(0,5),St(),Le()}function Le(){Ye.textContent=I.length>0?I[0].score.toString():"0"}function A(){if(h||p.length>0||document.querySelector(".modal:not(.hidden)"))return;g=!g,g?(m.play("pause"),cancelAnimationFrame(f),qe()):(U=performance.now(),ye(U));const e=g?"Resume":"Pause";de.textContent=e;const t=document.getElementById("mc-pause");t&&(t.textContent=e)}function bt(){const e=document.getElementById("mc-left"),t=document.getElementById("mc-right"),n=document.getElementById("mc-down"),o=document.getElementById("mc-rotate"),i=document.getElementById("mc-hard-drop"),l=document.getElementById("mc-hold"),d=document.getElementById("mc-pause"),P=document.getElementById("mc-help");if(!e||!t||!n||!o||!i||!l||!d||!P)return;const y=(r,E)=>$e=>{$e.preventDefault(),!((g||h||p.length>0||document.querySelector(".modal:not(.hidden)"))&&r!==A&&r!==ee)&&(r(),E&&m.play(E),g||_())},x=()=>{for(;B(s.shape,s.x,s.y+1);)s.y++;ve()},a=(r,E)=>{r.addEventListener("touchstart",E,{passive:!1}),r.addEventListener("mousedown",E,{passive:!1})};a(e,y(()=>te(-1))),a(t,y(()=>te(1))),a(n,y(Se,"softDrop")),a(o,y(_e)),a(l,y(Ne)),a(i,y(x,"hardDrop")),a(d,y(A)),a(P,y(ee))}function Lt(e){const t=e.key.toLowerCase();if(!he.classList.contains("hidden")){switch(e.preventDefault(),t){case"arrowdown":T=(T+1)%H.length,re();break;case"arrowup":T=(T-1+H.length)%H.length,re();break;case"enter":H[T].click();break}return}if(h){f===0&&z();return}if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),ge());return}if(t==="h"){e.preventDefault(),ee();return}if(t==="p"||t==="escape"){e.preventDefault(),A();return}if(!(g||p.length>0)){switch(t){case"arrowleft":e.preventDefault(),te(-1);break;case"arrowright":e.preventDefault(),te(1);break;case"arrowdown":e.preventDefault(),Se(),m.play("softDrop");break;case"arrowup":e.preventDefault(),_e();break;case"enter":case" ":for(e.preventDefault();B(s.shape,s.x,s.y+1);)s.y++;ve(),m.play("hardDrop");break;case"c":e.preventDefault(),Ne();break;case"q":e.preventDefault(),Ae();break}_()}}lt();
