(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();const Fe={},a=10,g=20,Me=300,xe=100,C=document.getElementById("game-canvas"),r=C.getContext("2d"),D=document.getElementById("next-canvas"),oe=D.getContext("2d"),H=document.getElementById("hold-canvas"),se=H.getContext("2d"),qe=document.getElementById("score"),ie=document.getElementById("lines"),X=document.getElementById("level"),$e=document.getElementById("high-score"),j=document.getElementById("pause-button"),ce=document.getElementById("quit-button"),Ue=document.getElementById("help-button"),de=document.getElementById("game-container"),le=document.getElementById("mode-display"),Se=document.getElementById("mode-label"),be=document.getElementById("mode-value"),ue=document.getElementById("main-menu"),N=document.querySelectorAll("#menu-button-group button"),We=document.getElementById("menu-marathon-button"),Ye=document.getElementById("menu-sprint-button"),Xe=document.getElementById("menu-ultra-button"),Ve=document.getElementById("menu-high-scores-button"),ze=document.getElementById("menu-settings-button"),Je=document.getElementById("help-modal"),Ke=document.getElementById("high-scores-modal"),je=document.getElementById("settings-modal"),ve=document.getElementById("high-scores-table"),ke=document.getElementById("volume-slider"),Pe=document.getElementById("ghost-toggle"),Qe=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],Ze=5,et=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],we=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],tt={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},nt={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let y,s,G,x,V,z,$,J,S,b,d=!0,p,K,fe,k,c,h=[],F,O,_=null,U,T,w,m,v,R,A,M=0;const u={sounds:{},volume:.5,loadSounds:function(){const e=["move","rotate","softDrop","hardDrop","lock","hold","clearLine","clearTetris","levelUp","pause","gameOver"],t=typeof Fe<"u"?"/Tetris/":"/";e.forEach(n=>{const o=new Audio,i=document.createElement("source");i.src=`${t}sounds/${n}.wav`,i.type="audio/wav";const l=document.createElement("source");l.src=`${t}sounds/${n}.mp3`,l.type="audio/mpeg",o.appendChild(i),o.appendChild(l),this.sounds[n]=o})},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(n=>console.error(`Error playing sound ${e}:`,n.message))}}};function ot(){u.loadSounds(),pt(),yt(),st(),ge(),he()}function st(){We.addEventListener("click",()=>ne("marathon")),Ye.addEventListener("click",()=>ne("sprint")),Xe.addEventListener("click",()=>ne("ultra")),Ve.addEventListener("click",lt),ze.addEventListener("click",rt),j.addEventListener("click",ee),ce.addEventListener("click",Te),Ue.addEventListener("click",Be),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",me)}),ke.addEventListener("input",e=>{m.volume=parseFloat(e.target.value),u.volume=m.volume,Ie()}),Pe.addEventListener("change",e=>{m.showGhost=e.target.checked,Ie(),d||W()}),document.addEventListener("keydown",bt),window.addEventListener("resize",ge)}function he(){ue.classList.remove("hidden"),de.classList.add("hidden"),le.classList.add("hidden"),M=0,re()}function re(){N.forEach((e,t)=>{t===M?e.classList.add("selected"):e.classList.remove("selected")})}function it(){ue.classList.add("hidden"),de.classList.remove("hidden"),ge()}function Be(){c&&!p&&!d&&ee(),Je.classList.remove("hidden")}function lt(){const e=ve.querySelector("tbody");e&&e.remove();const t=document.createElement("tbody");b.length===0?t.innerHTML='<tr><td colspan="2">No scores yet!</td></tr>':b.forEach((n,o)=>{const i=`<tr><td>${o+1}.</td><td>${n.score}</td></tr>`;t.innerHTML+=i}),ve.appendChild(t),Ke.classList.remove("hidden")}function rt(){c&&!p&&!d&&ee(),je.classList.remove("hidden")}function me(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=p;document.querySelectorAll(".modal").forEach(n=>n.classList.add("hidden")),t&&c&&!d&&(p=!1,j.textContent="Pause",k=performance.now(),Q(k))}function ge(){const e=window.innerHeight;let n=de.getBoundingClientRect().width;window.innerWidth>768&&(n-=252);const o=Math.floor(e*.9/g),i=Math.floor(n*.95/a);T=Math.max(1,Math.min(o,i)),C.width=a*T,C.height=g*T;const l=document.getElementById("side-panel");window.innerWidth>768?l.style.height=`${C.height}px`:l.style.height="auto",r.scale(T,T),w=Math.floor(T*.7),D.width=4*w,D.height=4*w,oe.scale(w,w),H.width=4*w,H.height=4*w,se.scale(w,w),G&&_e(),x&&ye(),y&&(W(),d&&De())}function ne(e){switch(v=e,it(),c&&cancelAnimationFrame(c),y=at(),$=0,J=0,S=0,d=!1,p=!1,K=0,fe=1e3,k=0,c=0,h=[],F=0,O=0,x=null,V=!0,z=[],le.classList.remove("hidden"),v){case"sprint":R=40,Se.textContent="LINES",X.parentElement.classList.add("hidden");break;case"ultra":A=3*60*1e3,Se.textContent="TIME",X.parentElement.classList.add("hidden"),ie.parentElement.classList.add("hidden");break;case"marathon":default:le.classList.add("hidden"),X.parentElement.classList.remove("hidden"),ie.parentElement.classList.remove("hidden");break}Ce(),Ge(S),me(),Z(),Ee(),Oe(),pe(),ye(),j.textContent="Pause",ce.classList.remove("hidden"),Q(0)}function Te(){c&&(cancelAnimationFrame(c),c=0),d=!0,he()}function Q(e=0){if(d)return;if(c=requestAnimationFrame(Q),p){He();return}const t=e-k;if(k=e,v==="ultra"?(A-=t,A<=0&&(A=0,ae())):v==="sprint"&&R<=0&&ae(),O>0&&(O-=t),h.length>0){if(F-=t,F<=0){let n=h.length;h.sort((o,i)=>o-i).forEach(o=>{y.splice(o,1),y.unshift(Array(a).fill(0))}),h=[],gt(n),pe()}}else K+=t,K>fe&&Re();d||(Z(),W())}function ae(){d=!0,u.play("gameOver"),St(),W(),De(),cancelAnimationFrame(c),c=0,ce.classList.add("hidden")}function at(){return Array.from({length:g},()=>Array(a).fill(0))}function Ce(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}z.push(...e)}function Ae(){z.length===0&&Ce();const e=z.shift();return{shape:Qe[e],shapeIndex:e}}function pe(){s={...G,x:Math.floor(a/2)-1,y:0},Oe(),U=!1,V=!0,P(s.shape,s.x,s.y)||ae()}function Oe(){G=Ae(),_e()}function ct(){if(!V)return;u.play("hold");const e=s.x,t=s.y,n={shape:s.shape,shapeIndex:s.shapeIndex};let o;x?o={...x,x:e,y:t}:o={...Ae(),x:Math.floor(a/2)-1,y:0},P(o.shape,o.x,o.y)&&(s=o,x=n,V=!1,ye())}function Re(){P(s.shape,s.x,s.y+1)?(s.y++,U=!1):Ne(),K=0}function Le(e){P(s.shape,s.x+e,s.y)&&(s.x+=e,U=!1,u.play("move"))}function dt(){const e=ut(s.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[n,o]of t)if(P(e,s.x+n,s.y+o)){s.x+=n,s.y+=o,s.shape=e,U=!0,u.play("rotate");return}}function ut(e){return e[0].map((t,n)=>e.map(o=>o[n])).map(t=>t.reverse())}function P(e,t,n){for(let o=0;o<e.length;o++)for(let i=0;i<e[o].length;i++)if(e[o][i]!==0){const l=t+i,f=n+o;if(l<0||l>=a||f>=g||f>=0&&y[f][l]!==0)return!1}return!0}function Ne(){const e=ht();_={shape:s.shape,x:s.x,y:s.y},O=xe,s.shape.forEach((t,n)=>{t.forEach((o,i)=>{o>0&&s.y+n>=0&&(y[s.y+n][s.x+i]=o)})}),mt(e),h.length===0&&(e&&($+=400*(S+1),Z()),pe()),u.play("lock")}function W(){if(!(!r||!y)){if(r.clearRect(0,0,C.width,C.height),q(r,y,0,0),O>0&&_&&(r.fillStyle=`rgba(255, 255, 255, ${.8*(O/xe)})`,_.shape.forEach((e,t)=>{e.forEach((n,o)=>{n>0&&r.fillRect(_.x+o,_.y+t,1,1)})})),!d&&s){if(m.showGhost){let e=s.y;for(;P(s.shape,s.x,e+1);)e++;ft(r,s.shape,s.x,e)}q(r,s.shape,s.x,s.y)}if(h.length>0){const e=Math.abs(Math.sin(F/Me*Math.PI*2));r.fillStyle=`rgba(255, 255, 255, ${e*.9})`,h.forEach(t=>{r.fillRect(0,t,a,1)})}}}function _e(){if(oe.clearRect(0,0,D.width,D.height),!G)return;const{shape:e}=G,t=(4-e[0].length)/2,n=(4-e.length)/2;q(oe,e,t,n)}function ye(){if(se.clearRect(0,0,H.width,H.height),!x)return;const{shape:e}=x,t=(4-e[0].length)/2,n=(4-e.length)/2;q(se,e,t,n)}function q(e,t,n,o,i){t.forEach((l,f)=>{l.forEach((Y,te)=>{if(Y>0){if(h.includes(Math.floor(f+o)))return;const L=i||et[Y],I=te+n,E=f+o,B=.1;e.fillStyle=L.dark,e.fillRect(I,E,1,1),e.fillStyle=L.light,e.fillRect(I,E,1-B,1-B),e.fillStyle=L.base,e.fillRect(I+B,E+B,1-B*2,1-B*2)}})})}function ft(e,t,n,o){const i=tt;t.forEach((l,f)=>{l.forEach((Y,te)=>{if(Y>0){const L=te+n,I=f+o,E=.1;e.fillStyle=i.dark,e.fillRect(L,I,1,1),e.fillStyle=i.light,e.fillRect(L,I,1-E,1-E),e.fillStyle=i.base,e.fillRect(L+E,I+E,1-E*2,1-E*2)}})})}function De(){q(r,y,0,0,nt),r.fillStyle="rgba(0, 0, 0, 0.75)",r.fillRect(0,0,a,g),r.fillStyle="white",r.textAlign="center";let e="GAME OVER";v==="sprint"&&R<=0&&(e="YOU WIN!"),r.font='1.1px "Press Start 2P"',r.fillText(e,a/2,g/2-1.5),r.font='0.7px "Press Start 2P"',r.fillText("Press any key",a/2,g/2+1),r.fillText("to continue",a/2,g/2+2)}function He(){r.fillStyle="rgba(0, 0, 0, 0.75)",r.fillRect(0,0,a,g),r.fillStyle="white",r.textAlign="center",r.font='1.5px "Press Start 2P"',r.fillText("PAUSED",a/2,g/2)}function ht(){if(s.shapeIndex!==Ze||!U)return!1;const e=s.x+1,t=s.y+1,n=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let o=0;return n.forEach(([i,l])=>{(l<0||l>=a||i<0||i>=g||y[i][l]!==0)&&o++}),o>=3}function mt(e){let t=0;y.forEach((n,o)=>{n.every(i=>i>0)&&(t++,h.push(o))}),t>0&&(F=Me,$+=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(S+1),u.play(t>=4?"clearTetris":"clearLine"))}function gt(e){const t=S;J+=e,v==="sprint"&&(R-=e),v==="marathon"&&(S=Math.floor(J/10),S>t&&(Ge(S),u.play("levelUp")),fe=Math.max(200,1e3-S*75)),Z()}function Ge(e){const t=we[e%we.length];document.documentElement.style.setProperty("--accent-color",t)}function Z(){if(qe.textContent=$.toString(),ie.textContent=J.toString(),X.textContent=S.toString(),v==="sprint")be.textContent=Math.max(0,R).toString();else if(v==="ultra"){const e=Math.floor(A/6e4),t=Math.floor(A%6e4/1e3);be.textContent=`${e}:${t.toString().padStart(2,"0")}`}}function pt(){const e=localStorage.getItem("tetrisSettings");m=e?JSON.parse(e):{volume:.5,showGhost:!0},m.showGhost===void 0&&(m.showGhost=!0),u.volume=m.volume,ke.value=m.volume.toString(),Pe.checked=m.showGhost}function Ie(){localStorage.setItem("tetrisSettings",JSON.stringify(m))}function yt(){const e=localStorage.getItem("tetrisHighScores");b=e?JSON.parse(e):[],Ee()}function Et(){localStorage.setItem("tetrisHighScores",JSON.stringify(b))}function St(){if(v==="sprint"&&R>0)return;const e={score:$,date:new Date().toISOString()};b.push(e),b.sort((t,n)=>n.score-t.score),b=b.slice(0,5),Et(),Ee()}function Ee(){$e.textContent=b.length>0?b[0].score.toString():"0"}function ee(){d||h.length>0||document.querySelector(".modal:not(.hidden)")||(p=!p,p?(u.play("pause"),cancelAnimationFrame(c),He()):(k=performance.now(),Q(k)),j.textContent=p?"Resume":"Pause")}function bt(e){const t=e.key.toLowerCase();if(!ue.classList.contains("hidden")){switch(e.preventDefault(),t){case"arrowdown":M=(M+1)%N.length,re();break;case"arrowup":M=(M-1+N.length)%N.length,re();break;case"enter":N[M].click();break}return}if(d){c===0&&he();return}if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),me());return}if(t==="h"){e.preventDefault(),Be();return}if(t==="p"||t==="escape"){e.preventDefault(),ee();return}if(!(p||h.length>0)){switch(t){case"arrowleft":e.preventDefault(),Le(-1);break;case"arrowright":e.preventDefault(),Le(1);break;case"arrowdown":e.preventDefault(),Re(),u.play("softDrop");break;case"arrowup":e.preventDefault(),dt();break;case"enter":case" ":for(e.preventDefault();P(s.shape,s.x,s.y+1);)s.y++;Ne(),u.play("hardDrop");break;case"c":e.preventDefault(),ct();break;case"q":e.preventDefault(),Te();break}W()}}ot();
