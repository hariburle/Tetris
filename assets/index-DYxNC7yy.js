(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const u of l.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();const a=10,g=20,ve=300,Le=100,T=document.getElementById("game-canvas"),r=T.getContext("2d"),N=document.getElementById("next-canvas"),te=N.getContext("2d"),D=document.getElementById("hold-canvas"),ne=D.getContext("2d"),He=document.getElementById("score"),oe=document.getElementById("lines"),Y=document.getElementById("level"),_e=document.getElementById("high-score"),K=document.getElementById("pause-button"),le=document.getElementById("quit-button"),Ge=document.getElementById("help-button"),re=document.getElementById("game-container"),se=document.getElementById("mode-display"),ge=document.getElementById("mode-label"),pe=document.getElementById("mode-value"),Ie=document.getElementById("main-menu"),Fe=document.getElementById("menu-marathon-button"),qe=document.getElementById("menu-sprint-button"),We=document.getElementById("menu-ultra-button"),Ue=document.getElementById("menu-high-scores-button"),Ye=document.getElementById("menu-settings-button"),$e=document.getElementById("help-modal"),Xe=document.getElementById("high-scores-modal"),ze=document.getElementById("settings-modal"),ye=document.getElementById("high-scores-table"),we=document.getElementById("volume-slider"),xe=document.getElementById("ghost-toggle"),Je=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],Ke=5,Ve=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],Ee=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],je={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},Qe={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let y,n,H,x,$,X,F,z,S,b,d=!0,p,J,ae,k,c,h=[],_,C,R=null,q,B,L,m,v,O,A;const f={sounds:{},volume:.5,loadSounds:function(){["move","rotate","softDrop","hardDrop","lock","hold","clearLine","clearTetris","levelUp","pause","gameOver"].forEach(t=>{this.sounds[t]=new Audio(`/sounds/${t}.wav`)})},play:function(e){this.sounds[e]&&(this.sounds[e].volume=this.volume,this.sounds[e].currentTime=0,this.sounds[e].play().catch(t=>console.error(`Error playing sound ${e}:`,t)))}};function Ze(){f.loadSounds(),ut(),ht(),et(),fe(),ce()}function et(){Fe.addEventListener("click",()=>ee("marathon")),qe.addEventListener("click",()=>ee("sprint")),We.addEventListener("click",()=>ee("ultra")),Ue.addEventListener("click",nt),Ye.addEventListener("click",ot),K.addEventListener("click",Q),le.addEventListener("click",Me),Ge.addEventListener("click",ke),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",de)}),we.addEventListener("input",e=>{m.volume=parseFloat(e.target.value),f.volume=m.volume,be()}),xe.addEventListener("change",e=>{m.showGhost=e.target.checked,be(),d||W()}),document.addEventListener("keydown",pt),window.addEventListener("resize",fe)}function ce(){Ie.classList.remove("hidden"),re.classList.add("hidden"),se.classList.add("hidden")}function tt(){Ie.classList.add("hidden"),re.classList.remove("hidden"),fe()}function ke(){c&&!p&&!d&&Q(),$e.classList.remove("hidden")}function nt(){const e=ye.querySelector("tbody");e&&e.remove();const t=document.createElement("tbody");b.length===0?t.innerHTML='<tr><td colspan="2">No scores yet!</td></tr>':b.forEach((s,o)=>{const i=`<tr><td>${o+1}.</td><td>${s.score}</td></tr>`;t.innerHTML+=i}),ye.appendChild(t),Xe.classList.remove("hidden")}function ot(){c&&!p&&!d&&Q(),ze.classList.remove("hidden")}function de(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=p;document.querySelectorAll(".modal").forEach(s=>s.classList.add("hidden")),t&&c&&!d&&(p=!1,K.textContent="Pause",k=performance.now(),V(k))}function fe(){const e=window.innerHeight;let s=re.getBoundingClientRect().width;window.innerWidth>768&&(s-=252);const o=Math.floor(e*.9/g),i=Math.floor(s*.95/a);B=Math.max(1,Math.min(o,i)),T.width=a*B,T.height=g*B;const l=document.getElementById("side-panel");window.innerWidth>768?l.style.height=`${T.height}px`:l.style.height="auto",r.scale(B,B),L=Math.floor(B*.7),N.width=4*L,N.height=4*L,te.scale(L,L),D.width=4*L,D.height=4*L,ne.scale(L,L),H&&Oe(),x&&he(),y&&(W(),d&&Re())}function ee(e){switch(v=e,tt(),c&&cancelAnimationFrame(c),y=st(),F=0,z=0,S=0,d=!1,p=!1,J=0,ae=1e3,k=0,c=0,h=[],_=0,C=0,x=null,$=!0,X=[],se.classList.remove("hidden"),v){case"sprint":O=40,ge.textContent="LINES",Y.parentElement.classList.add("hidden");break;case"ultra":A=3*60*1e3,ge.textContent="TIME",Y.parentElement.classList.add("hidden"),oe.parentElement.classList.add("hidden");break;case"marathon":default:se.classList.add("hidden"),Y.parentElement.classList.remove("hidden"),oe.parentElement.classList.remove("hidden");break}Pe(),De(S),de(),j(),me(),Te(),ue(),he(),K.textContent="Pause",le.classList.remove("hidden"),V(0)}function Me(){c&&(cancelAnimationFrame(c),c=0),d=!0,ce()}function V(e=0){if(d)return;if(c=requestAnimationFrame(V),p){Ne();return}const t=e-k;if(k=e,v==="ultra"?(A-=t,A<=0&&(A=0,ie())):v==="sprint"&&O<=0&&ie(),C>0&&(C-=t),h.length>0){if(_-=t,_<=0){let s=h.length;h.sort((o,i)=>o-i).forEach(o=>{y.splice(o,1),y.unshift(Array(a).fill(0))}),h=[],ft(s),ue()}}else J+=t,J>ae&&Ae();j(),W()}function ie(){d=!0,f.play("gameOver"),gt(),W(),Re(),cancelAnimationFrame(c),c=0,le.classList.add("hidden")}function st(){return Array.from({length:g},()=>Array(a).fill(0))}function Pe(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}X.push(...e)}function Be(){X.length===0&&Pe();const e=X.shift();return{shape:Je[e],shapeIndex:e}}function ue(){n={...H,x:Math.floor(a/2)-1,y:0},Te(),q=!1,$=!0,M(n.shape,n.x,n.y)||ie()}function Te(){H=Be(),Oe()}function it(){if(!$)return;f.play("hold");const e=n.x,t=n.y,s={shape:n.shape,shapeIndex:n.shapeIndex};let o;x?o={...x,x:e,y:t}:o={...Be(),x:Math.floor(a/2)-1,y:0},M(o.shape,o.x,o.y)&&(n=o,x=s,$=!1,he())}function Ae(){M(n.shape,n.x,n.y+1)?(n.y++,q=!1):Ce(),J=0}function Se(e){M(n.shape,n.x+e,n.y)&&(n.x+=e,q=!1,f.play("move"))}function lt(){const e=rt(n.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[s,o]of t)if(M(e,n.x+s,n.y+o)){n.x+=s,n.y+=o,n.shape=e,q=!0,f.play("rotate");return}}function rt(e){return e[0].map((t,s)=>e.map(o=>o[s])).map(t=>t.reverse())}function M(e,t,s){for(let o=0;o<e.length;o++)for(let i=0;i<e[o].length;i++)if(e[o][i]!==0){const l=t+i,u=s+o;if(l<0||l>=a||u>=g||u>=0&&y[u][l]!==0)return!1}return!0}function Ce(){const e=ct();R={shape:n.shape,x:n.x,y:n.y},C=Le,n.shape.forEach((t,s)=>{t.forEach((o,i)=>{o>0&&n.y+s>=0&&(y[n.y+s][n.x+i]=o)})}),dt(e),h.length===0&&(e&&(F+=400*(S+1),j()),ue()),f.play("lock")}function W(){if(!(!r||!y)){if(r.clearRect(0,0,T.width,T.height),G(r,y,0,0),C>0&&R&&(r.fillStyle=`rgba(255, 255, 255, ${.8*(C/Le)})`,R.shape.forEach((e,t)=>{e.forEach((s,o)=>{s>0&&r.fillRect(R.x+o,R.y+t,1,1)})})),!d&&n){if(m.showGhost){let e=n.y;for(;M(n.shape,n.x,e+1);)e++;at(r,n.shape,n.x,e)}G(r,n.shape,n.x,n.y)}if(h.length>0){const e=Math.abs(Math.sin(_/ve*Math.PI*2));r.fillStyle=`rgba(255, 255, 255, ${e*.9})`,h.forEach(t=>{r.fillRect(0,t,a,1)})}}}function Oe(){if(te.clearRect(0,0,N.width,N.height),!H)return;const{shape:e}=H,t=(4-e[0].length)/2,s=(4-e.length)/2;G(te,e,t,s)}function he(){if(ne.clearRect(0,0,D.width,D.height),!x)return;const{shape:e}=x,t=(4-e[0].length)/2,s=(4-e.length)/2;G(ne,e,t,s)}function G(e,t,s,o,i){t.forEach((l,u)=>{l.forEach((U,Z)=>{if(U>0){if(h.includes(Math.floor(u+o)))return;const I=i||Ve[U],w=Z+s,E=u+o,P=.1;e.fillStyle=I.dark,e.fillRect(w,E,1,1),e.fillStyle=I.light,e.fillRect(w,E,1-P,1-P),e.fillStyle=I.base,e.fillRect(w+P,E+P,1-P*2,1-P*2)}})})}function at(e,t,s,o){const i=je;t.forEach((l,u)=>{l.forEach((U,Z)=>{if(U>0){const I=Z+s,w=u+o,E=.1;e.fillStyle=i.dark,e.fillRect(I,w,1,1),e.fillStyle=i.light,e.fillRect(I,w,1-E,1-E),e.fillStyle=i.base,e.fillRect(I+E,w+E,1-E*2,1-E*2)}})})}function Re(){G(r,y,0,0,Qe),r.fillStyle="rgba(0, 0, 0, 0.75)",r.fillRect(0,0,a,g),r.fillStyle="white",r.textAlign="center";let e="GAME OVER";v==="sprint"&&O<=0&&(e="YOU WIN!"),r.font='1.1px "Press Start 2P"',r.fillText(e,a/2,g/2-1.5),r.font='0.7px "Press Start 2P"',r.fillText("Press any key",a/2,g/2+1),r.fillText("to continue",a/2,g/2+2)}function Ne(){r.fillStyle="rgba(0, 0, 0, 0.75)",r.fillRect(0,0,a,g),r.fillStyle="white",r.textAlign="center",r.font='1.5px "Press Start 2P"',r.fillText("PAUSED",a/2,g/2)}function ct(){if(n.shapeIndex!==Ke||!q)return!1;const e=n.x+1,t=n.y+1,s=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let o=0;return s.forEach(([i,l])=>{(l<0||l>=a||i<0||i>=g||y[i][l]!==0)&&o++}),o>=3}function dt(e){let t=0;y.forEach((s,o)=>{s.every(i=>i>0)&&(t++,h.push(o))}),t>0&&(_=ve,F+=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(S+1),f.play(t>=4?"clearTetris":"clearLine"))}function ft(e){const t=S;z+=e,v==="sprint"&&(O-=e),v==="marathon"&&(S=Math.floor(z/10),S>t&&(De(S),f.play("levelUp")),ae=Math.max(200,1e3-S*75)),j()}function De(e){const t=Ee[e%Ee.length];document.documentElement.style.setProperty("--accent-color",t)}function j(){if(He.textContent=F.toString(),oe.textContent=z.toString(),Y.textContent=S.toString(),v==="sprint")pe.textContent=Math.max(0,O).toString();else if(v==="ultra"){const e=Math.floor(A/6e4),t=Math.floor(A%6e4/1e3);pe.textContent=`${e}:${t.toString().padStart(2,"0")}`}}function ut(){const e=localStorage.getItem("tetrisSettings");m=e?JSON.parse(e):{volume:.5,showGhost:!0},m.showGhost===void 0&&(m.showGhost=!0),f.volume=m.volume,we.value=m.volume.toString(),xe.checked=m.showGhost}function be(){localStorage.setItem("tetrisSettings",JSON.stringify(m))}function ht(){const e=localStorage.getItem("tetrisHighScores");b=e?JSON.parse(e):[],me()}function mt(){localStorage.setItem("tetrisHighScores",JSON.stringify(b))}function gt(){if(v==="sprint"&&O>0)return;const e={score:F,date:new Date().toISOString()};b.push(e),b.sort((t,s)=>s.score-t.score),b=b.slice(0,5),mt(),me()}function me(){_e.textContent=b.length>0?b[0].score.toString():"0"}function Q(){d||h.length>0||document.querySelector(".modal:not(.hidden)")||(p=!p,p?(f.play("pause"),cancelAnimationFrame(c),Ne()):(k=performance.now(),V(k)),K.textContent=p?"Resume":"Pause")}function pt(e){const t=e.key.toLowerCase();if(d&&c===0){ce();return}if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),de());return}if(t==="h"){e.preventDefault(),ke();return}if(!d&&(t==="p"||t==="escape")){e.preventDefault(),Q();return}if(!(d||p||h.length>0||!c)){switch(t){case"arrowleft":e.preventDefault(),Se(-1);break;case"arrowright":e.preventDefault(),Se(1);break;case"arrowdown":e.preventDefault(),Ae(),f.play("softDrop");break;case"arrowup":e.preventDefault(),lt();break;case" ":for(e.preventDefault();M(n.shape,n.x,n.y+1);)n.y++;Ce(),f.play("hardDrop");break;case"c":e.preventDefault(),it();break;case"q":e.preventDefault(),Me();break}W()}}Ze();
