(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function n(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=n(s);fetch(s.href,l)}})();const ft={},g=10,x=20,Ke=300,Ve=100,ht=8,mt=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],gt=5,ke=3,pt=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"},{base:"#757575",light:"#a4a4a4",dark:"#494949"}],Ue=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],vt={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},yt={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"},Et={marathon:"Classic",sprint:"Sprint (40L)",ultra:"Ultra (3 Min)",puzzle:"Puzzle",survival:"Survival",avalanche:"Avalanche"},b=document.getElementById("game-canvas"),St=document.getElementById("canvas-container"),u=b.getContext("2d"),Z=document.getElementById("next-canvas"),Be=Z.getContext("2d"),ee=document.getElementById("hold-canvas"),we=ee.getContext("2d"),xe=document.getElementById("score"),G=document.getElementById("lines"),ue=document.getElementById("level"),bt=document.getElementById("high-score"),le=document.getElementById("pause-button"),$=document.getElementById("quit-button"),Te=document.getElementById("help-button"),Ae=document.getElementById("game-container"),K=document.getElementById("mode-display"),Me=document.getElementById("mode-label"),Ie=document.getElementById("mode-value"),je=document.getElementById("game-mode-display-desktop-container"),Lt=document.getElementById("game-mode-display-desktop"),Pe=document.getElementById("mc-pause"),Mt=document.getElementById("mc-help"),ye=document.getElementById("mc-quit"),De=document.getElementById("main-menu"),V=document.querySelectorAll("#menu-button-group button"),It=document.getElementById("menu-marathon-button"),Bt=document.getElementById("menu-sprint-button"),wt=document.getElementById("menu-ultra-button"),xt=document.getElementById("menu-puzzle-button"),Ct=document.getElementById("menu-survival-button"),kt=document.getElementById("menu-avalanche-button"),Tt=document.getElementById("menu-high-scores-button"),At=document.getElementById("menu-settings-button"),Pt=document.getElementById("menu-help-button"),Dt=document.getElementById("help-modal"),Ot=document.getElementById("high-scores-modal"),Rt=document.getElementById("settings-modal"),zt=document.getElementById("game-over-modal"),Nt=document.getElementById("game-over-title"),_t=document.getElementById("game-over-score"),Ht=document.getElementById("game-over-high-score"),Gt=document.getElementById("game-over-restart-button"),qt=document.getElementById("game-over-menu-button"),Ce=document.getElementById("high-scores-table"),Fe=document.getElementById("high-scores-tabs"),Qe=document.getElementById("volume-slider"),Ze=document.getElementById("ghost-style-select");let d,a,te,N,me,ge,Y,F,I,D,r=!0,f,pe,Oe,q,M,c=[],ne,W,j=null,re,T,k,B,i,z=0,P=0,We=0,Xe=0,$e=0,H,ce,U,_,fe,Q,he,L,oe;const p={sounds:{},volume:.5,loadSounds:function(){console.log("Attempting to load sound files...");const e=["clearLine","clearTetris","gameOver","hardDrop","levelUp","lock","combo","move","rotate","softDrop","hold","pause"],t=typeof ft<"u"?"/Tetris/":"/";e.forEach(n=>{console.log(`- Loading sound: ${n}`);const o=new Audio,s=document.createElement("source");s.src=`${t}sounds/${n}.wav`,s.type="audio/wav";const l=document.createElement("source");l.src=`${t}sounds/${n}.mp3`,l.type="audio/mpeg",o.appendChild(s),o.appendChild(l),this.sounds[n]=o}),console.log("Sound loading finished.")},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(n=>console.error(`Error playing sound ${e}:`,n.message))}}};function w(){if(!(!u||!d)){if(u.clearRect(0,0,b.width,b.height),se(u,d,0,0),W>0&&j&&(u.fillStyle=`rgba(255, 255, 255, ${.8*(W/Ve)})`,j.shape.forEach((e,t)=>{e.forEach((n,o)=>{n>0&&u.fillRect(j.x+o,j.y+t,1,1)})})),!r&&a&&!L){if(B.ghostStyle!=="off"){let e=a.y;for(;C(a.shape,a.x,e+1);)e++;Ut(u,a.shape,a.x,e,B.ghostStyle)}se(u,a.shape,a.x,a.y)}if(c.length>0){const e=Math.abs(Math.sin(ne/Ke*Math.PI*2));u.fillStyle=`rgba(255, 255, 255, ${e*.9})`,c.forEach(t=>{u.fillRect(0,t,g,1)})}}}function se(e,t,n,o,s){t.forEach((l,h)=>{l.forEach((A,E)=>{if(A>0){if(c.includes(Math.floor(h+o)))return;const v=s||pt[A],m=E+n,y=h+o,S=.1;e.fillStyle=v.dark,e.fillRect(m,y,1,1),e.fillStyle=v.light,e.fillRect(m,y,1-S,1-S),e.fillStyle=v.base,e.fillRect(m+S,y+S,1-S*2,1-S*2)}})})}function Ut(e,t,n,o,s){if(s==="solid"){const l=vt;t.forEach((h,A)=>{h.forEach((E,v)=>{if(E>0){const m=v+n,y=A+o,S=.1;e.fillStyle=l.dark,e.fillRect(m,y,1,1),e.fillStyle=l.light,e.fillRect(m,y,1-S,1-S),e.fillStyle=l.base,e.fillRect(m+S,y+S,1-S*2,1-S*2)}})})}else s==="outline"&&(e.strokeStyle="rgba(255, 255, 255, 0.6)",e.lineWidth=.1,t.forEach((l,h)=>{l.forEach((A,E)=>{if(A>0){const v=E+n,m=h+o,y=e.lineWidth/2;e.strokeRect(v+y,m+y,1-e.lineWidth,1-e.lineWidth)}})}))}function et(){if(Be.clearRect(0,0,Z.width,Z.height),!te)return;const{shape:e,shapeIndex:t}=te,n=(4-e[0].length)/2;let o=(4-e.length)/2;t!==ke&&(o+=.5),se(Be,e,n,o)}function Re(){if(we.clearRect(0,0,ee.width,ee.height),!N)return;const{shape:e,shapeIndex:t}=N,n=(4-e[0].length)/2;let o=(4-e.length)/2;t!==ke&&(o+=.5),se(we,e,n,o)}function tt(){se(u,d,0,0,yt),u.fillStyle="rgba(0, 0, 0, 0.75)",u.fillRect(0,0,g,x)}function nt(){u.fillStyle="rgba(0, 0, 0, 0.75)",u.fillRect(0,0,g,x),u.fillStyle="white",u.textAlign="center",u.font='1.5px "Press Start 2P"',u.fillText("PAUSED",g/2,x/2)}function Ft(){const e=localStorage.getItem("tetrisSettings"),t=e?JSON.parse(e):null,n={volume:.5,ghostStyle:"solid"};t?(typeof t.showGhost<"u"&&(t.ghostStyle=t.showGhost?"solid":"off",delete t.showGhost),B={...n,...t}):B=n,p.volume=B.volume,Qe.value=B.volume.toString(),Ze.value=B.ghostStyle}function Ye(){localStorage.setItem("tetrisSettings",JSON.stringify(B))}function Wt(){const e=localStorage.getItem("tetrisHighScores");D=e?JSON.parse(e):{},_e()}function Xt(){localStorage.setItem("tetrisHighScores",JSON.stringify(D))}function $t(){if(i==="sprint"&&H>0)return;const t={score:i==="sprint"?ce:Y,date:new Date().toISOString()},n=D[i]||[];n.push(t),i==="sprint"?n.sort((o,s)=>o.score-s.score):n.sort((o,s)=>s.score-o.score),D[i]=n.slice(0,5),Xt(),_e()}function ot(){document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden")),De.classList.remove("hidden"),Ae.classList.add("hidden"),K.classList.add("hidden"),je.classList.add("hidden"),z=0,st()}function Yt(){De.classList.add("hidden"),Ae.classList.remove("hidden"),Ne()}function ae(){M&&!f&&!r&&O(),Dt.classList.remove("hidden")}function Jt(){M&&!f&&!r&&O(),Rt.classList.remove("hidden")}function Kt(){const e=Object.keys(D),t=[{id:"marathon",name:"Classic"},{id:"sprint",name:"Sprint"},{id:"ultra",name:"Ultra"},{id:"puzzle",name:"Puzzle"},{id:"survival",name:"Survival"},{id:"avalanche",name:"Avalanche"}];Fe.innerHTML="";let n=!1;t.forEach(o=>{if(e.includes(o.id)){const s=document.createElement("button");s.className="hs-tab-btn",s.textContent=o.name,s.dataset.mode=o.id,s.addEventListener("click",()=>Je(o.id)),Fe.appendChild(s),n||(s.classList.add("active"),Je(o.id),n=!0)}}),n||(Ce.innerHTML='<tbody><tr><td colspan="2">No scores yet!</td></tr></tbody>'),Ot.classList.remove("hidden")}function Vt(){let e="GAME OVER";i==="sprint"&&H<=0?e="YOU WIN!":i==="puzzle"&&_<=0&&(e="OUT OF TURNS"),Nt.textContent=e;const t=i==="sprint"?ie(ce):Y.toString();_t.textContent=t;const n=D[i]||[];let o=i==="sprint"?"N/A":"0";n.length>0&&(o=i==="sprint"?ie(n[0].score):n[0].score.toString()),Ht.textContent=o,zt.classList.remove("hidden")}function ze(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=f;document.querySelectorAll(".modal").forEach(n=>n.classList.add("hidden")),t&&M&&!r&&(f=!1,O())}function Ne(){const e=window.innerWidth<=768,t=window.innerHeight>window.innerWidth;if(e&&t){const o=St.getBoundingClientRect();T=Math.max(1,Math.min(Math.floor(o.height/x),Math.floor(o.width/g))),k=Math.floor(T*.8)}else{let s=Ae.getBoundingClientRect().width;e||(s-=252),T=Math.max(1,Math.min(Math.floor(window.innerHeight*.9/x),Math.floor(s*.95/g))),k=Math.floor(T*.7)}b.width=g*T,b.height=x*T,u.scale(T,T);const n=document.getElementById("side-panel");n.style.height=!e||!t?`${b.height}px`:"auto",Z.width=4*k,Z.height=4*k,Be.scale(k,k),ee.width=4*k,ee.height=4*k,we.scale(k,k),te&&et(),N&&Re(),d&&(w(),r&&tt())}function J(){const e=(t,n)=>{if(t.textContent!==n){t.textContent=n;const o=t.parentElement;if(o.classList.contains("stat-update"))return;o.classList.add("stat-update"),o.addEventListener("animationend",()=>o.classList.remove("stat-update"),{once:!0})}};if(e(xe,Y.toString()),e(G,F.toString()),e(ue,I.toString()),i==="sprint")Ie.textContent=ie(ce),G.textContent=Math.max(0,H).toString();else if(i==="ultra"){const t=Math.floor(U/6e4),n=Math.floor(U%6e4/1e3);Ie.textContent=`${t}:${n.toString().padStart(2,"0")}`}else i==="puzzle"&&(Ie.textContent=Math.max(0,_).toString())}function _e(){if(!i)return;const e=D[i];let t="0";e&&e.length>0&&(t=i==="sprint"?ie(e[0].score):e[0].score.toString()),bt.textContent=t}function st(){V.forEach((e,t)=>{e.classList.toggle("selected",t===z)})}function Je(e){document.querySelectorAll(".hs-tab-btn").forEach(s=>{s.classList.toggle("active",s.dataset.mode===e)});const t=D[e]||[],n=Ce.querySelector("tbody");n&&n.remove();const o=document.createElement("tbody");t.length===0?o.innerHTML='<tr><td colspan="2">No scores for this mode!</td></tr>':t.forEach((s,l)=>{const h=e==="sprint"?ie(s.score):s.score.toString();o.innerHTML+=`<tr><td>${l+1}.</td><td>${h}</td></tr>`}),Ce.appendChild(o)}function jt(){return Array.from({length:x},()=>Array(g).fill(0))}function at(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}ge.push(...e)}function it(){ge.length===0&&at();const e=ge.shift();return{shape:mt[e],shapeIndex:e}}function Ee(){a={...te,x:Math.floor(g/2)-1,y:0},lt(),re=!1,me=!0,C(a.shape,a.x,a.y)||Le()}function lt(){te=it(),et()}function Se(){r||(C(a.shape,a.x,a.y+1)?(a.y++,re=!1):de(),pe=0)}function X(e){r||C(a.shape,a.x+e,a.y)&&(a.x+=e,re=!1,p.play("move"))}function be(){if(r||i==="puzzle"&&a.shapeIndex===ke)return;const e=Qt(a.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[n,o]of t)if(C(e,a.x+n,a.y+o)){a.x+=n,a.y+=o,a.shape=e,re=!0,i==="puzzle"&&Ge(),p.play("rotate");return}}function Qt(e){return e[0].map((t,n)=>e.map(o=>o[n])).map(t=>t.reverse())}function He(){if(!me||r||i==="puzzle"&&_<=0||(p.play("hold"),i==="puzzle"&&Ge(),r))return;const e=a.x,t=a.y,n={shape:a.shape,shapeIndex:a.shapeIndex};let o=N?{...N,x:e,y:t}:{...it(),x:Math.floor(g/2)-1,y:0};C(o.shape,o.x,o.y)&&(a=o,N=n,me=!1,Re(),J())}function de(){const e=Zt();j={shape:a.shape,x:a.x,y:a.y},W=Ve,a.shape.forEach((t,n)=>{t.forEach((o,s)=>{o>0&&a.y+n>=0&&(d[a.y+n][a.x+s]=o)})}),i==="puzzle"&&Ge(),rt(e),c.length===0&&!r&&(e&&(Y+=400*(I+1),J()),Ee()),p.play("lock")}function C(e,t,n){for(let o=0;o<e.length;o++)for(let s=0;s<e[o].length;s++)if(e[o][s]!==0){const l=t+s,h=n+o;if(l<0||l>=g||h>=x||h>=0&&d[h][l]!==0)return!1}return!0}function rt(e){let t=0;if(d.forEach((n,o)=>{n.every(s=>s>0)&&(t++,c.push(o))}),t>0){i==="avalanche"&&(L=!0),ne=Ke;const n=[400,800,1200,1600],o=[0,100,300,500,800];let s=0;t>=4?s=o[4]*(I+1):e?s=n[t]*(I+1):s=o[t]*(I+1),i==="avalanche"&&oe>0&&(s*=1+oe*.5,p.play("combo")),Y+=Math.round(s),p.play(t>=4?"clearTetris":"clearLine")}}function ct(e){const t=I;F+=e,i==="sprint"&&(H-=e),(i==="marathon"||i==="survival"||i==="avalanche"||i==="puzzle")&&(I=Math.floor(F/10),I>t&&(dt(I),p.play("levelUp")),(i==="marathon"||i==="survival"||i==="avalanche")&&(Oe=Math.max(200,1e3-I*75))),J()}function dt(e){const t=Ue[e%Ue.length];document.documentElement.style.setProperty("--accent-color",t)}function ie(e){const t=e/1e3,n=Math.floor(t/60),o=Math.floor(t%60),s=Math.floor(e%1e3);return`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}.${s.toString().padStart(3,"0")}`}function Zt(){if(i==="avalanche"||a.shapeIndex!==gt||!re)return!1;const e=a.x+1,t=a.y+1,n=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let o=0;return n.forEach(([s,l])=>{(l<0||l>=g||s<0||s>=x||d[s][l]!==0)&&o++}),o>=3}function Ge(){i!=="puzzle"||r||_>0&&(_--,J(),_<=0&&setTimeout(()=>Le(),100))}function en(e){for(let n=0;n<e;n++)for(let o=0;o<g;o++)if(d[n][o]!==0){Le();return}d.splice(0,e);const t=Math.floor(Math.random()*g);for(let n=0;n<e;n++){const o=Array(g).fill(ht).map((s,l)=>l===t?0:s);d.push(o)}}function tn(){oe++;const e=c.length;c.forEach(t=>{for(let n=0;n<g;n++)d[t][n]=0}),c=[],nn(),ct(e),d.forEach((t,n)=>{t.every(o=>o>0)&&c.push(n)}),c.length>0?rt(!1):(L=!1,oe=0,Ee()),w()}function nn(){for(let e=0;e<g;e++){let t=x-1;for(let n=x-1;n>=0;n--)d[n][e]!==0&&(n!==t&&(d[t][e]=d[n][e],d[n][e]=0),t--)}}function R(e){switch(i=e,Yt(),M&&cancelAnimationFrame(M),d=jt(),Y=0,F=0,I=0,r=!1,f=!1,pe=0,Oe=1e3,q=0,M=0,c=[],ne=0,W=0,N=null,me=!0,ge=[],L=!1,oe=0,P=0,Lt.textContent=Et[i],je.classList.remove("hidden"),xe.parentElement.classList.remove("hidden"),ue.parentElement.classList.remove("hidden"),G.parentElement.classList.remove("hidden"),K.classList.add("hidden"),G.previousElementSibling.textContent="LINES",i){case"sprint":H=40,ce=0,Me.textContent="TIME",K.classList.remove("hidden"),G.previousElementSibling.textContent="LINES LEFT",ue.parentElement.classList.add("hidden"),xe.parentElement.classList.add("hidden");break;case"ultra":U=3*60*1e3,Me.textContent="TIME",K.classList.remove("hidden"),ue.parentElement.classList.add("hidden"),G.parentElement.classList.add("hidden");break;case"puzzle":_=50,Me.textContent="TURNS",K.classList.remove("hidden");break;case"survival":Q=1e4,fe=Q,he=1;break}at(),dt(I),ze(),J(),_e(),lt(),Ee(),Re(),le.textContent="Pause",Pe.textContent="❚❚",$.classList.remove("hidden"),ye.classList.remove("hidden"),qe(0)}function qe(e=0){if(r)return;if(M=requestAnimationFrame(qe),f){nt();return}const t=q===0?0:e-q;if(q=e,i==="sprint"&&H>0?ce+=t:i==="ultra"?U=Math.max(0,U-t):i==="survival"&&!L&&(fe-=t,fe<=0&&(en(he),Q=Math.max(3e3,Q*.97),F>30&&F%10===0&&(he=Math.min(4,he+1)),fe=Q)),(i==="sprint"&&H<=0||i==="ultra"&&U<=0)&&Le(),W>0&&(W-=t),c.length>0){if(ne-=t,ne<=0)if(i==="avalanche")tn();else{let n=c.length;c.sort((o,s)=>o-s).forEach(o=>{d.splice(o,1),d.unshift(Array(g).fill(0))}),c=[],ct(n),r||Ee()}}else L||(pe+=t,pe>Oe&&Se());r||(J(),w())}function Le(){r||(r=!0,p.play("gameOver"),$t(),tt(),Vt(),cancelAnimationFrame(M),M=0,$.classList.add("hidden"),ye.classList.add("hidden"))}function ve(){M&&(cancelAnimationFrame(M),M=0),r=!0,$.classList.add("hidden"),ye.classList.add("hidden"),ot()}function O(){r||c.length>0||document.querySelector(".modal:not(.hidden)")||(f=!f,f?(p.play("pause"),cancelAnimationFrame(M),P=0,ut(),nt()):(q=performance.now(),qe(q)),le.textContent=f?"Resume":"Pause",Pe.textContent=f?"▶":"❚❚")}function on(e){const t=e.key.toLowerCase();if(!De.classList.contains("hidden")){e.preventDefault(),t==="arrowdown"?z=(z+1)%V.length:t==="arrowup"?z=(z-1+V.length)%V.length:t==="enter"&&V[z].click(),st();return}if(!r){if(document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),ze());return}if(f){e.preventDefault();const n=[le,$,Te];t==="arrowdown"?P=(P+1)%n.length:t==="arrowup"?P=(P-1+n.length)%n.length:t==="enter"?n[P].click():(t==="p"||t==="escape")&&O(),ut();return}if(t==="h"){e.preventDefault(),ae();return}if(t==="p"||t==="escape"){e.preventDefault(),O();return}if(!(c.length>0||L)){switch(t){case"arrowleft":e.preventDefault(),X(-1);break;case"arrowright":e.preventDefault(),X(1);break;case"arrowdown":e.preventDefault(),Se(),p.play("softDrop");break;case"arrowup":e.preventDefault(),be();break;case"enter":case" ":for(e.preventDefault();C(a.shape,a.x,a.y+1);)a.y++;de(),p.play("hardDrop");break;case"c":e.preventDefault(),He();break;case"q":e.preventDefault(),ve();break}w()}}}function sn(){const e=document.getElementById("mc-left"),t=document.getElementById("mc-right"),n=document.getElementById("mc-down"),o=document.getElementById("mc-rotate"),s=document.getElementById("mc-hard-drop"),l=document.getElementById("mc-hold"),h=(m=25)=>{"vibrate"in navigator&&navigator.vibrate(m)},A=()=>{for(;C(a.shape,a.x,a.y+1);)a.y++;de()},E=(m,y)=>S=>{S.preventDefault(),h(),!((f||r||c.length>0||L||document.querySelector(".modal:not(.hidden)"))&&m!==O&&m!==ae)&&(m(),y&&p.play(y),f||w())},v=(m,y)=>{m.addEventListener("touchstart",y,{passive:!1}),m.addEventListener("mousedown",y,{passive:!1})};v(e,E(()=>X(-1))),v(t,E(()=>X(1))),v(n,E(Se,"softDrop")),v(o,E(be)),v(l,E(He)),v(s,E(A,"hardDrop")),v(Pe,E(O)),v(Mt,E(ae)),v(ye,E(ve))}function an(){b.addEventListener("touchstart",e=>{e.preventDefault(),We=e.touches[0].clientX,Xe=e.touches[0].clientY,$e=performance.now()},{passive:!1}),b.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}),b.addEventListener("touchend",e=>{if(e.preventDefault(),f||r||c.length>0||L||document.querySelector(".modal:not(.hidden)"))return;const t=e.changedTouches[0].clientX-We,n=e.changedTouches[0].clientY-Xe,o=performance.now()-$e;if(o<200&&Math.abs(t)<10&&Math.abs(n)<10)be();else if(Math.abs(t)>Math.abs(n))t>30?X(1):t<-30&&X(-1);else if(n>30)if(n/o>1){for(;C(a.shape,a.x,a.y+1);)a.y++;de(),p.play("hardDrop")}else Se(),p.play("softDrop");w()},{passive:!1})}function ln(){if("ontouchstart"in window||navigator.maxTouchPoints>0)return;let e=-1;b.addEventListener("mousemove",t=>{if(f||r||c.length>0||L||!a)return;const n=b.getBoundingClientRect(),o=Math.floor((t.clientX-n.left)/T)-Math.floor(a.shape[0].length/2);o!==e&&(C(a.shape,o,a.y)&&(a.x=o,w()),e=o)}),b.addEventListener("click",t=>{if(!(f||r||c.length>0||L)&&(t.preventDefault(),t.button===0)){for(;C(a.shape,a.x,a.y+1);)a.y++;de(),p.play("hardDrop"),w()}}),b.addEventListener("contextmenu",t=>{f||r||c.length>0||L||(t.preventDefault(),He(),w())}),b.addEventListener("wheel",t=>{f||r||c.length>0||L||(t.preventDefault(),be(),w())},{passive:!1})}function ut(){[le,$,Te].forEach((t,n)=>{n===P&&t.focus()})}function rn(){It.addEventListener("click",()=>R("marathon")),Bt.addEventListener("click",()=>R("sprint")),wt.addEventListener("click",()=>R("ultra")),xt.addEventListener("click",()=>R("puzzle")),Ct.addEventListener("click",()=>R("survival")),kt.addEventListener("click",()=>R("avalanche")),Tt.addEventListener("click",Kt),At.addEventListener("click",Jt),Pt.addEventListener("click",ae),le.addEventListener("click",O),$.addEventListener("click",ve),Te.addEventListener("click",ae),document.querySelectorAll(".close-button").forEach(e=>e.addEventListener("click",ze)),Gt.addEventListener("click",()=>R(i)),qt.addEventListener("click",ve),Qe.addEventListener("input",e=>{B.volume=parseFloat(e.target.value),p.volume=B.volume,Ye()}),Ze.addEventListener("change",e=>{B.ghostStyle=e.target.value,Ye(),r||w()}),document.addEventListener("keydown",on),window.addEventListener("resize",Ne),sn(),an(),ln()}function cn(){p.loadSounds(),Ft(),Wt(),rn(),Ne(),ot()}cn();
