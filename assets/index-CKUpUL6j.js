(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&l(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(i){if(i.ep)return;i.ep=!0;const r=o(i);fetch(i.href,r)}})();const s=10,f=20,P=document.getElementById("game-canvas"),c=P.getContext("2d"),L=document.getElementById("next-canvas"),D=L.getContext("2d"),oe=document.getElementById("score"),le=document.getElementById("lines"),re=document.getElementById("level"),ce=document.getElementById("high-score"),S=document.getElementById("start-button"),se=document.getElementById("help-button"),H=document.getElementById("help-modal"),ae=document.querySelector(".close-button"),X=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],fe=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],z=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],W={base:"#555",light:"#888",dark:"#333"},de={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let m,t,O,v,I,p,R,h,d,M,F,G,g,x,k;function he(){Se(),S.addEventListener("click",()=>{if(h){q();return}g&&!h?ie():q()}),document.addEventListener("keydown",we),se.addEventListener("click",Pe),ae.addEventListener("click",U),window.addEventListener("resize",_),_(),N()}function _(){const e=window.innerHeight;document.body.clientWidth;const n=document.getElementById("game-container"),o=document.getElementById("side-panel");let l=n.clientWidth;window.innerWidth>768&&(l-=o.clientWidth+32);const i=Math.floor(e*.9/f),r=Math.floor(l*.95/s);x=Math.min(i,r),P.width=s*x,P.height=f*x,window.innerWidth>768?o.style.height=`${P.height}px`:o.style.height="auto",c.scale(x,x),k=Math.floor(x*.7),L.width=4*k,L.height=4*k,D.scale(k,k),O&&j(),h?(A(),J()):d?(A(),Q()):!g&&m&&A()}function q(){g&&cancelAnimationFrame(g),m=ue(),v=0,I=0,p=0,h=!1,d=!1,M=0,F=1e3,G=0,g=0,te(p),U(),ne(),Y(),N(),V(),S.textContent="Pause",$(0)}function ue(){return Array.from({length:f},()=>Array(s).fill(0))}function V(){t={...O,x:Math.floor(s/2)-1,y:0},N(),y(t.shape,t.x,t.y)||(h=!0)}function N(){O=ge(),j()}function ge(){const e=Math.floor(Math.random()*X.length);return{shape:X[e]}}function $(e=0){if(g=requestAnimationFrame($),d){Q();return}if(h){xe(),J(),cancelAnimationFrame(g),g=0,S.textContent="Start Game";return}const n=e-G;G=e,M+=n,M>F&&Z(),A()}function A(){c.clearRect(0,0,P.width,P.height),B(c,m,0,0);let e=t.y;for(;y(t.shape,t.x,e+1);)e++;pe(c,t.shape,t.x,e),B(c,t.shape,t.x,t.y)}function j(){D.clearRect(0,0,L.width,L.height);const{shape:e}=O,n=(4-e[0].length)/2,o=(4-e.length)/2;B(D,e,n,o)}function B(e,n,o,l,i){n.forEach((r,a)=>{r.forEach((C,w)=>{if(C>0){const b=i||fe[C],u=w+o,T=a+l,E=.1;e.fillStyle=b.dark,e.fillRect(u,T,1,1),e.fillStyle=b.light,e.fillRect(u,T,1-E,1-E),e.fillStyle=b.base,e.fillRect(u+E,T+E,1-E*2,1-E*2)}})})}function pe(e,n,o,l){n.forEach((i,r)=>{i.forEach((a,C)=>{if(a>0){const w=C+o,b=r+l,u=.1;e.fillStyle=W.dark,e.fillRect(w,b,1,1),e.fillStyle=W.light,e.fillRect(w,b,1-u,1-u),e.fillStyle=W.base,e.fillRect(w+u,b+u,1-u*2,1-u*2)}})})}function J(){B(c,m,0,0,de),c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,s,f),c.fillStyle="white",c.textAlign="center",c.font='1.1px "Press Start 2P"',c.fillText("GAME OVER",s/2,f/2-1.5),c.font='0.7px "Press Start 2P"',c.fillText("Press Start",s/2,f/2+.5),c.fillText("to Play Again",s/2,f/2+1.5)}function Q(){c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,s,f),c.fillStyle="white",c.textAlign="center",c.font='1.5px "Press Start 2P"',c.fillText("PAUSED",s/2,f/2)}function Z(){y(t.shape,t.x,t.y+1)?t.y++:ee(),M=0}function K(e){y(t.shape,t.x+e,t.y)&&(t.x+=e)}function me(){const e=t.shape,n=ye(e);let o=1;y(n,t.x,t.y)?t.shape=n:y(n,t.x+o,t.y)?(t.x+=o,t.shape=n):y(n,t.x-o,t.y)&&(t.x-=o,t.shape=n)}function ye(e){return e[0].map((o,l)=>e.map(i=>i[l])).map(o=>o.reverse())}function y(e,n,o){for(let l=0;l<e.length;l++)for(let i=0;i<e[l].length;i++)if(e[l][i]!==0){const r=n+i,a=o+l;if(r<0||r>=s||a>=f||a>=0&&m[a][r]!==0)return!1}return!0}function ee(){t.shape.forEach((e,n)=>{e.forEach((o,l)=>{o>0&&t.y+n>=0&&(m[t.y+n][t.x+l]=o)})}),be(),V()}function be(){let e=0;e:for(let n=f-1;n>=0;n--){for(let l=0;l<s;l++)if(m[n][l]===0)continue e;const o=m.splice(n,1)[0].fill(0);m.unshift(o),n++,e++}if(e>0){const n=p;I+=e,v+=[0,100,300,500,800][e]*(p+1),p=Math.floor(I/10),p>n&&te(p),F=Math.max(200,1e3-p*75),ne()}}function te(e){const n=z[e%z.length];document.documentElement.style.setProperty("--accent-color",n)}function ne(){oe.textContent=v.toString(),le.textContent=I.toString(),re.textContent=p.toString()}function Se(){const e=localStorage.getItem("tetrisHighScore");R=e?parseInt(e,10):0,Y()}function Ee(){localStorage.setItem("tetrisHighScore",R.toString())}function xe(){v>R&&(R=v,Ee(),Y())}function Y(){ce.textContent=R.toString()}function ie(){h||d&&!H.classList.contains("hidden")||(d=!d,S.textContent=d?"Resume":"Pause")}function Pe(){g&&!d&&!h&&(d=!0,S.textContent="Resume"),H.classList.remove("hidden")}function U(){g&&!h&&S.textContent==="Resume"&&(d=!1,S.textContent="Pause"),H.classList.add("hidden")}function we(e){if(!h&&(e.key==="p"||e.key==="P"||e.key==="Escape")){e.preventDefault(),!H.classList.contains("hidden")&&e.key==="Escape"?U():ie();return}if(!(h||d)){switch(e.key){case"ArrowLeft":e.preventDefault(),K(-1);break;case"ArrowRight":e.preventDefault(),K(1);break;case"ArrowDown":e.preventDefault(),Z();break;case"ArrowUp":e.preventDefault(),me();break;case" ":for(e.preventDefault();y(t.shape,t.x,t.y+1);)t.y++;ee();break}A()}}he();
