(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const mt={},v=10,k=20,Je=300,Ke=100,pt=8,b=document.getElementById("game-canvas"),gt=document.getElementById("canvas-container"),p=b.getContext("2d"),Z=document.getElementById("next-canvas"),Be=Z.getContext("2d"),ee=document.getElementById("hold-canvas"),ke=ee.getContext("2d"),Ce=document.getElementById("score"),H=document.getElementById("lines"),he=document.getElementById("level"),vt=document.getElementById("high-score"),ce=document.getElementById("pause-button"),U=document.getElementById("quit-button"),Pe=document.getElementById("help-button"),Oe=document.getElementById("game-container"),J=document.getElementById("mode-display"),Ie=document.getElementById("mode-label"),we=document.getElementById("mode-value"),je=document.getElementById("game-mode-display-desktop-container"),yt=document.getElementById("game-mode-display-desktop"),ge=document.getElementById("mc-pause"),qe=document.getElementById("mc-help"),te=document.getElementById("mc-quit"),De=document.getElementById("main-menu"),K=document.querySelectorAll("#menu-button-group button"),Et=document.getElementById("menu-marathon-button"),St=document.getElementById("menu-sprint-button"),bt=document.getElementById("menu-ultra-button"),Lt=document.getElementById("menu-puzzle-button"),Mt=document.getElementById("menu-survival-button"),It=document.getElementById("menu-avalanche-button"),wt=document.getElementById("menu-high-scores-button"),Bt=document.getElementById("menu-settings-button"),kt=document.getElementById("menu-help-button"),Ct=document.getElementById("help-modal"),xt=document.getElementById("high-scores-modal"),Tt=document.getElementById("settings-modal"),At=document.getElementById("game-over-modal"),Pt=document.getElementById("game-over-title"),Ot=document.getElementById("game-over-score"),Dt=document.getElementById("game-over-high-score"),Rt=document.getElementById("game-over-restart-button"),zt=document.getElementById("game-over-menu-button"),xe=document.getElementById("high-scores-table"),Ue=document.getElementById("high-scores-tabs"),Qe=document.getElementById("volume-slider"),Ze=document.getElementById("ghost-style-select"),Nt=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],_t=5,Re=3,Ht=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"},{base:"#757575",light:"#a4a4a4",dark:"#494949"}],$e=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],Gt={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},Ft={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"},Wt={marathon:"Classic",sprint:"Sprint (40L)",ultra:"Ultra (3 Min)",puzzle:"Puzzle",survival:"Survival",avalanche:"Avalanche"};let m,a,ne,N,ve,ye,$,W,T,O,c=!0,g,Ee,ze,G,M,f=[],oe,X,j=null,de,A,x,w,l,z=0,P=0,et=0,tt=0,nt=0,Y,ue,F,_,me,Q,pe,L,se;const y={sounds:{},volume:.5,loadSounds:function(){console.log("Attempting to load sound files...");const e=["clearLine","clearTetris","gameOver","hardDrop","levelUp","lock","combo","move","rotate","softDrop","hold","pause"],t=typeof mt<"u"?"/Tetris/":"/";e.forEach(n=>{console.log(`- Loading sound: ${n}`);const o=new Audio,s=document.createElement("source");s.src=`${t}sounds/${n}.wav`,s.type="audio/wav";const i=document.createElement("source");i.src=`${t}sounds/${n}.mp3`,i.type="audio/mpeg",o.appendChild(s),o.appendChild(i),this.sounds[n]=o}),console.log("Sound loading finished.")},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(n=>console.error(`Error playing sound ${e}:`,n.message))}}};function Xt(){y.loadSounds(),nn(),on(),qt(),_e(),ot()}function qt(){Et.addEventListener("click",()=>R("marathon")),St.addEventListener("click",()=>R("sprint")),bt.addEventListener("click",()=>R("ultra")),Lt.addEventListener("click",()=>R("puzzle")),Mt.addEventListener("click",()=>R("survival")),It.addEventListener("click",()=>R("avalanche")),wt.addEventListener("click",$t),Bt.addEventListener("click",Yt),kt.addEventListener("click",ae),ce.addEventListener("click",D),U.addEventListener("click",Se),Pe.addEventListener("click",ae),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",Ne)}),Rt.addEventListener("click",()=>R(l)),zt.addEventListener("click",Se),Qe.addEventListener("input",e=>{w.volume=parseFloat(e.target.value),y.volume=w.volume,Ve()}),Ze.addEventListener("change",e=>{w.ghostStyle=e.target.value,Ve(),c||B()}),document.addEventListener("keydown",fn),window.addEventListener("resize",_e),ln(),rn(),un()}function ot(){document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden")),De.classList.remove("hidden"),Oe.classList.add("hidden"),J.classList.add("hidden"),je.classList.add("hidden"),z=0,Te()}function Te(){K.forEach((e,t)=>{t===z?e.classList.add("selected"):e.classList.remove("selected")})}function Ut(){De.classList.add("hidden"),Oe.classList.remove("hidden"),_e()}function ae(){M&&!g&&!c&&D(),Ct.classList.remove("hidden")}function $t(){const e=Object.keys(O),t=[{id:"marathon",name:"Classic"},{id:"sprint",name:"Sprint"},{id:"ultra",name:"Ultra"},{id:"puzzle",name:"Puzzle"},{id:"survival",name:"Survival"},{id:"avalanche",name:"Avalanche"}];Ue.innerHTML="";let n=!1;t.forEach(o=>{if(e.includes(o.id)){const s=document.createElement("button");s.className="hs-tab-btn",s.textContent=o.name,s.dataset.mode=o.id,s.addEventListener("click",()=>Ye(o.id)),Ue.appendChild(s),n||(s.classList.add("active"),Ye(o.id),n=!0)}}),n||(xe.innerHTML='<tbody><tr><td colspan="2">No scores yet!</td></tr></tbody>'),xt.classList.remove("hidden")}function Ye(e){document.querySelectorAll(".hs-tab-btn").forEach(s=>{s.classList.toggle("active",s.dataset.mode===e)});const t=O[e]||[],n=xe.querySelector("tbody");n&&n.remove();const o=document.createElement("tbody");t.length===0?o.innerHTML='<tr><td colspan="2">No scores for this mode!</td></tr>':t.forEach((s,i)=>{const r=e==="sprint"?re(s.score):s.score.toString(),d=`<tr><td>${i+1}.</td><td>${r}</td></tr>`;o.innerHTML+=d}),xe.appendChild(o)}function Yt(){M&&!g&&!c&&D(),Tt.classList.remove("hidden")}function Ne(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=g;document.querySelectorAll(".modal").forEach(n=>n.classList.add("hidden")),t&&M&&!c&&(g=!1,D())}function _e(){const e=window.innerWidth<=768,t=window.innerHeight>window.innerWidth;if(e&&t){const o=gt.getBoundingClientRect(),s=o.width,i=o.height,r=Math.floor(i/k),d=Math.floor(s/v);A=Math.max(1,Math.min(r,d)),x=Math.floor(A*.8)}else{const o=window.innerHeight;let i=Oe.getBoundingClientRect().width;e||(i-=252);const r=Math.floor(o*.9/k),d=Math.floor(i*.95/v);A=Math.max(1,Math.min(r,d)),x=Math.floor(A*.7)}b.width=v*A,b.height=k*A,p.scale(A,A);const n=document.getElementById("side-panel");!e||!t?n.style.height=`${b.height}px`:n.style.height="auto",Z.width=4*x,Z.height=4*x,Be.scale(x,x),ee.width=4*x,ee.height=4*x,ke.scale(x,x),ne&&lt(),N&&We(),m&&(B(),c&&rt())}function R(e){l=e,Ut(),M&&cancelAnimationFrame(M),m=Vt(),$=0,W=0,T=0,c=!1,g=!1,Ee=0,ze=1e3,G=0,M=0,f=[],oe=0,X=0,N=null,ve=!0,ye=[],L=!1,se=0,P=0;const t=Wt[l];switch(yt.textContent=t,je.classList.remove("hidden"),Ce.parentElement.classList.remove("hidden"),he.parentElement.classList.remove("hidden"),H.parentElement.classList.remove("hidden"),J.classList.add("hidden"),H.previousElementSibling.textContent="LINES",l){case"sprint":Y=40,ue=0,Ie.textContent="TIME",J.classList.remove("hidden"),H.previousElementSibling.textContent="LINES LEFT",he.parentElement.classList.add("hidden"),Ce.parentElement.classList.add("hidden");break;case"ultra":F=3*60*1e3,Ie.textContent="TIME",J.classList.remove("hidden"),he.parentElement.classList.add("hidden"),H.parentElement.classList.add("hidden");break;case"puzzle":_=50,Ie.textContent="TURNS",J.classList.remove("hidden");break;case"survival":Q=1e4,me=Q,pe=1;break}st(),ft(T),Ne(),V(),Xe(),it(),be(),We(),ce.textContent="Pause",ge.textContent="❚❚",U.classList.remove("hidden"),te.classList.remove("hidden"),He(0)}function Se(){M&&(cancelAnimationFrame(M),M=0),c=!0,U.classList.add("hidden"),te.classList.add("hidden"),ot()}function He(e=0){if(c)return;if(M=requestAnimationFrame(He),g){ct();return}const t=G===0?0:e-G;if(G=e,l==="sprint"?(ue+=t,Y<=0&&ie()):l==="ultra"?(F-=t,F<=0&&(F=0,ie())):l==="survival"&&!L&&(me-=t,me<=0&&(Zt(pe),Q=Math.max(3e3,Q*.97),W>30&&W%10===0&&(pe=Math.min(4,pe+1)),me=Q)),X>0&&(X-=t),f.length>0){if(oe-=t,oe<=0)if(l==="avalanche")en();else{let n=f.length;f.sort((o,s)=>o-s).forEach(o=>{m.splice(o,1),m.unshift(Array(v).fill(0))}),f=[],ut(n),c||be()}}else L||(Ee+=t,Ee>ze&&Le());c||(V(),B())}function ie(){c||(c=!0,y.play("gameOver"),an(),rt(),jt(),cancelAnimationFrame(M),M=0,U.classList.add("hidden"),te.classList.add("hidden"))}function Vt(){return Array.from({length:k},()=>Array(v).fill(0))}function st(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}ye.push(...e)}function at(){ye.length===0&&st();const e=ye.shift();return{shape:Nt[e],shapeIndex:e}}function be(){a={...ne,x:Math.floor(v/2)-1,y:0},it(),de=!1,ve=!0,C(a.shape,a.x,a.y)||ie()}function it(){ne=at(),lt()}function Ge(){l!=="puzzle"||c||_>0&&(_--,V(),_<=0&&setTimeout(()=>ie(),100))}function Fe(){if(!ve||c||l==="puzzle"&&_<=0||(y.play("hold"),l==="puzzle"&&Ge(),c))return;const e=a.x,t=a.y,n={shape:a.shape,shapeIndex:a.shapeIndex};let o;N?o={...N,x:e,y:t}:o={...at(),x:Math.floor(v/2)-1,y:0},C(o.shape,o.x,o.y)&&(a=o,N=n,ve=!1,We(),V())}function Le(){c||(C(a.shape,a.x,a.y+1)?(a.y++,de=!1):fe(),Ee=0)}function q(e){c||C(a.shape,a.x+e,a.y)&&(a.x+=e,de=!1,y.play("move"))}function Me(){if(c||l==="puzzle"&&a.shapeIndex===Re)return;const e=Jt(a.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[n,o]of t)if(C(e,a.x+n,a.y+o)){a.x+=n,a.y+=o,a.shape=e,de=!0,l==="puzzle"&&Ge(),y.play("rotate");return}}function Jt(e){return e[0].map((t,n)=>e.map(o=>o[n])).map(t=>t.reverse())}function C(e,t,n){for(let o=0;o<e.length;o++)for(let s=0;s<e[o].length;s++)if(e[o][s]!==0){const i=t+s,r=n+o;if(i<0||i>=v||r>=k||r>=0&&m[r][i]!==0)return!1}return!0}function fe(){const e=Qt();j={shape:a.shape,x:a.x,y:a.y},X=Ke,a.shape.forEach((t,n)=>{t.forEach((o,s)=>{o>0&&a.y+n>=0&&(m[a.y+n][a.x+s]=o)})}),l==="puzzle"&&Ge(),dt(e),f.length===0&&!c&&(e&&($+=400*(T+1),V()),be()),y.play("lock")}function B(){if(!(!p||!m)){if(p.clearRect(0,0,b.width,b.height),le(p,m,0,0),X>0&&j&&(p.fillStyle=`rgba(255, 255, 255, ${.8*(X/Ke)})`,j.shape.forEach((e,t)=>{e.forEach((n,o)=>{n>0&&p.fillRect(j.x+o,j.y+t,1,1)})})),!c&&a&&!L){if(w.ghostStyle!=="off"){let e=a.y;for(;C(a.shape,a.x,e+1);)e++;Kt(p,a.shape,a.x,e,w.ghostStyle)}le(p,a.shape,a.x,a.y)}if(f.length>0){const e=Math.abs(Math.sin(oe/Je*Math.PI*2));p.fillStyle=`rgba(255, 255, 255, ${e*.9})`,f.forEach(t=>{p.fillRect(0,t,v,1)})}}}function lt(){if(Be.clearRect(0,0,Z.width,Z.height),!ne)return;const{shape:e,shapeIndex:t}=ne,n=(4-e[0].length)/2;let o=(4-e.length)/2;t!==Re&&(o+=.5),le(Be,e,n,o)}function We(){if(ke.clearRect(0,0,ee.width,ee.height),!N)return;const{shape:e,shapeIndex:t}=N,n=(4-e[0].length)/2;let o=(4-e.length)/2;t!==Re&&(o+=.5),le(ke,e,n,o)}function le(e,t,n,o,s){t.forEach((i,r)=>{i.forEach((d,I)=>{if(d>0){if(f.includes(Math.floor(r+o)))return;const u=s||Ht[d],h=I+n,E=r+o,S=.1;e.fillStyle=u.dark,e.fillRect(h,E,1,1),e.fillStyle=u.light,e.fillRect(h,E,1-S,1-S),e.fillStyle=u.base,e.fillRect(h+S,E+S,1-S*2,1-S*2)}})})}function Kt(e,t,n,o,s){if(s==="solid"){const i=Gt;t.forEach((r,d)=>{r.forEach((I,u)=>{if(I>0){const h=u+n,E=d+o,S=.1;e.fillStyle=i.dark,e.fillRect(h,E,1,1),e.fillStyle=i.light,e.fillRect(h,E,1-S,1-S),e.fillStyle=i.base,e.fillRect(h+S,E+S,1-S*2,1-S*2)}})})}else s==="outline"&&(e.strokeStyle="rgba(255, 255, 255, 0.6)",e.lineWidth=.1,t.forEach((i,r)=>{i.forEach((d,I)=>{if(d>0){const u=I+n,h=r+o,E=e.lineWidth/2;e.strokeRect(u+E,h+E,1-e.lineWidth,1-e.lineWidth)}})}))}function rt(){le(p,m,0,0,Ft),p.fillStyle="rgba(0, 0, 0, 0.75)",p.fillRect(0,0,v,k)}function jt(){let e="GAME OVER";l==="sprint"&&Y<=0?e="YOU WIN!":l==="puzzle"&&_<=0&&(e="OUT OF TURNS"),Pt.textContent=e;const t=l==="sprint"?re(ue):$.toString();Ot.textContent=t;const n=O[l]||[];let o=l==="sprint"?"N/A":"0";n.length>0&&(o=l==="sprint"?re(n[0].score):n[0].score.toString()),Dt.textContent=o,At.classList.remove("hidden")}function ct(){p.fillStyle="rgba(0, 0, 0, 0.75)",p.fillRect(0,0,v,k),p.fillStyle="white",p.textAlign="center",p.font='1.5px "Press Start 2P"',p.fillText("PAUSED",v/2,k/2)}function Qt(){if(l==="avalanche"||a.shapeIndex!==_t||!de)return!1;const e=a.x+1,t=a.y+1,n=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let o=0;return n.forEach(([s,i])=>{(i<0||i>=v||s<0||s>=k||m[s][i]!==0)&&o++}),o>=3}function dt(e){let t=0;if(m.forEach((n,o)=>{n.every(s=>s>0)&&(t++,f.push(o))}),t>0){l==="avalanche"&&(L=!0),oe=Je;let s=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(T+1);l==="avalanche"&&se>0&&(s*=1+se*.5,y.play("combo")),$+=Math.round(s),y.play(t>=4?"clearTetris":"clearLine")}}function ut(e){const t=T;W+=e,l==="sprint"&&(Y-=e),(l==="marathon"||l==="survival"||l==="avalanche"||l==="puzzle")&&(T=Math.floor(W/10),T>t&&(ft(T),y.play("levelUp")),l!=="avalanche"&&(ze=Math.max(200,1e3-T*75))),V()}function ft(e){const t=$e[e%$e.length];document.documentElement.style.setProperty("--accent-color",t)}function re(e){const t=e/1e3,n=Math.floor(t/60),o=Math.floor(t%60),s=Math.floor(e%1e3);return`${n.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}.${s.toString().padStart(3,"0")}`}function V(){const e=(t,n)=>{if(t.textContent!==n){t.textContent=n;const o=t.parentElement;if(o.classList.contains("stat-update"))return;o.classList.add("stat-update"),o.addEventListener("animationend",()=>o.classList.remove("stat-update"),{once:!0})}};if(e(Ce,$.toString()),e(H,W.toString()),e(he,T.toString()),l==="sprint"){const t=re(ue);we.textContent=t,H.textContent=Math.max(0,Y).toString()}else if(l==="ultra"){const t=Math.floor(F/6e4),n=Math.floor(F%6e4/1e3),o=`${t}:${n.toString().padStart(2,"0")}`;we.textContent=o}else if(l==="puzzle"){const t=Math.max(0,_).toString();we.textContent=t}}function Zt(e){for(let n=0;n<e;n++)for(let o=0;o<v;o++)if(m[n][o]!==0){ie();return}m.splice(0,e);const t=Math.floor(Math.random()*v);for(let n=0;n<e;n++){const o=Array(v).fill(pt).map((s,i)=>i===t?0:s);m.push(o)}}function en(){se++;const e=f.length;f.forEach(t=>{for(let n=0;n<v;n++)m[t][n]=0}),f=[],tn(),ut(e),m.forEach((t,n)=>{t.every(o=>o>0)&&f.push(n)}),f.length>0?dt(!1):(L=!1,se=0,be()),B()}function tn(){for(let e=0;e<v;e++){let t=k-1;for(let n=k-1;n>=0;n--)m[n][e]!==0&&(n!==t&&(m[t][e]=m[n][e],m[n][e]=0),t--)}}function nn(){const e=localStorage.getItem("tetrisSettings"),t=e?JSON.parse(e):null,n={volume:.5,ghostStyle:"solid"};t?(typeof t.showGhost<"u"&&(t.ghostStyle=t.showGhost?"solid":"off",delete t.showGhost),w={...n,...t}):w=n,y.volume=w.volume,Qe.value=w.volume.toString(),Ze.value=w.ghostStyle}function Ve(){localStorage.setItem("tetrisSettings",JSON.stringify(w))}function on(){const e=localStorage.getItem("tetrisHighScores");O=e?JSON.parse(e):{},Xe()}function sn(){localStorage.setItem("tetrisHighScores",JSON.stringify(O))}function an(){if(l==="sprint"&&Y>0)return;const t={score:l==="sprint"?ue:$,date:new Date().toISOString()},n=O[l]||[];n.push(t),l==="sprint"?n.sort((o,s)=>o.score-s.score):n.sort((o,s)=>s.score-o.score),O[l]=n.slice(0,5),sn(),Xe()}function Xe(){if(!l)return;const e=O[l];let t="0";e&&e.length>0&&(t=l==="sprint"?re(e[0].score):e[0].score.toString()),vt.textContent=t}function D(){c||f.length>0||document.querySelector(".modal:not(.hidden)")||(g=!g,g?(y.play("pause"),cancelAnimationFrame(M),P=0,Ae(),ct()):(G=performance.now(),He(G)),ce.textContent=g?"Resume":"Pause",ge.textContent=g?"▶":"❚❚")}function Ae(){[ce,U,Pe].forEach((t,n)=>{n===P&&t.focus()})}function ln(){const e=document.getElementById("mc-left"),t=document.getElementById("mc-right"),n=document.getElementById("mc-down"),o=document.getElementById("mc-rotate"),s=document.getElementById("mc-hard-drop"),i=document.getElementById("mc-hold");if(!e||!t||!n||!o||!s||!i||!ge||!qe||!te)return;const r=(h=25)=>{"vibrate"in navigator&&navigator.vibrate(h)},d=(h,E)=>ht=>{ht.preventDefault(),r(),!((g||c||f.length>0||L||document.querySelector(".modal:not(.hidden)"))&&h!==D&&h!==ae)&&(h(),E&&y.play(E),g||B())},I=()=>{for(;C(a.shape,a.x,a.y+1);)a.y++;fe()},u=(h,E)=>{h.addEventListener("touchstart",E,{passive:!1}),h.addEventListener("mousedown",E,{passive:!1})};u(e,d(()=>q(-1))),u(t,d(()=>q(1))),u(n,d(Le,"softDrop")),u(o,d(Me)),u(i,d(Fe)),u(s,d(I,"hardDrop")),u(ge,d(D)),u(qe,d(ae)),u(te,d(Se))}function rn(){b.addEventListener("touchstart",cn,{passive:!1}),b.addEventListener("touchmove",e=>e.preventDefault(),{passive:!1}),b.addEventListener("touchend",dn,{passive:!1})}function cn(e){e.preventDefault(),et=e.touches[0].clientX,tt=e.touches[0].clientY,nt=performance.now()}function dn(e){if(e.preventDefault(),g||c||f.length>0||L||document.querySelector(".modal:not(.hidden)"))return;const t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY,o=performance.now()-nt,s=t-et,i=n-tt,r=30,d=200,I=10,u=1;if(o<d&&Math.abs(s)<I&&Math.abs(i)<I)Me();else if(Math.abs(s)>Math.abs(i))s>r?q(1):s<-r&&q(-1);else if(i>r)if(i/o>u){for(;C(a.shape,a.x,a.y+1);)a.y++;fe(),y.play("hardDrop")}else Le(),y.play("softDrop");B()}function un(){if("ontouchstart"in window||navigator.maxTouchPoints>0)return;let t=-1;const n=r=>{if(g||c||f.length>0||L||!a)return;const d=b.getBoundingClientRect(),I=r.clientX-d.left,u=Math.floor(I/A)-Math.floor(a.shape[0].length/2);if(u!==t){const h=u;C(a.shape,h,a.y)&&(a.x=h,B()),t=u}},o=r=>{if(!(g||c||f.length>0||L)&&(r.preventDefault(),r.button===0)){for(;C(a.shape,a.x,a.y+1);)a.y++;fe(),y.play("hardDrop"),B()}},s=r=>{g||c||f.length>0||L||(r.preventDefault(),Fe(),B())},i=r=>{g||c||f.length>0||L||(r.preventDefault(),Me(),B())};b.addEventListener("mousemove",n),b.addEventListener("click",o),b.addEventListener("contextmenu",s),b.addEventListener("wheel",i,{passive:!1})}function fn(e){const t=e.key.toLowerCase();if(!De.classList.contains("hidden")){switch(e.preventDefault(),t){case"arrowdown":z=(z+1)%K.length,Te();break;case"arrowup":z=(z-1+K.length)%K.length,Te();break;case"enter":K[z].click();break}return}if(c)return;if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),Ne());return}if(g){e.preventDefault();const s=[ce,U,Pe];switch(t){case"arrowdown":P=(P+1)%s.length,Ae();break;case"arrowup":P=(P-1+s.length)%s.length,Ae();break;case"enter":s[P].click();break;case"p":case"escape":D();break}return}if(t==="h"){e.preventDefault(),ae();return}if(t==="p"||t==="escape"){e.preventDefault(),D();return}if(!(f.length>0||L)){switch(t){case"arrowleft":e.preventDefault(),q(-1);break;case"arrowright":e.preventDefault(),q(1);break;case"arrowdown":e.preventDefault(),Le(),y.play("softDrop");break;case"arrowup":e.preventDefault(),Me();break;case"enter":case" ":for(e.preventDefault();C(a.shape,a.x,a.y+1);)a.y++;fe(),y.play("hardDrop");break;case"c":e.preventDefault(),Fe();break;case"q":e.preventDefault(),Se();break}B()}}Xt();
