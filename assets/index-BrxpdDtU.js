(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function o(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(i){if(i.ep)return;i.ep=!0;const s=o(i);fetch(i.href,s)}})();const a=10,f=20,A=document.getElementById("game-canvas"),r=A.getContext("2d"),L=document.getElementById("next-canvas"),G=L.getContext("2d"),ne=document.getElementById("score"),ie=document.getElementById("lines"),oe=document.getElementById("level"),re=document.getElementById("high-score"),b=document.getElementById("start-button"),le=document.getElementById("help-button"),H=document.getElementById("help-modal"),se=document.querySelector(".close-button"),X=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],ce=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],D={base:"#555",light:"#888",dark:"#333"},ae={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let p,t,T,R,C,k,v,u,d,M,F,Y,g,x,P;function fe(){ye(),b.addEventListener("click",()=>{if(u){q();return}g&&!u?te():q()}),document.addEventListener("keydown",Ee),le.addEventListener("click",xe),se.addEventListener("click",U),window.addEventListener("resize",z),z()}function z(){const e=window.innerHeight;x=Math.floor(e*.9/f),A.width=a*x,A.height=f*x,r.scale(x,x),P=Math.floor(x*.7),L.width=4*P,L.height=4*P,G.scale(P,P),T&&j(),u?(w(),J()):d?(w(),Q()):!g&&p&&w()}function q(){g&&cancelAnimationFrame(g),p=de(),R=0,C=0,k=0,u=!1,d=!1,M=0,F=1e3,Y=0,g=0,U(),ee(),N(),K(),_(),b.textContent="Pause",V(0)}function de(){return Array.from({length:f},()=>Array(a).fill(0))}function _(){t={...T,x:Math.floor(a/2)-1,y:0},K(),m(t.shape,t.x,t.y)||(u=!0)}function K(){T=ue(),j()}function ue(){const e=Math.floor(Math.random()*X.length);return{shape:X[e]}}function V(e=0){if(g=requestAnimationFrame(V),d){Q();return}if(u){Se(),J(),cancelAnimationFrame(g),g=0,b.textContent="Start Game";return}const n=e-Y;Y=e,M+=n,M>F&&Z(),w()}function w(){r.clearRect(0,0,A.width,A.height),B(r,p,0,0);let e=t.y;for(;m(t.shape,t.x,e+1);)e++;he(r,t.shape,t.x,e),B(r,t.shape,t.x,t.y)}function j(){G.clearRect(0,0,L.width,L.height);const{shape:e}=T,n=(4-e[0].length)/2,o=(4-e.length)/2;B(G,e,n,o)}function B(e,n,o,l,i){n.forEach((s,c)=>{s.forEach((I,E)=>{if(I>0){const y=i||ce[I],h=E+o,O=c+l,S=.1;e.fillStyle=y.dark,e.fillRect(h,O,1,1),e.fillStyle=y.light,e.fillRect(h,O,1-S,1-S),e.fillStyle=y.base,e.fillRect(h+S,O+S,1-S*2,1-S*2)}})})}function he(e,n,o,l){n.forEach((i,s)=>{i.forEach((c,I)=>{if(c>0){const E=I+o,y=s+l,h=.1;e.fillStyle=D.dark,e.fillRect(E,y,1,1),e.fillStyle=D.light,e.fillRect(E,y,1-h,1-h),e.fillStyle=D.base,e.fillRect(E+h,y+h,1-h*2,1-h*2)}})})}function J(){B(r,p,0,0,ae),r.fillStyle="rgba(0, 0, 0, 0.75)",r.fillRect(0,0,a,f),r.fillStyle="white",r.textAlign="center",r.font='1.1px "Press Start 2P"',r.fillText("GAME OVER",a/2,f/2-1.5),r.font='0.7px "Press Start 2P"',r.fillText("Press Start",a/2,f/2+.5),r.fillText("to Play Again",a/2,f/2+1.5)}function Q(){r.fillStyle="rgba(0, 0, 0, 0.75)",r.fillRect(0,0,a,f),r.fillStyle="white",r.textAlign="center",r.font='1.5px "Press Start 2P"',r.fillText("PAUSED",a/2,f/2)}function Z(){m(t.shape,t.x,t.y+1)?t.y++:$(),M=0}function W(e){m(t.shape,t.x+e,t.y)&&(t.x+=e)}function ge(){const e=t.shape,n=pe(e);let o=1;m(n,t.x,t.y)?t.shape=n:m(n,t.x+o,t.y)?(t.x+=o,t.shape=n):m(n,t.x-o,t.y)&&(t.x-=o,t.shape=n)}function pe(e){return e[0].map((o,l)=>e.map(i=>i[l])).map(o=>o.reverse())}function m(e,n,o){for(let l=0;l<e.length;l++)for(let i=0;i<e[l].length;i++)if(e[l][i]!==0){const s=n+i,c=o+l;if(s<0||s>=a||c>=f||c>=0&&p[c][s]!==0)return!1}return!0}function $(){t.shape.forEach((e,n)=>{e.forEach((o,l)=>{o>0&&t.y+n>=0&&(p[t.y+n][t.x+l]=o)})}),me(),_()}function me(){let e=0;e:for(let n=f-1;n>=0;n--){for(let l=0;l<a;l++)if(p[n][l]===0)continue e;const o=p.splice(n,1)[0].fill(0);p.unshift(o),n++,e++}e>0&&(C+=e,R+=[0,100,300,500,800][e]*(k+1),k=Math.floor(C/10),F=Math.max(200,1e3-k*75),ee())}function ee(){ne.textContent=R.toString(),ie.textContent=C.toString(),oe.textContent=k.toString()}function ye(){const e=localStorage.getItem("tetrisHighScore");v=e?parseInt(e,10):0,N()}function be(){localStorage.setItem("tetrisHighScore",v.toString())}function Se(){R>v&&(v=R,be(),N())}function N(){re.textContent=v.toString()}function te(){u||d&&!H.classList.contains("hidden")||(d=!d,b.textContent=d?"Resume":"Pause")}function xe(){g&&!d&&!u&&(d=!0,b.textContent="Resume"),H.classList.remove("hidden")}function U(){g&&!u&&b.textContent==="Resume"&&(d=!1,b.textContent="Pause"),H.classList.add("hidden")}function Ee(e){if(!u&&(e.key==="p"||e.key==="P"||e.key==="Escape")){e.preventDefault(),!H.classList.contains("hidden")&&e.key==="Escape"?U():te();return}if(!(u||d)){switch(e.key){case"ArrowLeft":e.preventDefault(),W(-1);break;case"ArrowRight":e.preventDefault(),W(1);break;case"ArrowDown":e.preventDefault(),Z();break;case"ArrowUp":e.preventDefault(),ge();break;case" ":for(e.preventDefault();m(t.shape,t.x,t.y+1);)t.y++;$();break}w()}}fe();
