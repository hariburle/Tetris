(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const d of l.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}})();const $e={},u=10,S=20,Be=300,Pe=100,B=document.getElementById("game-canvas"),c=B.getContext("2d"),G=document.getElementById("next-canvas"),ie=G.getContext("2d"),q=document.getElementById("hold-canvas"),le=q.getContext("2d"),Ue=document.getElementById("score"),ce=document.getElementById("lines"),J=document.getElementById("level"),Ye=document.getElementById("high-score"),ue=document.getElementById("pause-button"),fe=document.getElementById("quit-button"),Xe=document.getElementById("help-button"),K=document.getElementById("game-container"),ae=document.getElementById("mode-display"),Ie=document.getElementById("mode-label"),Le=document.getElementById("mode-value"),he=document.getElementById("main-menu"),_=document.querySelectorAll("#menu-button-group button"),Ve=document.getElementById("menu-marathon-button"),ze=document.getElementById("menu-sprint-button"),Je=document.getElementById("menu-ultra-button"),Ke=document.getElementById("menu-high-scores-button"),je=document.getElementById("menu-settings-button"),Qe=document.getElementById("help-modal"),Ze=document.getElementById("high-scores-modal"),et=document.getElementById("settings-modal"),Me=document.getElementById("high-scores-table"),Te=document.getElementById("volume-slider"),Ce=document.getElementById("ghost-toggle"),tt=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],nt=5,ot=[{base:"transparent",light:"transparent",dark:"transparent"},{base:"#00bcd4",light:"#6ff9ff",dark:"#008ba3"},{base:"#2196f3",light:"#6ec6ff",dark:"#0069c0"},{base:"#ff9800",light:"#ffc947",dark:"#c66900"},{base:"#ffeb3b",light:"#ffff72",dark:"#c8b900"},{base:"#4caf50",light:"#80e27e",dark:"#087f23"},{base:"#9c27b0",light:"#d05ce3",dark:"#6a0080"},{base:"#f44336",light:"#ff7961",dark:"#ba000d"}],ke=["#00bcd4","#4caf50","#ffeb3b","#ff9800","#f44336","#9c27b0","#2196f3"],st={base:"rgba(85, 85, 85, 0.5)",light:"rgba(136, 136, 136, 0.5)",dark:"rgba(51, 51, 51, 0.5)"},it={base:"#424242",light:"#6d6d6d",dark:"#1b1b1b"};let w,s,W,A,j,Q,X,Z,I,L,p=!0,y,ee,me,$,m,E=[],U,D,F=null,V,T,x,b,M,N,R,C=0;const g={sounds:{},volume:.5,loadSounds:function(){const e=["move","rotate","softDrop","hardDrop","lock","hold","clearLine","clearTetris","levelUp","pause","gameOver"],t=typeof $e<"u"?"/Tetris/":"/";e.forEach(o=>{const n=new Audio,i=document.createElement("source");i.src=`${t}sounds/${o}.wav`,i.type="audio/wav";const l=document.createElement("source");l.src=`${t}sounds/${o}.mp3`,l.type="audio/mpeg",n.appendChild(i),n.appendChild(l),this.sounds[o]=n})},play:function(e){if(this.sounds[e]){const t=this.sounds[e].cloneNode(!0);t.volume=this.volume,t.play().catch(o=>console.error(`Error playing sound ${e}:`,o.message))}}};function lt(){g.loadSounds(),yt(),Et(),ct(),ge(),z()}function ct(){Ve.addEventListener("click",()=>se("marathon")),ze.addEventListener("click",()=>se("sprint")),Je.addEventListener("click",()=>se("ultra")),Ke.addEventListener("click",rt),je.addEventListener("click",dt),ue.addEventListener("click",O),fe.addEventListener("click",Ae),Xe.addEventListener("click",te),document.querySelectorAll(".close-button").forEach(e=>{e.addEventListener("click",pe)}),Te.addEventListener("input",e=>{b.volume=parseFloat(e.target.value),g.volume=b.volume,xe()}),Ce.addEventListener("change",e=>{b.showGhost=e.target.checked,xe(),p||H()}),document.addEventListener("keydown",wt),window.addEventListener("resize",ge),bt()}function z(){B.removeEventListener("click",z),document.querySelectorAll(".modal").forEach(e=>e.classList.add("hidden")),he.classList.remove("hidden"),K.classList.add("hidden"),ae.classList.add("hidden"),C=0,re()}function re(){_.forEach((e,t)=>{t===C?e.classList.add("selected"):e.classList.remove("selected")})}function at(){he.classList.add("hidden"),K.classList.remove("hidden"),ge()}function te(){m&&!y&&!p&&O(),Qe.classList.remove("hidden")}function rt(){const e=Me.querySelector("tbody");e&&e.remove();const t=document.createElement("tbody");L.length===0?t.innerHTML='<tr><td colspan="2">No scores yet!</td></tr>':L.forEach((o,n)=>{const i=`<tr><td>${n+1}.</td><td>${o.score}</td></tr>`;t.innerHTML+=i}),Me.appendChild(t),Ze.classList.remove("hidden")}function dt(){m&&!y&&!p&&O(),et.classList.remove("hidden")}function pe(){if(!!!document.querySelector(".modal:not(.hidden)"))return;const t=y;document.querySelectorAll(".modal").forEach(o=>o.classList.add("hidden")),t&&m&&!p&&(y=!1,O())}function ge(){const e=window.innerHeight,t=K.getBoundingClientRect();let o=t.width;if(window.innerWidth<=768){const i=document.getElementById("side-panel"),l=window.getComputedStyle(K),d=parseFloat(l.paddingTop),k=parseFloat(l.paddingBottom),f=parseFloat(l.gap),v=i.offsetHeight+d+k+f,r=e-v,a=Math.floor(r/S),h=Math.floor(t.width*.95/u);T=Math.max(1,Math.min(a,h))}else{o-=252;const i=Math.floor(e*.9/S),l=Math.floor(o*.95/u);T=Math.max(1,Math.min(i,l))}B.width=u*T,B.height=S*T;const n=document.getElementById("side-panel");window.innerWidth>768?n.style.height=`${B.height}px`:n.style.height="auto",c.scale(T,T),x=Math.floor(T*.7),G.width=4*x,G.height=4*x,ie.scale(x,x),q.width=4*x,q.height=4*x,le.scale(x,x),W&&_e(),A&&be(),w&&(H(),p&&Fe())}function se(e){switch(M=e,at(),m&&cancelAnimationFrame(m),w=ut(),X=0,Z=0,I=0,p=!1,y=!1,ee=0,me=1e3,$=0,m=0,E=[],U=0,D=0,A=null,j=!0,Q=[],ae.classList.remove("hidden"),M){case"sprint":N=40,Ie.textContent="LINES",J.parentElement.classList.add("hidden");break;case"ultra":R=3*60*1e3,Ie.textContent="TIME",J.parentElement.classList.add("hidden"),ce.parentElement.classList.add("hidden");break;case"marathon":default:ae.classList.add("hidden"),J.parentElement.classList.remove("hidden"),ce.parentElement.classList.remove("hidden");break}Oe(),qe(I),pe(),oe(),we(),De(),Ee(),be(),ue.textContent="Pause",fe.classList.remove("hidden"),ye(0)}function Ae(){m&&(cancelAnimationFrame(m),m=0),p=!0,z()}function ye(e=0){if(p)return;if(m=requestAnimationFrame(ye),y){Ge();return}const t=e-$;if($=e,M==="ultra"?(R-=t,R<=0&&(R=0,de())):M==="sprint"&&N<=0&&de(),D>0&&(D-=t),E.length>0){if(U-=t,U<=0){let o=E.length;E.sort((n,i)=>n-i).forEach(n=>{w.splice(n,1),w.unshift(Array(u).fill(0))}),E=[],gt(o),Ee()}}else ee+=t,ee>me&&Se();p||(oe(),H())}function de(){p=!0,g.play("gameOver"),vt(),H(),Fe(),cancelAnimationFrame(m),m=0,fe.classList.add("hidden"),B.addEventListener("click",z)}function ut(){return Array.from({length:S},()=>Array(u).fill(0))}function Oe(){const e=[0,1,2,3,4,5,6];for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}Q.push(...e)}function Re(){Q.length===0&&Oe();const e=Q.shift();return{shape:tt[e],shapeIndex:e}}function Ee(){s={...W,x:Math.floor(u/2)-1,y:0},De(),V=!1,j=!0,P(s.shape,s.x,s.y)||de()}function De(){W=Re(),_e()}function Ne(){if(!j)return;g.play("hold");const e=s.x,t=s.y,o={shape:s.shape,shapeIndex:s.shapeIndex};let n;A?n={...A,x:e,y:t}:n={...Re(),x:Math.floor(u/2)-1,y:0},P(n.shape,n.x,n.y)&&(s=n,A=o,j=!1,be())}function Se(){P(s.shape,s.x,s.y+1)?(s.y++,V=!1):ve(),ee=0}function ne(e){P(s.shape,s.x+e,s.y)&&(s.x+=e,V=!1,g.play("move"))}function He(){const e=ft(s.shape),t=[[0,0],[1,0],[-1,0],[2,0],[-2,0],[0,1],[0,-1]];for(const[o,n]of t)if(P(e,s.x+o,s.y+n)){s.x+=o,s.y+=n,s.shape=e,V=!0,g.play("rotate");return}}function ft(e){return e[0].map((t,o)=>e.map(n=>n[o])).map(t=>t.reverse())}function P(e,t,o){for(let n=0;n<e.length;n++)for(let i=0;i<e[n].length;i++)if(e[n][i]!==0){const l=t+i,d=o+n;if(l<0||l>=u||d>=S||d>=0&&w[d][l]!==0)return!1}return!0}function ve(){const e=mt();F={shape:s.shape,x:s.x,y:s.y},D=Pe,s.shape.forEach((t,o)=>{t.forEach((n,i)=>{n>0&&s.y+o>=0&&(w[s.y+o][s.x+i]=n)})}),pt(e),E.length===0&&(e&&(X+=400*(I+1),oe()),Ee()),g.play("lock")}function H(){if(!(!c||!w)){if(c.clearRect(0,0,B.width,B.height),Y(c,w,0,0),D>0&&F&&(c.fillStyle=`rgba(255, 255, 255, ${.8*(D/Pe)})`,F.shape.forEach((e,t)=>{e.forEach((o,n)=>{o>0&&c.fillRect(F.x+n,F.y+t,1,1)})})),!p&&s){if(b.showGhost){let e=s.y;for(;P(s.shape,s.x,e+1);)e++;ht(c,s.shape,s.x,e)}Y(c,s.shape,s.x,s.y)}if(E.length>0){const e=Math.abs(Math.sin(U/Be*Math.PI*2));c.fillStyle=`rgba(255, 255, 255, ${e*.9})`,E.forEach(t=>{c.fillRect(0,t,u,1)})}}}function _e(){if(ie.clearRect(0,0,G.width,G.height),!W)return;const{shape:e}=W,t=(4-e[0].length)/2,o=(4-e.length)/2;Y(ie,e,t,o)}function be(){if(le.clearRect(0,0,q.width,q.height),!A)return;const{shape:e}=A,t=(4-e[0].length)/2,o=(4-e.length)/2;Y(le,e,t,o)}function Y(e,t,o,n,i){t.forEach((l,d)=>{l.forEach((k,f)=>{if(k>0){if(E.includes(Math.floor(d+n)))return;const v=i||ot[k],r=f+o,a=d+n,h=.1;e.fillStyle=v.dark,e.fillRect(r,a,1,1),e.fillStyle=v.light,e.fillRect(r,a,1-h,1-h),e.fillStyle=v.base,e.fillRect(r+h,a+h,1-h*2,1-h*2)}})})}function ht(e,t,o,n){const i=st;t.forEach((l,d)=>{l.forEach((k,f)=>{if(k>0){const v=f+o,r=d+n,a=.1;e.fillStyle=i.dark,e.fillRect(v,r,1,1),e.fillStyle=i.light,e.fillRect(v,r,1-a,1-a),e.fillStyle=i.base,e.fillRect(v+a,r+a,1-a*2,1-a*2)}})})}function Fe(){Y(c,w,0,0,it),c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,u,S),c.fillStyle="white",c.textAlign="center";let e="GAME OVER";M==="sprint"&&N<=0&&(e="YOU WIN!"),c.font='1.1px "Press Start 2P"',c.fillText(e,u/2,S/2-1.5),c.font='0.7px "Press Start 2P"',c.fillText("Press any key",u/2,S/2+1),c.fillText("to continue",u/2,S/2+2)}function Ge(){c.fillStyle="rgba(0, 0, 0, 0.75)",c.fillRect(0,0,u,S),c.fillStyle="white",c.textAlign="center",c.font='1.5px "Press Start 2P"',c.fillText("PAUSED",u/2,S/2)}function mt(){if(s.shapeIndex!==nt||!V)return!1;const e=s.x+1,t=s.y+1,o=[[t-1,e-1],[t-1,e+1],[t+1,e-1],[t+1,e+1]];let n=0;return o.forEach(([i,l])=>{(l<0||l>=u||i<0||i>=S||w[i][l]!==0)&&n++}),n>=3}function pt(e){let t=0;w.forEach((o,n)=>{o.every(i=>i>0)&&(t++,E.push(n))}),t>0&&(U=Be,X+=(e?[400,800,1200,1600][t]:[0,100,300,500,800][t])*(I+1),g.play(t>=4?"clearTetris":"clearLine"))}function gt(e){const t=I;Z+=e,M==="sprint"&&(N-=e),M==="marathon"&&(I=Math.floor(Z/10),I>t&&(qe(I),g.play("levelUp")),me=Math.max(200,1e3-I*75)),oe()}function qe(e){const t=ke[e%ke.length];document.documentElement.style.setProperty("--accent-color",t)}function oe(){if(Ue.textContent=X.toString(),ce.textContent=Z.toString(),J.textContent=I.toString(),M==="sprint")Le.textContent=Math.max(0,N).toString();else if(M==="ultra"){const e=Math.floor(R/6e4),t=Math.floor(R%6e4/1e3);Le.textContent=`${e}:${t.toString().padStart(2,"0")}`}}function yt(){const e=localStorage.getItem("tetrisSettings");b=e?JSON.parse(e):{volume:.5,showGhost:!0},b.showGhost===void 0&&(b.showGhost=!0),g.volume=b.volume,Te.value=b.volume.toString(),Ce.checked=b.showGhost}function xe(){localStorage.setItem("tetrisSettings",JSON.stringify(b))}function Et(){const e=localStorage.getItem("tetrisHighScores");L=e?JSON.parse(e):[],we()}function St(){localStorage.setItem("tetrisHighScores",JSON.stringify(L))}function vt(){if(M==="sprint"&&N>0)return;const e={score:X,date:new Date().toISOString()};L.push(e),L.sort((t,o)=>o.score-t.score),L=L.slice(0,5),St(),we()}function we(){Ye.textContent=L.length>0?L[0].score.toString():"0"}function O(){if(p||E.length>0||document.querySelector(".modal:not(.hidden)"))return;y=!y,y?(g.play("pause"),cancelAnimationFrame(m),Ge()):($=performance.now(),ye($));const e=y?"Resume":"Pause";ue.textContent=e;const t=document.getElementById("mc-pause");t&&(t.textContent=e)}function bt(){const e=document.getElementById("mc-left"),t=document.getElementById("mc-right"),o=document.getElementById("mc-down"),n=document.getElementById("mc-rotate"),i=document.getElementById("mc-hard-drop"),l=document.getElementById("mc-hold"),d=document.getElementById("mc-pause"),k=document.getElementById("mc-help");if(!e||!t||!o||!n||!i||!l||!d||!k)return;const f=(a,h)=>We=>{We.preventDefault(),!((y||p||E.length>0||document.querySelector(".modal:not(.hidden)"))&&a!==O&&a!==te)&&(a(),h&&g.play(h),y||H())},v=()=>{for(;P(s.shape,s.x,s.y+1);)s.y++;ve()},r=(a,h)=>{a.addEventListener("touchstart",h,{passive:!1}),a.addEventListener("mousedown",h,{passive:!1})};r(e,f(()=>ne(-1))),r(t,f(()=>ne(1))),r(o,f(Se,"softDrop")),r(n,f(He)),r(l,f(Ne)),r(i,f(v,"hardDrop")),r(d,f(O)),r(k,f(te))}function wt(e){const t=e.key.toLowerCase();if(!he.classList.contains("hidden")){switch(e.preventDefault(),t){case"arrowdown":C=(C+1)%_.length,re();break;case"arrowup":C=(C-1+_.length)%_.length,re();break;case"enter":_[C].click();break}return}if(p){m===0&&z();return}if(!!document.querySelector(".modal:not(.hidden)")){t==="escape"&&(e.preventDefault(),pe());return}if(t==="h"){e.preventDefault(),te();return}if(t==="p"||t==="escape"){e.preventDefault(),O();return}if(!(y||E.length>0)){switch(t){case"arrowleft":e.preventDefault(),ne(-1);break;case"arrowright":e.preventDefault(),ne(1);break;case"arrowdown":e.preventDefault(),Se(),g.play("softDrop");break;case"arrowup":e.preventDefault(),He();break;case"enter":case" ":for(e.preventDefault();P(s.shape,s.x,s.y+1);)s.y++;ve(),g.play("hardDrop");break;case"c":e.preventDefault(),Ne();break;case"q":e.preventDefault(),Ae();break}H()}}lt();
