(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const c of r)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function o(r){const c={};return r.integrity&&(c.integrity=r.integrity),r.referrerPolicy&&(c.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?c.credentials="include":r.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(r){if(r.ep)return;r.ep=!0;const c=o(r);fetch(r.href,c)}})();const a=10,f=20,y=30,g=20,p=document.getElementById("game-canvas"),s=p.getContext("2d"),m=document.getElementById("next-canvas"),w=m.getContext("2d"),G=document.getElementById("score"),K=document.getElementById("lines"),X=document.getElementById("level"),k=document.getElementById("start-button"),I=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[2,0,0],[2,2,2],[0,0,0]],[[0,0,3],[3,3,3],[0,0,0]],[[4,4],[4,4]],[[0,5,5],[5,5,0],[0,0,0]],[[0,6,0],[6,6,6],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],V=["transparent","#00bcd4","#2196f3","#ff9800","#ffeb3b","#4caf50","#9c27b0","#f44336"];let u,t,O,b,x,h,P,E,C,S,v;function q(){p.width=a*y,p.height=f*y,m.width=4*g,m.height=4*g,s.scale(y,y),w.scale(g,g),k.addEventListener("click",U),document.addEventListener("keydown",Q)}function U(){v&&cancelAnimationFrame(v),u=Y(),b=0,x=0,h=0,P=!1,E=0,C=1e3,S=0,_(),R(),M(),B(0)}function Y(){return Array.from({length:f},()=>Array(a).fill(0))}function M(){t={...O,x:Math.floor(a/2)-1,y:0},R(),d(t.shape,t.x,t.y)||(P=!0)}function R(){O=Z(),H()}function Z(){const e=Math.floor(Math.random()*I.length);return{shape:I[e]}}function B(e=0){if(P){W();return}const n=e-S;S=e,E+=n,E>C&&N(),D(),v=requestAnimationFrame(B)}function D(){s.clearRect(0,0,p.width,p.height),A(s,u,0,0),A(s,t.shape,t.x,t.y)}function H(){w.clearRect(0,0,m.width,m.height);const{shape:e}=O,n=(4-e[0].length)/2,o=(4-e.length)/2;A(w,e,n,o)}function A(e,n,o,i){n.forEach((r,c)=>{r.forEach((l,F)=>{l>0&&(e.fillStyle=V[l],e.fillRect(F+o,c+i,1,1))})})}function W(){s.fillStyle="rgba(0, 0, 0, 0.75)",s.fillRect(0,0,a,f),s.fillStyle="white",s.font='2px "Press Start 2P"',s.textAlign="center",s.fillText("GAME OVER",a/2,f/2-1),s.font='0.8px "Press Start 2P"',s.fillText("Press Start to Play Again",a/2,f/2+1)}function N(){d(t.shape,t.x,t.y+1)?t.y++:T(),E=0}function L(e){d(t.shape,t.x+e,t.y)&&(t.x+=e)}function j(){const e=t.shape,n=z(e);let o=1;d(n,t.x,t.y)?t.shape=n:d(n,t.x+o,t.y)?(t.x+=o,t.shape=n):d(n,t.x-o,t.y)&&(t.x-=o,t.shape=n)}function z(e){return e[0].map((o,i)=>e.map(r=>r[i])).map(o=>o.reverse())}function d(e,n,o){for(let i=0;i<e.length;i++)for(let r=0;r<e[i].length;r++)if(e[i][r]!==0){const c=n+r,l=o+i;if(c<0||c>=a||l>=f||l>=0&&u[l][c]!==0)return!1}return!0}function T(){t.shape.forEach((e,n)=>{e.forEach((o,i)=>{o>0&&t.y+n>=0&&(u[t.y+n][t.x+i]=o)})}),J(),M()}function J(){let e=0;e:for(let n=f-1;n>=0;n--){for(let i=0;i<a;i++)if(u[n][i]===0)continue e;const o=u.splice(n,1)[0].fill(0);u.unshift(o),n++,e++}e>0&&(x+=e,b+=[0,100,300,500,800][e]*(h+1),h=Math.floor(x/10),C=Math.max(200,1e3-h*75),_())}function _(){G.textContent=b.toString(),K.textContent=x.toString(),X.textContent=h.toString()}function Q(e){if(!P){switch(e.key){case"ArrowLeft":e.preventDefault(),L(-1);break;case"ArrowRight":e.preventDefault(),L(1);break;case"ArrowDown":e.preventDefault(),N();break;case"ArrowUp":e.preventDefault(),j();break;case" ":for(e.preventDefault();d(t.shape,t.x,t.y+1);)t.y++;T();break}D()}}q();
